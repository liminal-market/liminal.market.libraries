(()=>{"use strict";var e=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class t{constructor(){this.ServerUrl="",this.AppId="",this.ChainId=0,this.Name="",this.ChainName="",this.NativeCurrencyName="",this.NativeSymbol="",this.NativeDecimal=18,this.RpcUrl="",this.BlockExplorer="",this.TestNetwork=!0,this.FaucetUrl="",this.BuyUrl=""}addNetworkToWallet(t){return e(this,void 0,void 0,(function*(){const e=yield t.enableWeb3();e&&e.provider.request&&e.provider.request({method:"wallet_addEthereumChain",params:[{chainId:"0x"+this.ChainId.toString(16),chainName:this.ChainName,nativeCurrency:{name:this.NativeCurrencyName,symbol:this.NativeSymbol,decimals:this.NativeDecimal},rpcUrls:[this.RpcUrl],blockExplorerUrls:[this.BlockExplorer]}]}).catch((e=>{console.log(e)}))}))}hasEnoughNativeTokens(t){return e(this,void 0,void 0,(function*(){if("localhost"==this.Name)return!0;{const e={chain:"0x"+this.ChainId.toString(16)},n=yield t.Web3API.account.getNativeBalance(e);if(parseFloat(Moralis.Units.FromWei(n.balance,18))<.005)return!1}return!0}))}}class n extends t{constructor(){super(),-1!=window.location.host.indexOf("localhost")?(this.ServerUrl="https://dqet8dfymvzj.usemoralis.com:2053/server",this.AppId="TXR6YesK99VgRCxSecnySRMp1KI5rLnCfIetQuuU"):(this.ServerUrl="https://f8t1vrrwtboa.usemoralis.com:2053/server",this.AppId="XZhp3wQobrKiCib0Bf4FPVKAUhbHM9SvTLKOKvBb"),this.TestNetwork=!0}}class i extends n{constructor(){super(),this.ChainId=80001,this.Name="mumbai",this.ChainName="Polygon Mumbai",this.NativeCurrencyName="Matic",this.NativeSymbol="MATIC",this.NativeDecimal=18,this.RpcUrl="https://matic-mumbai.chainstacklabs.com/",this.BlockExplorer="https://mumbai.polygonscan.com/",this.FaucetUrl="https://faucet.polygon.technology/",this.BuyUrl="https://www.moonpay.com/buy/matic"}}class o{constructor(e){this.setCookieNetwork=e=>{this.setCookie("network",e)},this.document=e}setCookie(e,t){new Date,this.document.cookie=e+"="+t+"; expires=Mon, 2 Dec 2024 12:00:00 UTC;path=/;SameSite=Strict"}getCookieValue(e){var t;return(null===(t=this.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)"))||void 0===t?void 0:t.pop())||""}setCookieProvider(e){this.setCookie("provider",e)}deleteCookie(e){this.document.cookie=e+"=0; expires=Mon, 2 Dec 2020 12:00:00 UTC;path=/"}}class a extends t{constructor(){super(),this.ServerUrl="https://03sj8bj43s54.grandmoralis.com:2053/server",this.AppId="G62wwf2lVoNz0v5tKRZKHPcHWjEh2Xd816UyRQYU",this.TestNetwork=!1}}const r=[class extends n{constructor(){super(),this.ChainId=31337,this.Name="localhost",this.ChainName="localhost test",this.NativeCurrencyName="Ethereum",this.NativeSymbol="ETH",this.NativeDecimal=18,this.RpcUrl="https://rinkeby.infura.io/",this.BlockExplorer="https://rinkeby.etherscan.io"}},i,class extends a{constructor(){super(),this.ChainId=137,this.Name="polygon",this.ChainName="Polygon Mainnet",this.NativeCurrencyName="Matic",this.NativeSymbol="MATIC",this.NativeDecimal=18,this.RpcUrl="https://polygon-rpc.com/",this.BlockExplorer="https://polygonscan.com/",this.FaucetUrl="https://faucet.polygon.technology/",this.BuyUrl="https://www.moonpay.com/buy/matic"}}];class s{constructor(e){this.moralis=e}static getInstance(){if(s.instance)return s.instance;if("undefined"!=typeof ethereum&&ethereum&&ethereum.chainId){let e=this.getNetworkInfoByChainId(ethereum.chainId);if(e)return s.instance=e,s.instance}return s.instance=this.getNetworkInfo(),s.instance}static loadNetwork(e){s.instance=this.getNetworkInfo(e)}static setNetworkByChainId(e){let t=this.getNetworkInfoByChainId(e);t&&(s.instance=t)}static getNetworks(){let e=new Array,t=-1!=window.location.host.indexOf("localhost");return r.forEach((n=>{let i=new n;(t||"localhost"!=i.Name)&&e.push(i)})),e}static getNetworkInfoByChainId(e){let t;return r.forEach((n=>{let i=new n;i.ChainId==e&&(t=i)})),t}static getNetworkInfo(e){let t=new o(document);e||(e=t.getCookieValue("network")),e||(e="mumbai");let n=null;return r.forEach((t=>{let i=new t;i.Name==e&&(n=i)})),n||(t.setCookieNetwork("mumbai"),console.error("Network '"+e+"' could not be found. Defaulting to Mumbai network."),new i)}}class l{constructor(e){e||(e=Moralis),this.moralis=e,this.options={serverUrl:"",appId:""}}getOptions(){return this.options}start(){return e=this,t=void 0,i=function*(){let e=s.getInstance();this.options={serverUrl:e.ServerUrl,appId:e.AppId},yield this.moralis.start(this.options).catch((function(e){-1!=e.message.indexOf("Invalid session token")&&Moralis.User.logOut()}))},new((n=void 0)||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}}class d{constructor(e){e||(e=Moralis),this.moralis=e}isMarketOpen(){return e=this,t=void 0,i=function*(){return yield this.moralis.Cloud.run("isOpen")},new((n=void 0)||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}}class c extends Error{constructor(e){super(),this.code=0,this.stack="",e.message?e.message.data?(this.code=e.message.data.code,this.message=e.message.data.message,this.error=e,this.headers=e.message.headers,this.stack=e.stack):"object"==typeof e.data?(this.code=e.data.code,this.message=e.data.message,this.stack=e.stack):e.message?this.message=e.message:this.message=e.toString():this.message=e.toString()}}class u{constructor(){this.modalId="liminal_market_modal_div"}hideModal(){document.getElementById(this.modalId).removeAttribute("open"),this.onHide&&this.onHide()}showModal(e,t,n=!1,i,o=!0){var a;let r=document.getElementById(this.modalId);if(r){let t=r.dataset.title;if(n&&t&&t===e)return r.setAttribute("open",""),!1}let s=Handlebars.compile('<dialog id="liminal_market_modal_div" data-title="{{{title}}}"> <article> <header> <span>{{title}}</span> <a href="#close" aria-label="Close" class="close" id="liminal_market_modal_close"></a> </header> {{{content}}} </article> </dialog>')({title:e,content:t});r&&document.body.removeChild(r),document.body.insertAdjacentHTML("beforeend",s),r=document.getElementById(this.modalId),r.setAttribute("open",""),o&&r.addEventListener("mousedown",(e=>{e.target&&"liminal_market_modal_div"===e.target.id&&this.hideModal()}));let l=document.getElementById("liminal_market_modal_close");return l&&(l.style.display="block"),null===(a=document.getElementById("liminal_market_modal_close"))||void 0===a||a.addEventListener("click",(e=>{e.preventDefault(),this.hideModal()})),this.onHide=i,!0}}class h{constructor(){this.Class="",this.Exchange="",this.Symbol="",this.Name="",this.Status="",this.Tradable=!1,this.Fractionable=!1,this.Logo="",this.Favorite=0,this.LogoPath="/img/logos/",this.LogoPath="/img/logos/"}}var m,f=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class p{constructor(){this.securities=new Map,this.symbols=["MSFT","AAPL","AMZN","TSLA","GOOGL","GOOG","GME","META","NVDA","BRK.B","JPM","HD","JNJ","UNH","PG","BAC","V","ADBE","NFLX","CRM","PFE","DIS","MA","XOM","TMO","COST"],this.securities=new Map,this.page=1}static getInstance(){return f(this,void 0,void 0,(function*(){return p.instance||(p.instance=new p,p.instance.securities=yield p.instance.getSecurities()),p.instance}))}getSecurities(){return f(this,void 0,void 0,(function*(){if(0!=this.securities.size)return this.securities;const e=yield fetch("/securities/securities.json"),t=yield e.json();for(let e=0;e<t.length;e++)this.securities.set(t[e].Symbol,Object.assign(new h,t[e]));return this.securitiesArray=Array.from(this.securities),this.securities}))}getSecurityBySymbol(e){return f(this,void 0,void 0,(function*(){return(yield this.getSecurities()).get(e)||new h}))}getTopSecurities(){return f(this,void 0,void 0,(function*(){let e=yield this.getSecurities(),t=new Array;for(const n of this.symbols){let i=e.get(n);i&&t.push(i)}return t}))}getPaginatingSecurities(e){return f(this,void 0,void 0,(function*(){if(0==e)return this.getTopSecurities();let t=new Array,n=e*this.symbols.length,i=n+10;for(;n<i&&n<this.securitiesArray.length;n++)t.push(this.securitiesArray[n][1]);return t}))}find(e){return f(this,void 0,void 0,(function*(){let t=new Array;return e=e.toLocaleLowerCase(),this.securities.forEach((function(n){-1==n.Symbol.toLowerCase().indexOf(e)&&-1==n.Name.toLowerCase().indexOf(e)||t.push(n)})),t}))}}class y{static setLoading(e){y.lastElement&&y.lastElement.removeAttribute("aria-busy"),e&&(e.setAttribute("aria-busy","true"),y.lastElement=e)}static removeLoading(){this.lastElement&&this.lastElement.removeAttribute("aria-busy")}}y.lastElement=void 0,function(e){e.Info="infoBar",e.Warning="warningBar",e.Error="errorBar"}(m||(m={}));class v{static show(e,t,n=4){let i=document.getElementById("infoBar");i||(i=document.createElement("div"),i.classList.add("notificationBar"),i.id="infoBar",document.body.insertAdjacentElement("afterbegin",i)),i.innerHTML=e,i.classList.remove("hidden"),i.classList.remove(m.Info),i.classList.remove(m.Warning),i.classList.remove(m.Error),i.classList.add(t),n>0&&setTimeout((()=>{null==i||i.classList.add("hidden")}),1e3*n)}}class g{constructor(){this.errorMessageMapping=new Map,this.SentLoginRequest="We have sent request to you wallet to login. Open your wallet to login",this.errorMessageMapping.set("chain not supported",(()=>{v.show('Network is not supported. <a href="" id="switchNetworkLink">Click me to switch to supported network</a>',m.Warning,120);let e=document.getElementById("switchNetworkLink");null==e||e.addEventListener("click",(e=>{e.preventDefault(),new E(Moralis).show()}))})),this.errorMessageMapping.set("already processing eth_requestaccounts",this.SentLoginRequest),this.errorMessageMapping.set("request of type 'wallet_requestPermissions' already pending",this.SentLoginRequest),this.errorMessageMapping.set("already has been called, but is not finished yet",this.SentLoginRequest),this.errorMessageMapping.set("request is already in progress",this.SentLoginRequest),this.errorMessageMapping.set("web3 instance",(()=>{let e=document.querySelectorAll(".liminal_market_connect_wallet");e.length>0&&e[0].dispatchEvent(new MouseEvent("click"))})),this.errorMessageMapping.set("user rejected the request",(()=>{Moralis.User.logOut(),window.location.reload()})),this.errorMessageMapping.set("Non ethereum enabled browser",(()=>{let e=new u,t=Handlebars.compile(' You need to set up a wallet in your browser before you can use liminal.market. <br/><br/> To make it simple, we would like to suggest two options. In your browser or your phone. <ul> <li>For the browser we recommend <a href="https://metamask.io/download/" target="_blank">Metamask</a>. </li> <li> For your phone, we like <a href="https://www.tokenpocket.pro/en/download/app" target="_blank">Token Poket</a> </li> </ul> <br/> But, you have <a href="https://ethereum.org/en/wallets/" target="_blank">many options</a> if you want to learn more.');e.showModal("New to blockchain?",t(null),!1,(()=>{}))}))}handle(e){let t=!1;return this.errorMessageMapping.forEach(((n,i)=>{if(!t&&-1!=e.toLowerCase().indexOf(i.toLowerCase()))return"string"==typeof n?v.show(n.toString(),m.Warning,10):n(),t=!0,t})),t}}class b{constructor(e){this.errorInfo=e}getErrorInfo(){return this.errorInfo}static report(e){y.removeLoading(),e&&((new g).handle(e.message)||(e.callback?e.callback():e&&console.error(e.toString())))}static log(e){b.report(new c(e))}static info(e){b.report(new c(e))}static error(e){console.log(e),b.report(new c(e))}}var w=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class _{constructor(e){this.moralis=e}getAUsdAsset(){return{Logo:"../ausd.png"}}addTokenToWallet(e,t,n){return w(this,void 0,void 0,(function*(){let i=yield p.getInstance();const o="aUSD"==t?this.getAUsdAsset():yield i.getSecurityBySymbol(t);let a=this.moralis.web3;if(!a&&(a=yield this.moralis.enableWeb3().catch((e=>{b.report(e)})),!a))return;if(!a.provider.request)return;let r=void 0===_.addTokenFallbackLoaded?2e3:200;return setTimeout((()=>{!1!==_.addTokenFallbackLoaded&&(_.addTokenFallbackLoaded=!0,n&&n())}),r),yield a.provider.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:e,symbol:t,decimals:18,image:"https://app.liminal.market/img/logos/"+o.Logo}}}).then((e=>!0)).catch((e=>(y.removeLoading(),!1))).finally((()=>{_.addTokenFallbackLoaded=!1}))}))}isWebview(e){let t=new RegExp("("+["WebView","(iPhone|iPod|iPad)(?!.*Safari)","Android.*(wv|.0.0.0)","Linux; U; Android","SDK"].join("|")+")","ig");return!!e.match(t)}switchNetwork(e){return w(this,void 0,void 0,(function*(){let t=this.moralis.web3;return yield t.provider.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+e.ChainId.toString(16)}]}).then((e=>(console.log("switch result:",e),!0))).catch((n=>w(this,void 0,void 0,(function*(){if(4902===n.code)return yield t.provider.request({method:"wallet_addEthereumChain",params:[{chainName:e.ChainName,chainId:"0x"+e.ChainId.toString(16),nativeCurrency:{name:e.NativeCurrencyName,decimals:e.NativeDecimal,symbol:e.NativeSymbol},rpcUrls:[e.RpcUrl]}]}).then((e=>(console.log("addChain result:"+e),!0))).catch((e=>{throw console.log("error on addNetwork:",e),new c(e)}));throw new c(n)}))))}))}}_.addTokenFallbackLoaded=void 0;var k=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class E{constructor(e){this.moralis=e}show(){let e=Handlebars.compile('<div id="switchNetworkInfo"> You are using wrong network in your wallet. You can choose any of these networks. <div class="grid"> {{#each networks}} <button href="" class="setNetwork" data-chainid="{{ChainId}}">{{ChainName}} </button> {{/each}} </div> </div> <div id="jsSwitchNetworkNotWorking" class="d-none"> It seem as we can\'t add the network automatically for your, so you need to add it your self. This is the information you need to add the network. You will need to figure out where to add new network for your wallet, as it difference between wallets. <form> <label>ChainId: <input id="switchChainId"/> </label> <label>Chain name <input id="switchChainName"/> </label> <label>Currency name <input id="switchCurrencyName"/> </label> <label> Symbol <input id="switchSymbol"/> </label> <label>Decimal <input id="switchDecimal"/> </label> <label>Rpc Url <input id="switchRpcUrl"/> </label> </form> </div>')({networks:s.getNetworks()}),t=new u;t.showModal("Switch network",e,!1,(()=>k(this,void 0,void 0,(function*(){if(!this.selectedNetwork)return;let e=new _(this.moralis);yield e.switchNetwork(this.selectedNetwork)})))),document.querySelectorAll(".setNetwork").forEach((e=>{e.addEventListener("click",(e=>k(this,void 0,void 0,(function*(){e.preventDefault();let n=e.target.dataset;if(this.selectedNetwork=s.getNetworkInfoByChainId(parseInt(n.chainid)),!this.selectedNetwork)throw new c("Could not find chainId:"+n.chainid);let i=new _(this.moralis);if(yield i.switchNetwork(this.selectedNetwork).catch((e=>{let t=document.getElementById("jsSwitchNetworkNotWorking");if(!t)throw e;t.classList.remove("d-none"),document.getElementById("switchNetworkInfo").classList.add("d-none"),document.getElementById("switchChainId").value=n.chainid+" or it might be: 0x"+parseInt(n.chainid).toString(16),document.getElementById("switchChainName").value=this.selectedNetwork.Name,document.getElementById("switchCurrencyName").value=this.selectedNetwork.NativeCurrencyName,document.getElementById("switchSymbol").value=this.selectedNetwork.NativeSymbol,document.getElementById("switchDecimal").value=this.selectedNetwork.NativeDecimal.toString(),document.getElementById("switchRpcUrl").value=this.selectedNetwork.RpcUrl}))){t.hideModal();let e=document.querySelectorAll(".liminal_market_connect_wallet");if(e.length>0)return void e[0].dispatchEvent(new MouseEvent("click"))}}))))}))}}var I,T=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class S{constructor(e){this.moralis=e}authenticateUser(e,t,n){return T(this,void 0,void 0,(function*(){let i=this.moralis,o=s.getInstance().ChainId,a=yield i.enableWeb3({provider:e,chainId:o,appLogo:"https://app.liminal.market/img/logos/default_logo.png"}).catch((e=>T(this,void 0,void 0,(function*(){throw new c(e)}))));t&&t(a);let r=this.moralis.User.current();if(r)return void(n&&n(r));if(a.network.chainId!=o){if(!s.getNetworkInfoByChainId(a.network.chainId))return void new E(this.moralis).show();s.setNetworkByChainId(a.network.chainId)}let l=yield i.authenticate({signingMessage:"You are logging into Liminal.market.\n\n",provider:e,chainId:o}).catch((e=>{throw console.log(e),new c(e)}));n?n(l):location.reload()}))}getUser(){return this.moralis.User.current()}getEthAddress(){let e=this.getUser();return e?e.get("ethAddress"):""}isWalletConnected(){return this.moralis.isWeb3Enabled()}isUserLoggedIn(){return null!==this.moralis.User.current()}getChainId(){return this.moralis.chainId?parseInt(this.moralis.chainId,16):0}}!function(e){e.Metamask="metamask",e.WalletConnect="walletConnect",e.CoinbaseWallet="coinbase",e.Unknown="unknown"}(I||(I={}));class A{constructor(e){this.ProviderName="unknown",this.WalletName="",this.WalletUrl="",this.WalletType=I.Unknown,this.ChainId=0,this.UserAddress="",e&&e.provider&&(this.walletConnectionInfo=e,this.walletConnectionInfo.connection&&"metamask"==this.walletConnectionInfo.connection.url?this.loadMetamask(e):this.walletConnectionInfo.provider.wc?this.loadWalletConnect(e):console.error("Dont have provider for this",e),A.Instance=this)}loadMetamask(e){this.ProviderName="metamask",this.WalletName="Metamask",this.WalletUrl="https://metamask.io/",this.WalletType=I.Metamask,this.ChainId=e.provider.chainId,this.UserAddress=e.provider.selectedAddress}loadWalletConnect(e){var t;let n=e.provider.wc;this.ProviderName="walletConnect",this.WalletName=n._peerMeta.name,this.WalletUrl=null!==(t=n._peerMeta.url)&&void 0!==t?t:"",this.WalletType=I.WalletConnect,this.ChainId=e.provider.chainId}}var C=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,B=Math.ceil,L=Math.floor,N="[BigNumber Error] ",x=N+"Number primitive has more than 15 significant digits: ",M=1e14,D=14,U=9007199254740991,P=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],F=1e7,R=1e9;function O(e){var t=0|e;return e>0||e===t?t:t-1}function q(e){for(var t,n,i=1,o=e.length,a=e[0]+"";i<o;){for(t=e[i++]+"",n=D-t.length;n--;t="0"+t);a+=t}for(o=a.length;48===a.charCodeAt(--o););return a.slice(0,o+1||1)}function H(e,t){var n,i,o=e.c,a=t.c,r=e.s,s=t.s,l=e.e,d=t.e;if(!r||!s)return null;if(n=o&&!o[0],i=a&&!a[0],n||i)return n?i?0:-s:r;if(r!=s)return r;if(n=r<0,i=l==d,!o||!a)return i?0:!o^n?1:-1;if(!i)return l>d^n?1:-1;for(s=(l=o.length)<(d=a.length)?l:d,r=0;r<s;r++)if(o[r]!=a[r])return o[r]>a[r]^n?1:-1;return l==d?0:l>d^n?1:-1}function W(e,t,n,i){if(e<t||e>n||e!==L(e))throw Error(N+(i||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function Y(e){var t=e.c.length-1;return O(e.e/D)==t&&e.c[t]%2!=0}function K(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function G(e,t,n){var i,o;if(t<0){for(o=n+".";++t;o+=n);e=o+e}else if(++t>(i=e.length)){for(o=n,t-=i;--t;o+=n);e+=o}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var V=function e(t){var n,i,o,a,r,s,l,d,c,u,h=S.prototype={constructor:S,toString:null,valueOf:null},m=new S(1),f=20,p=4,y=-7,v=21,g=-1e7,b=1e7,w=!1,_=1,k=0,E={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz",T=!0;function S(e,t){var n,a,r,s,l,d,c,u,h=this;if(!(h instanceof S))return new S(e,t);if(null==t){if(e&&!0===e._isBigNumber)return h.s=e.s,void(!e.c||e.e>b?h.c=h.e=null:e.e<g?h.c=[h.e=0]:(h.e=e.e,h.c=e.c.slice()));if((d="number"==typeof e)&&0*e==0){if(h.s=1/e<0?(e=-e,-1):1,e===~~e){for(s=0,l=e;l>=10;l/=10,s++);return void(s>b?h.c=h.e=null:(h.e=s,h.c=[e]))}u=String(e)}else{if(!C.test(u=String(e)))return o(h,u,d);h.s=45==u.charCodeAt(0)?(u=u.slice(1),-1):1}(s=u.indexOf("."))>-1&&(u=u.replace(".","")),(l=u.search(/e/i))>0?(s<0&&(s=l),s+=+u.slice(l+1),u=u.substring(0,l)):s<0&&(s=u.length)}else{if(W(t,2,I.length,"Base"),10==t&&T)return j(h=new S(e),f+h.e+1,p);if(u=String(e),d="number"==typeof e){if(0*e!=0)return o(h,u,d,t);if(h.s=1/e<0?(u=u.slice(1),-1):1,S.DEBUG&&u.replace(/^0\.0*|\./,"").length>15)throw Error(x+e)}else h.s=45===u.charCodeAt(0)?(u=u.slice(1),-1):1;for(n=I.slice(0,t),s=l=0,c=u.length;l<c;l++)if(n.indexOf(a=u.charAt(l))<0){if("."==a){if(l>s){s=c;continue}}else if(!r&&(u==u.toUpperCase()&&(u=u.toLowerCase())||u==u.toLowerCase()&&(u=u.toUpperCase()))){r=!0,l=-1,s=0;continue}return o(h,String(e),d,t)}d=!1,(s=(u=i(u,t,10,h.s)).indexOf("."))>-1?u=u.replace(".",""):s=u.length}for(l=0;48===u.charCodeAt(l);l++);for(c=u.length;48===u.charCodeAt(--c););if(u=u.slice(l,++c)){if(c-=l,d&&S.DEBUG&&c>15&&(e>U||e!==L(e)))throw Error(x+h.s*e);if((s=s-l-1)>b)h.c=h.e=null;else if(s<g)h.c=[h.e=0];else{if(h.e=s,h.c=[],l=(s+1)%D,s<0&&(l+=D),l<c){for(l&&h.c.push(+u.slice(0,l)),c-=D;l<c;)h.c.push(+u.slice(l,l+=D));l=D-(u=u.slice(l)).length}else l-=c;for(;l--;u+="0");h.c.push(+u)}}else h.c=[h.e=0]}function A(e,t,n,i){var o,a,r,s,l;if(null==n?n=p:W(n,0,8),!e.c)return e.toString();if(o=e.c[0],r=e.e,null==t)l=q(e.c),l=1==i||2==i&&(r<=y||r>=v)?K(l,r):G(l,r,"0");else if(a=(e=j(new S(e),t,n)).e,s=(l=q(e.c)).length,1==i||2==i&&(t<=a||a<=y)){for(;s<t;l+="0",s++);l=K(l,a)}else if(t-=r,l=G(l,a,"0"),a+1>s){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=a-s)>0)for(a+1==s&&(l+=".");t--;l+="0");return e.s<0&&o?"-"+l:l}function V(e,t){for(var n,i=1,o=new S(e[0]);i<e.length;i++){if(!(n=new S(e[i])).s){o=n;break}t.call(o,n)&&(o=n)}return o}function z(e,t,n){for(var i=1,o=t.length;!t[--o];t.pop());for(o=t[0];o>=10;o/=10,i++);return(n=i+n*D-1)>b?e.c=e.e=null:n<g?e.c=[e.e=0]:(e.e=n,e.c=t),e}function j(e,t,n,i){var o,a,r,s,l,d,c,u=e.c,h=P;if(u){e:{for(o=1,s=u[0];s>=10;s/=10,o++);if((a=t-o)<0)a+=D,r=t,c=(l=u[d=0])/h[o-r-1]%10|0;else if((d=B((a+1)/D))>=u.length){if(!i)break e;for(;u.length<=d;u.push(0));l=c=0,o=1,r=(a%=D)-D+1}else{for(l=s=u[d],o=1;s>=10;s/=10,o++);c=(r=(a%=D)-D+o)<0?0:l/h[o-r-1]%10|0}if(i=i||t<0||null!=u[d+1]||(r<0?l:l%h[o-r-1]),i=n<4?(c||i)&&(0==n||n==(e.s<0?3:2)):c>5||5==c&&(4==n||i||6==n&&(a>0?r>0?l/h[o-r]:0:u[d-1])%10&1||n==(e.s<0?8:7)),t<1||!u[0])return u.length=0,i?(t-=e.e+1,u[0]=h[(D-t%D)%D],e.e=-t||0):u[0]=e.e=0,e;if(0==a?(u.length=d,s=1,d--):(u.length=d+1,s=h[D-a],u[d]=r>0?L(l/h[o-r]%h[r])*s:0),i)for(;;){if(0==d){for(a=1,r=u[0];r>=10;r/=10,a++);for(r=u[0]+=s,s=1;r>=10;r/=10,s++);a!=s&&(e.e++,u[0]==M&&(u[0]=1));break}if(u[d]+=s,u[d]!=M)break;u[d--]=0,s=1}for(a=u.length;0===u[--a];u.pop());}e.e>b?e.c=e.e=null:e.e<g&&(e.c=[e.e=0])}return e}function $(e){var t,n=e.e;return null===n?e.toString():(t=q(e.c),t=n<=y||n>=v?K(t,n):G(t,n,"0"),e.s<0?"-"+t:t)}return S.clone=e,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(N+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(W(n=e[t],0,R,t),f=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(W(n=e[t],0,8,t),p=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(W(n[0],-R,0,t),W(n[1],0,R,t),y=n[0],v=n[1]):(W(n,-R,R,t),y=-(v=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)W(n[0],-R,-1,t),W(n[1],1,R,t),g=n[0],b=n[1];else{if(W(n,-R,R,t),!n)throw Error(N+t+" cannot be zero: "+n);g=-(b=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(N+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw w=!n,Error(N+"crypto unavailable");w=n}else w=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(W(n=e[t],0,9,t),_=n),e.hasOwnProperty(t="POW_PRECISION")&&(W(n=e[t],0,R,t),k=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(N+t+" not an object: "+n);E=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(N+t+" invalid: "+n);T="0123456789"==n.slice(0,10),I=n}}return{DECIMAL_PLACES:f,ROUNDING_MODE:p,EXPONENTIAL_AT:[y,v],RANGE:[g,b],CRYPTO:w,MODULO_MODE:_,POW_PRECISION:k,FORMAT:E,ALPHABET:I}},S.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!S.DEBUG)return!0;var t,n,i=e.c,o=e.e,a=e.s;e:if("[object Array]"=={}.toString.call(i)){if((1===a||-1===a)&&o>=-R&&o<=R&&o===L(o)){if(0===i[0]){if(0===o&&1===i.length)return!0;break e}if((t=(o+1)%D)<1&&(t+=D),String(i[0]).length==t){for(t=0;t<i.length;t++)if((n=i[t])<0||n>=M||n!==L(n))break e;if(0!==n)return!0}}}else if(null===i&&null===o&&(null===a||1===a||-1===a))return!0;throw Error(N+"Invalid BigNumber: "+e)},S.maximum=S.max=function(){return V(arguments,h.lt)},S.minimum=S.min=function(){return V(arguments,h.gt)},S.random=(a=9007199254740992,r=Math.random()*a&2097151?function(){return L(Math.random()*a)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,i,o,a,s=0,l=[],d=new S(m);if(null==e?e=f:W(e,0,R),o=B(e/D),w)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));s<o;)(a=131072*t[s]+(t[s+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[s]=n[0],t[s+1]=n[1]):(l.push(a%1e14),s+=2);s=o/2}else{if(!crypto.randomBytes)throw w=!1,Error(N+"crypto unavailable");for(t=crypto.randomBytes(o*=7);s<o;)(a=281474976710656*(31&t[s])+1099511627776*t[s+1]+4294967296*t[s+2]+16777216*t[s+3]+(t[s+4]<<16)+(t[s+5]<<8)+t[s+6])>=9e15?crypto.randomBytes(7).copy(t,s):(l.push(a%1e14),s+=7);s=o/7}if(!w)for(;s<o;)(a=r())<9e15&&(l[s++]=a%1e14);for(o=l[--s],e%=D,o&&e&&(a=P[D-e],l[s]=L(o/a)*a);0===l[s];l.pop(),s--);if(s<0)l=[i=0];else{for(i=-1;0===l[0];l.splice(0,1),i-=D);for(s=1,a=l[0];a>=10;a/=10,s++);s<D&&(i-=D-s)}return d.e=i,d.c=l,d}),S.sum=function(){for(var e=1,t=arguments,n=new S(t[0]);e<t.length;)n=n.plus(t[e++]);return n},i=function(){var e="0123456789";function t(e,t,n,i){for(var o,a,r=[0],s=0,l=e.length;s<l;){for(a=r.length;a--;r[a]*=t);for(r[0]+=i.indexOf(e.charAt(s++)),o=0;o<r.length;o++)r[o]>n-1&&(null==r[o+1]&&(r[o+1]=0),r[o+1]+=r[o]/n|0,r[o]%=n)}return r.reverse()}return function(i,o,a,r,s){var l,d,c,u,h,m,y,v,g=i.indexOf("."),b=f,w=p;for(g>=0&&(u=k,k=0,i=i.replace(".",""),m=(v=new S(o)).pow(i.length-g),k=u,v.c=t(G(q(m.c),m.e,"0"),10,a,e),v.e=v.c.length),c=u=(y=t(i,o,a,s?(l=I,e):(l=e,I))).length;0==y[--u];y.pop());if(!y[0])return l.charAt(0);if(g<0?--c:(m.c=y,m.e=c,m.s=r,y=(m=n(m,v,b,w,a)).c,h=m.r,c=m.e),g=y[d=c+b+1],u=a/2,h=h||d<0||null!=y[d+1],h=w<4?(null!=g||h)&&(0==w||w==(m.s<0?3:2)):g>u||g==u&&(4==w||h||6==w&&1&y[d-1]||w==(m.s<0?8:7)),d<1||!y[0])i=h?G(l.charAt(1),-b,l.charAt(0)):l.charAt(0);else{if(y.length=d,h)for(--a;++y[--d]>a;)y[d]=0,d||(++c,y=[1].concat(y));for(u=y.length;!y[--u];);for(g=0,i="";g<=u;i+=l.charAt(y[g++]));i=G(i,c,l.charAt(0))}return i}}(),n=function(){function e(e,t,n){var i,o,a,r,s=0,l=e.length,d=t%F,c=t/F|0;for(e=e.slice();l--;)s=((o=d*(a=e[l]%F)+(i=c*a+(r=e[l]/F|0)*d)%F*F+s)/n|0)+(i/F|0)+c*r,e[l]=o%n;return s&&(e=[s].concat(e)),e}function t(e,t,n,i){var o,a;if(n!=i)a=n>i?1:-1;else for(o=a=0;o<n;o++)if(e[o]!=t[o]){a=e[o]>t[o]?1:-1;break}return a}function n(e,t,n,i){for(var o=0;n--;)e[n]-=o,o=e[n]<t[n]?1:0,e[n]=o*i+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(i,o,a,r,s){var l,d,c,u,h,m,f,p,y,v,g,b,w,_,k,E,I,T=i.s==o.s?1:-1,A=i.c,C=o.c;if(!(A&&A[0]&&C&&C[0]))return new S(i.s&&o.s&&(A?!C||A[0]!=C[0]:C)?A&&0==A[0]||!C?0*T:T/0:NaN);for(y=(p=new S(T)).c=[],T=a+(d=i.e-o.e)+1,s||(s=M,d=O(i.e/D)-O(o.e/D),T=T/D|0),c=0;C[c]==(A[c]||0);c++);if(C[c]>(A[c]||0)&&d--,T<0)y.push(1),u=!0;else{for(_=A.length,E=C.length,c=0,T+=2,(h=L(s/(C[0]+1)))>1&&(C=e(C,h,s),A=e(A,h,s),E=C.length,_=A.length),w=E,g=(v=A.slice(0,E)).length;g<E;v[g++]=0);I=C.slice(),I=[0].concat(I),k=C[0],C[1]>=s/2&&k++;do{if(h=0,(l=t(C,v,E,g))<0){if(b=v[0],E!=g&&(b=b*s+(v[1]||0)),(h=L(b/k))>1)for(h>=s&&(h=s-1),f=(m=e(C,h,s)).length,g=v.length;1==t(m,v,f,g);)h--,n(m,E<f?I:C,f,s),f=m.length,l=1;else 0==h&&(l=h=1),f=(m=C.slice()).length;if(f<g&&(m=[0].concat(m)),n(v,m,g,s),g=v.length,-1==l)for(;t(C,v,E,g)<1;)h++,n(v,E<g?I:C,g,s),g=v.length}else 0===l&&(h++,v=[0]);y[c++]=h,v[0]?v[g++]=A[w]||0:(v=[A[w]],g=1)}while((w++<_||null!=v[0])&&T--);u=null!=v[0],y[0]||y.splice(0,1)}if(s==M){for(c=1,T=y[0];T>=10;T/=10,c++);j(p,a+(p.e=c+d*D-1)+1,r,u)}else p.e=d,p.r=+u;return p}}(),s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,l=/^([^.]+)\.$/,d=/^\.([^.]+)$/,c=/^-?(Infinity|NaN)$/,u=/^\s*\+(?=[\w.])|^\s+|\s+$/g,o=function(e,t,n,i){var o,a=n?t:t.replace(u,"");if(c.test(a))e.s=isNaN(a)?null:a<0?-1:1;else{if(!n&&(a=a.replace(s,(function(e,t,n){return o="x"==(n=n.toLowerCase())?16:"b"==n?2:8,i&&i!=o?e:t})),i&&(o=i,a=a.replace(l,"$1").replace(d,"0.$1")),t!=a))return new S(a,o);if(S.DEBUG)throw Error(N+"Not a"+(i?" base "+i:"")+" number: "+t);e.s=null}e.c=e.e=null},h.absoluteValue=h.abs=function(){var e=new S(this);return e.s<0&&(e.s=1),e},h.comparedTo=function(e,t){return H(this,new S(e,t))},h.decimalPlaces=h.dp=function(e,t){var n,i,o,a=this;if(null!=e)return W(e,0,R),null==t?t=p:W(t,0,8),j(new S(a),e+a.e+1,t);if(!(n=a.c))return null;if(i=((o=n.length-1)-O(this.e/D))*D,o=n[o])for(;o%10==0;o/=10,i--);return i<0&&(i=0),i},h.dividedBy=h.div=function(e,t){return n(this,new S(e,t),f,p)},h.dividedToIntegerBy=h.idiv=function(e,t){return n(this,new S(e,t),0,1)},h.exponentiatedBy=h.pow=function(e,t){var n,i,o,a,r,s,l,d,c=this;if((e=new S(e)).c&&!e.isInteger())throw Error(N+"Exponent not an integer: "+$(e));if(null!=t&&(t=new S(t)),r=e.e>14,!c.c||!c.c[0]||1==c.c[0]&&!c.e&&1==c.c.length||!e.c||!e.c[0])return d=new S(Math.pow(+$(c),r?2-Y(e):+$(e))),t?d.mod(t):d;if(s=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new S(NaN);(i=!s&&c.isInteger()&&t.isInteger())&&(c=c.mod(t))}else{if(e.e>9&&(c.e>0||c.e<-1||(0==c.e?c.c[0]>1||r&&c.c[1]>=24e7:c.c[0]<8e13||r&&c.c[0]<=9999975e7)))return a=c.s<0&&Y(e)?-0:0,c.e>-1&&(a=1/a),new S(s?1/a:a);k&&(a=B(k/D+2))}for(r?(n=new S(.5),s&&(e.s=1),l=Y(e)):l=(o=Math.abs(+$(e)))%2,d=new S(m);;){if(l){if(!(d=d.times(c)).c)break;a?d.c.length>a&&(d.c.length=a):i&&(d=d.mod(t))}if(o){if(0===(o=L(o/2)))break;l=o%2}else if(j(e=e.times(n),e.e+1,1),e.e>14)l=Y(e);else{if(0==(o=+$(e)))break;l=o%2}c=c.times(c),a?c.c&&c.c.length>a&&(c.c.length=a):i&&(c=c.mod(t))}return i?d:(s&&(d=m.div(d)),t?d.mod(t):a?j(d,k,p,void 0):d)},h.integerValue=function(e){var t=new S(this);return null==e?e=p:W(e,0,8),j(t,t.e+1,e)},h.isEqualTo=h.eq=function(e,t){return 0===H(this,new S(e,t))},h.isFinite=function(){return!!this.c},h.isGreaterThan=h.gt=function(e,t){return H(this,new S(e,t))>0},h.isGreaterThanOrEqualTo=h.gte=function(e,t){return 1===(t=H(this,new S(e,t)))||0===t},h.isInteger=function(){return!!this.c&&O(this.e/D)>this.c.length-2},h.isLessThan=h.lt=function(e,t){return H(this,new S(e,t))<0},h.isLessThanOrEqualTo=h.lte=function(e,t){return-1===(t=H(this,new S(e,t)))||0===t},h.isNaN=function(){return!this.s},h.isNegative=function(){return this.s<0},h.isPositive=function(){return this.s>0},h.isZero=function(){return!!this.c&&0==this.c[0]},h.minus=function(e,t){var n,i,o,a,r=this,s=r.s;if(t=(e=new S(e,t)).s,!s||!t)return new S(NaN);if(s!=t)return e.s=-t,r.plus(e);var l=r.e/D,d=e.e/D,c=r.c,u=e.c;if(!l||!d){if(!c||!u)return c?(e.s=-t,e):new S(u?r:NaN);if(!c[0]||!u[0])return u[0]?(e.s=-t,e):new S(c[0]?r:3==p?-0:0)}if(l=O(l),d=O(d),c=c.slice(),s=l-d){for((a=s<0)?(s=-s,o=c):(d=l,o=u),o.reverse(),t=s;t--;o.push(0));o.reverse()}else for(i=(a=(s=c.length)<(t=u.length))?s:t,s=t=0;t<i;t++)if(c[t]!=u[t]){a=c[t]<u[t];break}if(a&&(o=c,c=u,u=o,e.s=-e.s),(t=(i=u.length)-(n=c.length))>0)for(;t--;c[n++]=0);for(t=M-1;i>s;){if(c[--i]<u[i]){for(n=i;n&&!c[--n];c[n]=t);--c[n],c[i]+=M}c[i]-=u[i]}for(;0==c[0];c.splice(0,1),--d);return c[0]?z(e,c,d):(e.s=3==p?-1:1,e.c=[e.e=0],e)},h.modulo=h.mod=function(e,t){var i,o,a=this;return e=new S(e,t),!a.c||!e.s||e.c&&!e.c[0]?new S(NaN):!e.c||a.c&&!a.c[0]?new S(a):(9==_?(o=e.s,e.s=1,i=n(a,e,0,3),e.s=o,i.s*=o):i=n(a,e,0,_),(e=a.minus(i.times(e))).c[0]||1!=_||(e.s=a.s),e)},h.multipliedBy=h.times=function(e,t){var n,i,o,a,r,s,l,d,c,u,h,m,f,p,y,v=this,g=v.c,b=(e=new S(e,t)).c;if(!(g&&b&&g[0]&&b[0]))return!v.s||!e.s||g&&!g[0]&&!b||b&&!b[0]&&!g?e.c=e.e=e.s=null:(e.s*=v.s,g&&b?(e.c=[0],e.e=0):e.c=e.e=null),e;for(i=O(v.e/D)+O(e.e/D),e.s*=v.s,(l=g.length)<(u=b.length)&&(f=g,g=b,b=f,o=l,l=u,u=o),o=l+u,f=[];o--;f.push(0));for(p=M,y=F,o=u;--o>=0;){for(n=0,h=b[o]%y,m=b[o]/y|0,a=o+(r=l);a>o;)n=((d=h*(d=g[--r]%y)+(s=m*d+(c=g[r]/y|0)*h)%y*y+f[a]+n)/p|0)+(s/y|0)+m*c,f[a--]=d%p;f[a]=n}return n?++i:f.splice(0,1),z(e,f,i)},h.negated=function(){var e=new S(this);return e.s=-e.s||null,e},h.plus=function(e,t){var n,i=this,o=i.s;if(t=(e=new S(e,t)).s,!o||!t)return new S(NaN);if(o!=t)return e.s=-t,i.minus(e);var a=i.e/D,r=e.e/D,s=i.c,l=e.c;if(!a||!r){if(!s||!l)return new S(o/0);if(!s[0]||!l[0])return l[0]?e:new S(s[0]?i:0*o)}if(a=O(a),r=O(r),s=s.slice(),o=a-r){for(o>0?(r=a,n=l):(o=-o,n=s),n.reverse();o--;n.push(0));n.reverse()}for((o=s.length)-(t=l.length)<0&&(n=l,l=s,s=n,t=o),o=0;t;)o=(s[--t]=s[t]+l[t]+o)/M|0,s[t]=M===s[t]?0:s[t]%M;return o&&(s=[o].concat(s),++r),z(e,s,r)},h.precision=h.sd=function(e,t){var n,i,o,a=this;if(null!=e&&e!==!!e)return W(e,1,R),null==t?t=p:W(t,0,8),j(new S(a),e,t);if(!(n=a.c))return null;if(i=(o=n.length-1)*D+1,o=n[o]){for(;o%10==0;o/=10,i--);for(o=n[0];o>=10;o/=10,i++);}return e&&a.e+1>i&&(i=a.e+1),i},h.shiftedBy=function(e){return W(e,-9007199254740991,U),this.times("1e"+e)},h.squareRoot=h.sqrt=function(){var e,t,i,o,a,r=this,s=r.c,l=r.s,d=r.e,c=f+4,u=new S("0.5");if(1!==l||!s||!s[0])return new S(!l||l<0&&(!s||s[0])?NaN:s?r:1/0);if(0==(l=Math.sqrt(+$(r)))||l==1/0?(((t=q(s)).length+d)%2==0&&(t+="0"),l=Math.sqrt(+t),d=O((d+1)/2)-(d<0||d%2),i=new S(t=l==1/0?"5e"+d:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+d)):i=new S(l+""),i.c[0])for((l=(d=i.e)+c)<3&&(l=0);;)if(a=i,i=u.times(a.plus(n(r,a,c,1))),q(a.c).slice(0,l)===(t=q(i.c)).slice(0,l)){if(i.e<d&&--l,"9999"!=(t=t.slice(l-3,l+1))&&(o||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(j(i,i.e+f+2,1),e=!i.times(i).eq(r));break}if(!o&&(j(a,a.e+f+2,0),a.times(a).eq(r))){i=a;break}c+=4,l+=4,o=1}return j(i,i.e+f+1,p,e)},h.toExponential=function(e,t){return null!=e&&(W(e,0,R),e++),A(this,e,t,1)},h.toFixed=function(e,t){return null!=e&&(W(e,0,R),e=e+this.e+1),A(this,e,t)},h.toFormat=function(e,t,n){var i,o=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=E;else if("object"!=typeof n)throw Error(N+"Argument not an object: "+n);if(i=o.toFixed(e,t),o.c){var a,r=i.split("."),s=+n.groupSize,l=+n.secondaryGroupSize,d=n.groupSeparator||"",c=r[0],u=r[1],h=o.s<0,m=h?c.slice(1):c,f=m.length;if(l&&(a=s,s=l,l=a,f-=a),s>0&&f>0){for(a=f%s||s,c=m.substr(0,a);a<f;a+=s)c+=d+m.substr(a,s);l>0&&(c+=d+m.slice(a)),h&&(c="-"+c)}i=u?c+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?u.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):u):c}return(n.prefix||"")+i+(n.suffix||"")},h.toFraction=function(e){var t,i,o,a,r,s,l,d,c,u,h,f,y=this,v=y.c;if(null!=e&&(!(l=new S(e)).isInteger()&&(l.c||1!==l.s)||l.lt(m)))throw Error(N+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+$(l));if(!v)return new S(y);for(t=new S(m),c=i=new S(m),o=d=new S(m),f=q(v),r=t.e=f.length-y.e-1,t.c[0]=P[(s=r%D)<0?D+s:s],e=!e||l.comparedTo(t)>0?r>0?t:c:l,s=b,b=1/0,l=new S(f),d.c[0]=0;u=n(l,t,0,1),1!=(a=i.plus(u.times(o))).comparedTo(e);)i=o,o=a,c=d.plus(u.times(a=c)),d=a,t=l.minus(u.times(a=t)),l=a;return a=n(e.minus(i),o,0,1),d=d.plus(a.times(c)),i=i.plus(a.times(o)),d.s=c.s=y.s,h=n(c,o,r*=2,p).minus(y).abs().comparedTo(n(d,i,r,p).minus(y).abs())<1?[c,o]:[d,i],b=s,h},h.toNumber=function(){return+$(this)},h.toPrecision=function(e,t){return null!=e&&W(e,1,R),A(this,e,t,2)},h.toString=function(e){var t,n=this,o=n.s,a=n.e;return null===a?o?(t="Infinity",o<0&&(t="-"+t)):t="NaN":(null==e?t=a<=y||a>=v?K(q(n.c),a):G(q(n.c),a,"0"):10===e&&T?t=G(q((n=j(new S(n),f+a+1,p)).c),n.e,"0"):(W(e,2,I.length,"Base"),t=i(G(q(n.c),a,"0"),10,e,o,!0)),o<0&&n.c[0]&&(t="-"+t)),t},h.valueOf=h.toJSON=function(){return $(this)},h._isBigNumber=!0,h[Symbol.toStringTag]="BigNumber",h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf,null!=t&&S.set(t),S}();const z=V,j=function(e,t){let n=parseInt("1"+"0".repeat(t));return Math.round(e*n)/n},$=function(e){return new z(Math.round(100*e.toNumber())/100)},Q=function(e,t){let n=parseInt("1"+"0".repeat(t));return new z(Math.round(e.toNumber()*n)/n)},J="0x0000000000000000000000000000000000000000",Z=function(e){return e?e.substring(0,6)+"..."+e.substring(e.length-4):""};var X=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class ee{constructor(e){e||(e=Moralis),this.moralis=e}logOut(){return this.moralis.User.logOut()}isLoggedIn(e){return X(this,void 0,void 0,(function*(){let t=yield this.moralis.User.currentAsync(),n=new _(this.moralis);if(!function(){try{return"undefined"!=typeof ethereum}catch(e){return!1}}())return n.isWebview(window.navigator.userAgent)&&function(e){let t=document.querySelector("header");if(!t)return;t.insertAdjacentHTML("beforebegin",'<div class="errorBar">If you are using Metamask, you need to close this tab and open new tab to connect.</div>')}(),void(t&&this.logOut());let i=new o(document).getCookieValue("provider");if(n.isWebview(window.navigator.userAgent)&&(i=" "),!i)return;if(!this.moralis.isWeb3Enabled()){let t="We are sending login request to your wallet. If you cancel we will simply log you out. You can always log again in.";t+='<button id="logoutButton">Logout</button>',e.innerHTML=t;let n=document.getElementById("logoutButton");if(null==n||n.addEventListener("click",(()=>{this.moralis.User.logOut(),location.reload()})),!(yield this.moralis.enableWeb3({provider:i,appLogo:"https://app.liminal.market/img/logos/default_logo.png"}).catch((e=>X(this,void 0,void 0,(function*(){b.report(e)}))))))return}let a=new A(null),r=new S(this.moralis);return yield r.authenticateUser(i,(e=>{a=new A(e)})),t.providerInfo=a,t}))}isMarketOpenOrUserOffHours(){return X(this,void 0,void 0,(function*(){let e=new d(this.moralis);return!!(yield e.isMarketOpen())||(s.getInstance().TestNetwork,!1)}))}getUser(){return this.moralis.User.current()}getAlpacaId(){return X(this,void 0,void 0,(function*(){let e=this.getUser();return e?(yield e.fetch()).get("alpacaId").toString():""}))}getAccount(){return X(this,void 0,void 0,(function*(){if(this.getUser())return yield this.moralis.Cloud.run("account")}))}getEthAddress(){var e;return null===(e=this.getUser())||void 0===e?void 0:e.get("ethAddress")}kycActionRequired(){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("kycActionRequired")}))}updateName(e,t,n){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("updateName",{given_name:e,middle_name:t,family_name:n})}))}updateContact(e){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("updateContact",e)}))}updateTrustedContact(e){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("updateTrustedContact",e)}))}createAchRelationship(e,t){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("createAchRelationship",{public_token:e,account_id:t})}))}getPlaidLinkToken(){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("createPlaidLinkToken")}))}getBankRelationship(){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("getBankRelationship")}))}getLatestTransfers(e){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("getTransfers",{direction:e})}))}createTransfer(e,t){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("createTransfer",{amount:e,direction:t})}))}deleteTransfer(e){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("deleteTransfer",{id:e})}))}registerWireTransferRelationship(e){return X(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("createWireRelationship",e)}))}}class te{constructor(){this.KYC_ADDRESS="0x172A9DA328BC71f4354f4f17Db5630552cC9420d",this.AUSD_ADDRESS="0xCd40ae7648E53B92e338CCaAF78734397D2Fe2A4",this.LIMINAL_MARKET_ADDRESS="0x54eb4fA482d50e0369D333193De804898317A2A5",this.MARKET_CALENDAR_ADDRESS="0xF5A39660A894698074593A5B1fBd33697dCa4091"}}class ne{constructor(){this.KYC_ADDRESS="0x9e2B28D9F841300bE3B64e505dEcA36c35250609",this.AUSD_ADDRESS="0x38F2B1E9F11937dD276D64521535b15280A7F137",this.LIMINAL_MARKET_ADDRESS="0x6e9C29e416dc9F7A6A03ffebaB3f02Ef62a1baE4",this.MARKET_CALENDAR_ADDRESS="0xc6B29dfd4FD756EF94b3A3FF7a531F4467BDDA75"}}class ie{constructor(){this.KYC_ADDRESS="0x0594D04FDB5C98Fb7F777a799139424Ae2414AaD",this.AUSD_ADDRESS="0xbAc482aE0b0d652854df377be566445984A021ED",this.LIMINAL_MARKET_ADDRESS="0x098A512B017408008a23ECe22843788799CDebFd",this.MARKET_CALENDAR_ADDRESS="0x77E6A62Be8398B18d2dA81CDB6Eb097bD8132ccB"}}class oe{constructor(){this.KYC_ADDRESS="0xc7dA98E282cc30BD4fe0a7dE38372F876DB577E4",this.AUSD_ADDRESS="0x9B780e71C2a8492E805e17616EB878f2e3874E21",this.LIMINAL_MARKET_ADDRESS="0x8B4fc0bcaED76a6569525d8Fe51E57cAd32FDd94",this.MARKET_CALENDAR_ADDRESS="0x77b54CbF3e1370af13da41196B4d99cd02eBcC44"}}class ae{static getContractInfo(e){let t={localhostContractAddresses:te,mumbaiContractAddresses:ne,fujiContractAddresses:ie,polygonContractAddresses:oe};return e||(e=s.getInstance().Name),new(0,t[e+"ContractAddresses"])}}class re{static isOlderThen(e,t){return(new Date).getTime()>e.getTime()+60*t*1e3}static getWeekday(){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(new Date).getDay()]}static getOpenAndCloseHours(){const e=new Date;return[13+e.getTimezoneOffset()/60*-1+":30",20+e.getTimezoneOffset()/60*-1+":00"]}}class se extends c{constructor(e){if(super(e),this.message=e.toString(),this.userDeniedTransactionSignature()?this.code=se.UserCancelled:this.addressIsNotValidKYC()?this.code=se.AddressIsNotValidKYC:this.isMarketClosed()&&(this.code=se.MarketIsClosed,this.callback=this.marketIsClosedModal),e.data&&e.data.message){let t=e.data.message,n="reverted with reason string",i=t.indexOf(n)+n.length;-1!=i&&(this.message=t.substring(i).trim().replace(/'/g,""),this.code=se.ErrorFromContract)}}userDeniedTransactionSignature(){return-1!==this.message.indexOf("denied transaction signature")}addressIsNotValidKYC(){return-1!==this.message.indexOf("address is not kyc valid")}isMarketClosed(){return-1!==this.message.indexOf("Market is closed")}marketIsClosedModal(){let[e,t]=re.getOpenAndCloseHours(),n=(new Date).toTimeString().split(" "),i={currentTime:n[0],GMT:n[1],dayOfWeek:re.getWeekday(),openFrom:e,openTo:t},o=new u,a=Handlebars.compile('<div class="center"> The stock market is currently closed.<br/> It is usually open monday to friday between 9:30 AM and 4:00 PM EST (9:30 - 16:00 EST). <br/><br/> Today is {{dayOfWeek}} <br/><br/> Your current time is {{currentTime}} ({{GMT}}) <br/><br/> That means the market is open your time between {{openFrom}} - {{openTo}} </div>');o.showModal("Market is closed",a(i))}}se.ErrorFromContract=-1,se.UserCancelled=1,se.AddressIsNotValidKYC=2,se.MarketIsClosed=3;class le{constructor(e){this.moralis=e}executeFunction(e){return t=this,n=void 0,o=function*(){if("undefined"!=typeof ethereum&&ethereum&&ethereum.chainId&&!s.getNetworkInfoByChainId(ethereum.chainId))throw new c("chain not supported");return yield this.moralis.executeFunction(e)},new((i=void 0)||(i=Promise))((function(e,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}}var de=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class ce extends le{constructor(e){super(e)}getSymbolContractAddress(e){return de(this,void 0,void 0,(function*(){const t=yield this.getOptions("getSecurityToken",{symbol:e});return yield this.executeFunction(t).then((e=>e.toString())).catch((e=>{let t=new se(e);throw b.report(t)}))}))}getOptions(e,t){return de(this,void 0,void 0,(function*(){let n=ae.getContractInfo(),i=yield this.getLiminalMarketAbi();return{contractAddress:n.LIMINAL_MARKET_ADDRESS,functionName:e,abi:i,params:t}}))}getLiminalMarketAbi(){return de(this,void 0,void 0,(function*(){if(ce.LiminalMarketInfo)return ce.LiminalMarketInfo.abi;let e=yield fetch("../abi/LiminalMarket.json");return ce.LiminalMarketInfo=yield e.json(),ce.LiminalMarketInfo.abi}))}createToken(e,t){return de(this,void 0,void 0,(function*(){let n=((new Date).getTime()+1e5*Math.random()).toString();n=n.substring(0,n.indexOf("."));const i=yield this.getOptions("createToken",{symbol:e,salt:n});let o=yield this.executeFunction(i).then((e=>e)).catch((e=>{let t=new se(e);if(t.userDeniedTransactionSignature())return t;throw b.report(t)}));return o instanceof se?o:(t(),yield o.wait(),yield this.getSymbolContractAddress(e))}))}}const ue='{{#each securities}} <tr data-symbol="{{{Symbol}}}" data-logo="{{LogoPath}}{{Logo}}" data-name="{{Name}}"> <td class="symbol_logo"><img src="{{LogoPath}}{{Logo}}"/></td> <td class="security_information"> <strong>{{Name}}</strong><br/> <nav class="security_extra"> <ul> <li> <a href="https://strike.market/stocks/{{Symbol}}" target="_blank">{{Symbol}}</a> </li> </ul> <ul> <li> <a href="" class="getAddress" data-symbol="{{Symbol}}">Get address</a> </li> </ul> <ul> <li> <a href="" class="addToWallet" data-symbol="{{Symbol}}">Add to wallet</a> </li> </ul> </nav> </td> </tr> {{/each}}';class he{fallbackCopyTextToClipboard(e){let t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{return document.execCommand("copy")}catch(e){return console.error(e),!1}finally{document.body.removeChild(t)}}copyTextToClipboard(e){return t=this,n=void 0,o=function*(){if(!navigator.clipboard)return this.fallbackCopyTextToClipboard(e);let t=yield navigator.clipboard.writeText(e).then((e=>(console.log("ble",e),!0))).catch((function(e){return console.info(e),!1}));return console.log(t),t},new((i=void 0)||(i=Promise))((function(e,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}}const me='<article id="symbolInfoToCopy"> This is the address for the symbol {{symbol}}. <br/> <input value="{{address}}"/> </article> ',fe='<tr id="symbolInfoToCopy"> <td colspan="4"> <article> Some wallets detect automatically the coins that are registered to your address. Those that don\'t do automatic detection, you need to add them manually. <br/><br/> This is the address for the symbol {{symbol}}, you need to copy it and import the token in your wallet <br/> <input value="{{address}}"/> </article> </td> </tr>';var pe=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class ye{constructor(){this.tbodyId="liminal_market_securities_list",this.onSelectSymbol=void 0,this.page=0,this.loadmore=!0}render(){return pe(this,void 0,void 0,(function*(){let e=yield p.getInstance(),t=e.securitiesArray.length,n=yield e.getPaginatingSecurities(this.page++);return Handlebars.registerPartial("securities",ue),Handlebars.compile('<figure> <table id="liminal_market_securities_table" role="grid"> <thead> <tr> <th colspan="2"><input autocomplete="off" type="search" id="search_for_symbol" placeholder="Search for name or symbol in {{securitiesCount}} stocks"></th> </tr> </thead> <tbody id="{{tbodyId}}"> {{>securities}} </tbody> </table> <span id="liminal_market_load_more"></span> </figure>')({tbodyId:this.tbodyId,securities:n,securitiesCount:t})}))}bindEvents(e){return pe(this,void 0,void 0,(function*(){this.bindOnClickEvent(e),yield this.bindSearchEvent(),this.bindLoadMore()}))}bindOnClickEvent(e){let t=document.getElementById("liminal_market_securities_table");t?(this.onSelectSymbol=e,t.onclick=e=>pe(this,void 0,void 0,(function*(){yield this.handleClick(e)}))):b.report(new c("Page could not load correctly, try reloading"))}handleClick(e){return pe(this,void 0,void 0,(function*(){let t=e.target;if("a"===t.tagName.toLocaleLowerCase())return void(yield this.addToWalletOrGetAddress(e,t));let n=t.parentElement;if(!n)return;"tr"!==n.tagName.toLocaleLowerCase()&&(n=n.parentElement);let i=n.dataset.symbol;if(!i)return;let o=n.dataset.name,a=n.dataset.logo;this.onSelectSymbol&&this.onSelectSymbol(i,o,a)}))}bindSearchEvent(){return pe(this,void 0,void 0,(function*(){let e=document.getElementById("search_for_symbol");if(!e)return;let t=yield p.getInstance(),n=null;e.addEventListener("keyup",(e=>pe(this,void 0,void 0,(function*(){null!=n&&clearTimeout(n),n=setTimeout((()=>pe(this,void 0,void 0,(function*(){let n=e.target.value;if(!n||n.length<2)return this.loadmore=!0,void(yield this.showTopSecurities(t));this.loadmore=!1;let i=yield t.find(n);this.loadSecuritiesToDom(i)}))),500)}))))}))}showTopSecurities(e){return pe(this,void 0,void 0,(function*(){let t=yield e.getTopSecurities();this.loadSecuritiesToDom(t)}))}loadSecuritiesToDom(e){let t=document.getElementById(this.tbodyId);if(!t)return;let n=Handlebars.compile(ue)({securities:e});t.innerHTML=n}bindLoadMore(){const e=document.querySelector("#liminal_market_load_more");new window.IntersectionObserver((([e])=>pe(this,void 0,void 0,(function*(){e.isIntersecting&&(yield this.loadMore())}))),{root:null,threshold:.1}).observe(e)}loadMore(){return pe(this,void 0,void 0,(function*(){if(!this.loadmore)return;let e=document.getElementById(this.tbodyId);if(!e)return;let t=yield p.getInstance(),n=yield t.getPaginatingSecurities(this.page++),i=Handlebars.compile(ue)({securities:n});e.insertAdjacentHTML("beforeend",i)}))}addToWalletOrGetAddress(e,t){return pe(this,void 0,void 0,(function*(){let n=t.className;if("getAddress"!=n&&"addToWallet"!=n)return;e.preventDefault(),e.stopPropagation();let i=t.dataset.symbol;if(!i)return;y.setLoading(t);let o=new ce(Moralis),a=yield o.getSymbolContractAddress(i);"getAddress"==n?yield this.showGetAddress(t,i,a):yield this.showAddToWallet(t,i,a),y.removeLoading()}))}showGetAddress(e,t,n){return pe(this,void 0,void 0,(function*(){if(n!==J){let t=new he;if(yield t.copyTextToClipboard(n))return void(e.innerText="Copied")}this.renderContractInfoToString(e,n,t,me)}))}showAddToWallet(e,t,n){return pe(this,void 0,void 0,(function*(){if(n!==J){let i=new _(Moralis);if(yield i.addTokenToWallet(n,t,(()=>{y.removeLoading(),this.renderContractInfoToString(e,n,t,fe)})))return""}this.renderContractInfoToString(e,n,t,fe)}))}renderContractInfoToString(e,t,n,i){let o=document.getElementById("symbolInfoToCopy");o&&o.remove();let a="";a=t===J?Handlebars.compile('<tr id="symbolInfoToCopy"> <td colspan="4"> <article> This symbol has never been bought and does not exist. Buy this symbol and address will become available. </article> </td> </tr>')(null):Handlebars.compile(me)({symbol:n,address:t}),e.parentElement.parentElement.parentElement.insertAdjacentHTML("afterend",a)}}class ve{static isNullOrEmpty(e){return!e||0==e.toString().trim().length}}var ge=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class be{constructor(){this.modal=new u}show(){return ge(this,void 0,void 0,(function*(){let e=document.getElementById("kycEditNameError");e&&(e.style.display="none");let t=new ee(Moralis),n=yield t.getAccount(),i=n.identity.given_name,o=n.identity.middle_name,a=n.identity.family_name,r=Handlebars.compile('<fieldset id="kycEditName"> <div class="warningBar"> <strong>Warning</strong><br/> You can only change the name once. Be careful of what you change. <br/><br/> After you change this information a new KYC process will be started, and you will NOT be able to do any trades until it has been approved. </div> <div> <label for="given_name">Legal First name</label> <input required id="given_name" name="given_name" placeholder="Ron" value="{{given_name}}" autocomplete="given-name"> </div> <div> <label for="middle_name">Legal Middle name</label> <input id="middle_name" name="middle_name" placeholder="" value="{{middle_name}}" autocomplete="additional-name"> </div> <div> <label for="family_name">Legal Last name</label> <input required id="family_name" name="family_name" placeholder="Swanson" value="{{family_name}}" autocomplete="family-name"> </div> <div class="buttons"> <button id="kycEditNameConfirm">Confirm</button> </div> </fieldset> <fieldset class="hidden" id="confirmNameFieldset"> <div class="confirm_name"> <label for="confirm_name" id="label_confirm_name">Please type</label> <input name="confirm_name" id="confirm_name"/> </div> <div class="input_error" id="kycEditNameError"></div> <div class="buttons grid"> <button id="kycEditNameBack">Back</button> <button type="submit" id="kycEditNameSave">Confirm</button> </div> </fieldset>')({given_name:i,middle_name:o,family_name:a});this.modal.showModal("Edit name",r),this.bindEvents()}))}bindEvents(){let e=document.getElementById("kycEditNameConfirm");null==e||e.addEventListener("click",(e=>ge(this,void 0,void 0,(function*(){var e,t;let n=document.getElementById("given_name"),i=(document.getElementById("middle_name"),document.getElementById("family_name"));if(ve.isNullOrEmpty(n.value))return void this.showError("Given name cannot be empty");if(ve.isNullOrEmpty(i.value))return void this.showError("Family name cannot be empty");let o=this.getFullName(),a=document.getElementById("label_confirm_name");a&&(a.innerHTML='Please type in the full name "'+o+'" in the box below to confirm. You WILL NOT be able to change it again.',null===(e=document.getElementById("confirmNameFieldset"))||void 0===e||e.classList.remove("hidden"),null===(t=document.getElementById("kycEditName"))||void 0===t||t.classList.add("hidden"))}))));let t=document.getElementById("kycEditNameBack");null==t||t.addEventListener("click",(e=>{var t,n;null===(t=document.getElementById("confirmNameFieldset"))||void 0===t||t.classList.add("hidden"),null===(n=document.getElementById("kycEditName"))||void 0===n||n.classList.remove("hidden")}));let n=document.getElementById("confirm_name");if(!n)return;let i=document.getElementById("kycEditNameSave");i.disabled=!0,n.setAttribute("aria-invalid","true"),n.addEventListener("keyup",(e=>{n.value==this.getFullName()?(n.setAttribute("aria-invalid","false"),i.disabled=!1):(n.setAttribute("aria-invalid","true"),i.disabled=!0)})),null==i||i.addEventListener("click",(e=>ge(this,void 0,void 0,(function*(){let e=document.getElementById("confirm_name");if(e&&e.value!=this.getFullName())return void alert(e.value+" is not same as "+this.getFullName()+". Go over the name and make sure it is identical");let t=document.getElementById("given_name"),n=document.getElementById("middle_name"),o=document.getElementById("family_name");y.setLoading(i);let a=new ee(Moralis);yield a.updateName(t.value,n.value,o.value).then((e=>{e.message?this.showError(e.message):this.modal.hideModal()})).catch((e=>{e.message?this.showError(JSON.parse(e.message).message):this.showError(e)})).finally((()=>{y.removeLoading()}))}))))}showError(e){let t=document.getElementById("kycEditNameError");t&&(t.innerHTML=e,t.style.display="block")}getFullName(){let e=document.getElementById("given_name"),t=document.getElementById("middle_name"),n=document.getElementById("family_name");return e.value+" "+(ve.isNullOrEmpty(t.value)?"":t.value+" ")+n.value}}class we{static getParams(e){let t=document.querySelector(e);if(!t)return;let n=new FormData(t);return this.serialize(n)}static serialize(e){let t={};for(let[n,i]of e)void 0!==t[n]?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(i)):t[n]=i;return t}static fillInputs(e,t){e.forEach((e=>{let n=document.querySelector("input[name="+e+"]");if(n)"radio"==n.type?(console.log("checkbox",n,t[e]),n.value=t[e]):n.value=t[e],n.dispatchEvent(new Event("change"));else{let n=document.querySelector("select[name="+e+"]");n&&(n.value=t[e],n.dispatchEvent(new Event("change")))}}))}static validate(e){let t=document.querySelectorAll(e+" input[required]");for(let e=0;e<t.length;e++){let n=t[e];if(n.setAttribute("aria-invalid","false"),ve.isNullOrEmpty(n.value))return n.setAttribute("aria-invalid","true"),n.focus(),n.addEventListener("change",(e=>{ve.isNullOrEmpty(n.value)||n.setAttribute("aria-invalid","false")})),!1}return!0}}var _e=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class ke{constructor(){this.modal=new u}show(){return _e(this,void 0,void 0,(function*(){let e=new ee(Moralis),t=yield e.getAccount(),n="USA"==t.identity.country_of_tax_residence,i=Handlebars.compile('<fieldset id="kycEditContactFieldset"> <div class="warningBar"> <strong>Warning</strong><br/> After you change this information a new KYC process will be started, and you will NOT be able to do any trades until it has been approved. </div> <form id="kycEditContactForm"> <div> <label for="email_address">Email</label> <input type="email" required class="form-control" id="email_address" name="email_address" placeholder="name@example.com" autocomplete="email" value=""> </div> <div> <label for="phone_number">Phone</label> <input type="tel" class="form-control" id="phone_number" name="phone_number" placeholder="+1-555-666-7788" autocomplete="tel" value=""> </div> <div> <label for="street_address">Permanent Residential Address</label> <div class="explain">It must be a physical address, not a PO box.</div> <input required id="street_address" name="street_address" placeholder="20 N San Mateo Dr" value="" autocomplete="address-line1"> </div> <div> <label for="unit">Unit / Apt #</label> <input id="unit" name="unit" value=""> </div> <div> <label for="city">City</label> <input id="city" name="city" placeholder="Pawnee" value="" autocomplete="address-level2"> </div> <div> <label for="postal_code">Postal code</label> <input required id="postal_code" autocomplete="postal-code" name="postal_code" placeholder="94401" value=""> </div> {{#if usa}} <div id="state_div"> <label for="state">State (2 letters)</label> <input required maxlength="2" id="state" name="state" placeholder="NY" value="" autocomplete="address-level1"> </div> {{/if}} <div class="input_error" id="kycEditContactError"></div> <div class="buttons"> <button type="submit" id="kycEditContactSave">Save</button> </div> </form> </fieldset>');this.modal.showModal("Edit contact information",i({usa:n}));let o=Object.getOwnPropertyNames(t.contact);we.fillInputs(o,t.contact),this.bindEvents()}))}bindEvents(){let e=document.getElementById("kycEditContactSave");null==e||e.addEventListener("click",(t=>_e(this,void 0,void 0,(function*(){if(t.preventDefault(),!this.validate())return;y.setLoading(e);let n=we.getParams("#kycEditContactForm"),i=new ee(Moralis);yield i.updateContact(n).then((e=>{if(e.message)return void this.showError(e.message);let t=e,n=document.getElementById("email_address");t.contact.email_address==(null==n?void 0:n.value)?this.modal.hideModal():this.showError("Email was not changed. The email "+(null==n?void 0:n.value)+" is already registered under different account.")})).catch((e=>{e.message?this.showError(JSON.parse(e.message).message):this.showError(e)})).finally((()=>{y.removeLoading()}))}))))}showError(e){let t=document.getElementById("kycEditContactError");t&&(t.innerHTML=e,t.style.display="block")}validate(){let e=document.querySelectorAll("#kycEditContactFieldset input[required]");for(let t=0;t<e.length;t++){let n=e[t];if(ve.isNullOrEmpty(n.value))return n.setAttribute("aria-invalid","true"),n.addEventListener("change",(e=>{ve.isNullOrEmpty(n.value)||n.setAttribute("aria-invalid","false")})),!1}return!0}}class Ee{}Ee.Countries=[{name:"United States of America",code:"USA"},{name:"United Kingdom",code:"GBR"},{name:"Afghanistan",code:"AFG"},{name:"Albania",code:"ALB"},{name:"Algeria",code:"DZA"},{name:"American Samoa",code:"ASM"},{name:"Andorra",code:"AND"},{name:"Angola",code:"AGO"},{name:"Anguilla",code:"AIA"},{name:"Antarctica",code:"ATA"},{name:"Antigua and Barbuda",code:"ATG"},{name:"Argentina",code:"ARG"},{name:"Armenia",code:"ARM"},{name:"Aruba",code:"ABW"},{name:"Australia",code:"AUS"},{name:"Austria",code:"AUT"},{name:"Azerbaijan",code:"AZE"},{name:"Åland Islands",code:"ALA"},{name:"Bahamas",code:"BHS"},{name:"Bahrain",code:"BHR"},{name:"Bangladesh",code:"BGD"},{name:"Barbados",code:"BRB"},{name:"Belarus",code:"BLR"},{name:"Belgium",code:"BEL"},{name:"Belize",code:"BLZ"},{name:"Benin",code:"BEN"},{name:"Bermuda",code:"BMU"},{name:"Bhutan",code:"BTN"},{name:"Bolivia (Plurinational State of)",code:"BOL"},{name:"Bonaire, Sint Eustatius and Saba",code:"BES"},{name:"Bosnia and Herzegovina",code:"BIH"},{name:"Botswana",code:"BWA"},{name:"Bouvet Island",code:"BVT"},{name:"Brazil",code:"BRA"},{name:"British Indian Ocean Territory",code:"IOT"},{name:"Brunei Darussalam",code:"BRN"},{name:"Bulgaria",code:"BGR"},{name:"Burkina Faso",code:"BFA"},{name:"Burundi",code:"BDI"},{name:"Cabo Verde",code:"CPV"},{name:"Cambodia",code:"KHM"},{name:"Cameroon",code:"CMR"},{name:"Canada",code:"CAN"},{name:"Cayman Islands",code:"CYM"},{name:"Central African Republic",code:"CAF"},{name:"Chad",code:"TCD"},{name:"Chile",code:"CHL"},{name:"China",code:"CHN"},{name:"Christmas Island",code:"CXR"},{name:"Cocos (Keeling) Islands",code:"CCK"},{name:"Colombia",code:"COL"},{name:"Comoros",code:"COM"},{name:"Congo (the Democratic Republic of the)",code:"COD"},{name:"Congo",code:"COG"},{name:"Cook Islands",code:"COK"},{name:"Costa Rica",code:"CRI"},{name:"Croatia",code:"HRV"},{name:"Cuba",code:"CUB"},{name:"Curaçao",code:"CUW"},{name:"Cyprus",code:"CYP"},{name:"Czechia",code:"CZE"},{name:"Côte d'Ivoire",code:"CIV"},{name:"Denmark",code:"DNK"},{name:"Djibouti",code:"DJI"},{name:"Dominica",code:"DMA"},{name:"Dominican Republic",code:"DOM"},{name:"Ecuador",code:"ECU"},{name:"Egypt",code:"EGY"},{name:"El Salvador",code:"SLV"},{name:"Equatorial Guinea",code:"GNQ"},{name:"Eritrea",code:"ERI"},{name:"Estonia",code:"EST"},{name:"Eswatini",code:"SWZ"},{name:"Ethiopia",code:"ETH"},{name:"Falkland Islands [Malvinas]",code:"FLK"},{name:"Faroe Islands",code:"FRO"},{name:"Fiji",code:"FJI"},{name:"Finland",code:"FIN"},{name:"France",code:"FRA"},{name:"French Guiana",code:"GUF"},{name:"French Polynesia",code:"PYF"},{name:"French Southern Territories",code:"ATF"},{name:"Gabon",code:"GAB"},{name:"Gambia",code:"GMB"},{name:"Georgia",code:"GEO"},{name:"Germany",code:"DEU"},{name:"Ghana",code:"GHA"},{name:"Gibraltar",code:"GIB"},{name:"Greece",code:"GRC"},{name:"Greenland",code:"GRL"},{name:"Grenada",code:"GRD"},{name:"Guadeloupe",code:"GLP"},{name:"Guam",code:"GUM"},{name:"Guatemala",code:"GTM"},{name:"Guernsey",code:"GGY"},{name:"Guinea",code:"GIN"},{name:"Guinea-Bissau",code:"GNB"},{name:"Guyana",code:"GUY"},{name:"Haiti",code:"HTI"},{name:"Heard Island and McDonald Islands",code:"HMD"},{name:"Holy See",code:"VAT"},{name:"Honduras",code:"HND"},{name:"Hong Kong",code:"HKG"},{name:"Hungary",code:"HUN"},{name:"Iceland",code:"ISL"},{name:"India",code:"IND"},{name:"Indonesia",code:"IDN"},{name:"Iran (Islamic Republic of)",code:"IRN"},{name:"Iraq",code:"IRQ"},{name:"Ireland",code:"IRL"},{name:"Isle of Man",code:"IMN"},{name:"Israel",code:"ISR"},{name:"Italy",code:"ITA"},{name:"Jamaica",code:"JAM"},{name:"Japan",code:"JPN"},{name:"Jersey",code:"JEY"},{name:"Jordan",code:"JOR"},{name:"Kazakhstan",code:"KAZ"},{name:"Kenya",code:"KEN"},{name:"Kiribati",code:"KIR"},{name:"Korea (the Democratic People's Republic of)",code:"PRK"},{name:"Korea (the Republic of)",code:"KOR"},{name:"Kuwait",code:"KWT"},{name:"Kyrgyzstan",code:"KGZ"},{name:"Lao People's Democratic Republic",code:"LAO"},{name:"Latvia",code:"LVA"},{name:"Lebanon",code:"LBN"},{name:"Lesotho",code:"LSO"},{name:"Liberia",code:"LBR"},{name:"Libya",code:"LBY"},{name:"Liechtenstein",code:"LIE"},{name:"Lithuania",code:"LTU"},{name:"Luxembourg",code:"LUX"},{name:"Macao",code:"MAC"},{name:"Madagascar",code:"MDG"},{name:"Malawi",code:"MWI"},{name:"Malaysia",code:"MYS"},{name:"Maldives",code:"MDV"},{name:"Mali",code:"MLI"},{name:"Malta",code:"MLT"},{name:"Marshall Islands",code:"MHL"},{name:"Martinique",code:"MTQ"},{name:"Mauritania",code:"MRT"},{name:"Mauritius",code:"MUS"},{name:"Mayotte",code:"MYT"},{name:"Mexico",code:"MEX"},{name:"Micronesia (Federated States of)",code:"FSM"},{name:"Moldova (the Republic of)",code:"MDA"},{name:"Monaco",code:"MCO"},{name:"Mongolia",code:"MNG"},{name:"Montenegro",code:"MNE"},{name:"Montserrat",code:"MSR"},{name:"Morocco",code:"MAR"},{name:"Mozambique",code:"MOZ"},{name:"Myanmar",code:"MMR"},{name:"Namibia",code:"NAM"},{name:"Nauru",code:"NRU"},{name:"Nepal",code:"NPL"},{name:"Netherlands",code:"NLD"},{name:"New Caledonia",code:"NCL"},{name:"New Zealand",code:"NZL"},{name:"Nicaragua",code:"NIC"},{name:"Niger",code:"NER"},{name:"Nigeria",code:"NGA"},{name:"Niue",code:"NIU"},{name:"Norfolk Island",code:"NFK"},{name:"Northern Mariana Islands",code:"MNP"},{name:"Norway",code:"NOR"},{name:"Oman",code:"OMN"},{name:"Pakistan",code:"PAK"},{name:"Palau",code:"PLW"},{name:"Palestine, State of",code:"PSE"},{name:"Panama",code:"PAN"},{name:"Papua New Guinea",code:"PNG"},{name:"Paraguay",code:"PRY"},{name:"Peru",code:"PER"},{name:"Philippines",code:"PHL"},{name:"Pitcairn",code:"PCN"},{name:"Poland",code:"POL"},{name:"Portugal",code:"PRT"},{name:"Puerto Rico",code:"PRI"},{name:"Qatar",code:"QAT"},{name:"Republic of North Macedonia",code:"MKD"},{name:"Romania",code:"ROU"},{name:"Russian Federation",code:"RUS"},{name:"Rwanda",code:"RWA"},{name:"Réunion",code:"REU"},{name:"Saint Barthélemy",code:"BLM"},{name:"Saint Helena, Ascension and Tristan da Cunha",code:"SHN"},{name:"Saint Kitts and Nevis",code:"KNA"},{name:"Saint Lucia",code:"LCA"},{name:"Saint Martin (French part)",code:"MAF"},{name:"Saint Pierre and Miquelon",code:"SPM"},{name:"Saint Vincent and the Grenadines",code:"VCT"},{name:"Samoa",code:"WSM"},{name:"San Marino",code:"SMR"},{name:"Sao Tome and Principe",code:"STP"},{name:"Saudi Arabia",code:"SAU"},{name:"Senegal",code:"SEN"},{name:"Serbia",code:"SRB"},{name:"Seychelles",code:"SYC"},{name:"Sierra Leone",code:"SLE"},{name:"Singapore",code:"SGP"},{name:"Sint Maarten (Dutch part)",code:"SXM"},{name:"Slovakia",code:"SVK"},{name:"Slovenia",code:"SVN"},{name:"Solomon Islands",code:"SLB"},{name:"Somalia",code:"SOM"},{name:"South Africa",code:"ZAF"},{name:"South Georgia and the South Sandwich Islands",code:"SGS"},{name:"South Sudan",code:"SSD"},{name:"Spain",code:"ESP"},{name:"Sri Lanka",code:"LKA"},{name:"Sudan",code:"SDN"},{name:"Suriname",code:"SUR"},{name:"Svalbard and Jan Mayen",code:"SJM"},{name:"Sweden",code:"SWE"},{name:"Switzerland",code:"CHE"},{name:"Syrian Arab Republic",code:"SYR"},{name:"Taiwan (Province of China)",code:"TWN"},{name:"Tajikistan",code:"TJK"},{name:"Tanzania, United Republic of",code:"TZA"},{name:"Thailand",code:"THA"},{name:"Timor-Leste",code:"TLS"},{name:"Togo",code:"TGO"},{name:"Tokelau",code:"TKL"},{name:"Tonga",code:"TON"},{name:"Trinidad and Tobago",code:"TTO"},{name:"Tunisia",code:"TUN"},{name:"Turkey",code:"TUR"},{name:"Turkmenistan",code:"TKM"},{name:"Turks and Caicos Islands",code:"TCA"},{name:"Tuvalu",code:"TUV"},{name:"Uganda",code:"UGA"},{name:"Ukraine",code:"UKR"},{name:"United Arab Emirates",code:"ARE"},{name:"United Kingdom of Great Britain and Northern Ireland",code:"GBR"},{name:"United States Minor Outlying Islands",code:"UMI"},{name:"United States of America",code:"USA"},{name:"Uruguay",code:"URY"},{name:"Uzbekistan",code:"UZB"},{name:"Vanuatu",code:"VUT"},{name:"Venezuela (Bolivarian Republic of)",code:"VEN"},{name:"Viet Nam",code:"VNM"},{name:"Virgin Islands (British)",code:"VGB"},{name:"Virgin Islands (U.S.)",code:"VIR"},{name:"Wallis and Futuna",code:"WLF"},{name:"Western Sahara",code:"ESH"},{name:"Yemen",code:"YEM"},{name:"Zambia",code:"ZMB"},{name:"Zimbabwe",code:"ZWE"}];var Ie=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Te{constructor(){this.modal=new u}show(){return Ie(this,void 0,void 0,(function*(){let e=new ee(Moralis),t=yield e.getAccount(),n=Handlebars.compile('<fieldset class="kycTrustedContact"> <div class="warningBar"> <strong>Warning</strong><br/> After you change this information a new KYC process will be started, and you will NOT be able to do any trades until it has been approved. </div> <form id="kycTrustedContactForm" method="post"> <div class="explain"> A trusted contact is a person you authorize your financial firm to contact in limited circumstances, such as if there is a concern about activity in your account and they have been unable to get in touch with you. <br/><br/> A trusted contact may be a family member, attorney, accountant or another third-party who you believe would respect your privacy and know how to handle the responsibility. The trusted person should be 18 years old or older. </div> <div> <label for="given_name">Legal given name of trusted contact</label> <input required id="given_name" name="given_name"/> </div> <div> <label for="family_name">Legal family name of trusted contact</label> <input required id="family_name" name="family_name"/> </div> <div> If you fill in name, you are required to fill in one of the following, email, phone or address </div> <div class="input_error" id="contact_missing_info"></div> <div> <label for="email_address">Email of trusted contact</label> <input id="email_address" type="email" name="email_address"/> </div> <div> <label for="phone_number">Phone of trusted contact</label> <input id="phone_number" type="tel" name="phone_number"/> </div> <div> <label for="street_address">Address of trusted contact</label> <input id="street_address" name="street_address"/> </div> <div> <label for="city">City of trusted contact</label> <input id="city" name="city"/> </div> <div> <label for="state">State of trusted contact</label> <input id="state" name="state"/> </div> <div> <label for="postal_code">Postal code of trusted contact</label> <input id="postal_code" name="postal_code"/> </div> <div> <label for="country">Country of trusted contact</label> <select required id="country" required name="country"> <option value=""></option> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </div> <div class="input_error" id="kycEditNameError"></div> <div class="buttons"> <button type="submit" id="trustedContactSubmit">Submit</button> </div> </form> </fieldset>');if(this.modal.showModal("Edit trusted contact",n({countries:Ee.Countries})),t.trusted_contact){let e=Object.getOwnPropertyNames(t.trusted_contact);we.fillInputs(e,t.trusted_contact)}this.bindEvents()}))}bindEvents(){let e=document.getElementById("trustedContactSubmit");null==e||e.addEventListener("click",(t=>Ie(this,void 0,void 0,(function*(){if(t.preventDefault(),!we.validate("#kycTrustedContactForm"))return;y.setLoading(e);let n=we.getParams("#kycTrustedContactForm"),i=new ee(Moralis);yield i.updateTrustedContact(n).then((e=>{e.message?this.showError(e.message):this.modal.hideModal()})).catch((e=>{e.message?this.showError(JSON.parse(e.message).message):this.showError(e)})).finally((()=>{y.removeLoading()}))}))))}showError(e){let t=document.getElementById("kycEditNameError");t&&(t.innerHTML=e,t.style.display="block")}}var Se=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ae extends le{constructor(e){super(e)}getAUSDBalanceOf(e){return Se(this,void 0,void 0,(function*(){if(Ae.lastUpdate&&Ae.aUSDAmount&&!re.isOlderThen(Ae.lastUpdate,5))return Ae.aUSDAmount;let t=yield this.getOptions("balanceOf",{account:e});return yield this.executeFunction(t).then((e=>{let t=this.moralis.Units.FromWei(e.toString(),18);return Ae.aUSDAmount=new z(t),Ae.lastUpdate=new Date,Ae.aUSDAmount})).catch((e=>{let t=new se(e);return b.report(t),new z(0)}))}))}transfer(e,t){return Se(this,void 0,void 0,(function*(){const n=yield this.getOptions("transfer",{to:e,amount:Moralis.Units.Token(t.toString(),18)});let i=yield this.executeFunction(n).then((e=>e)).catch((e=>{let t=new se(e);throw b.report(t)}));return Ae.aUSDAmount=void 0,Ae.lastUpdate=void 0,i}))}getOptions(e,t){return Se(this,void 0,void 0,(function*(){let n=ae.getContractInfo(),i=yield this.getAUsdAbi();return{contractAddress:n.AUSD_ADDRESS,functionName:e,abi:i,params:t}}))}getAUsdAbi(){return Se(this,void 0,void 0,(function*(){if(Ae.AUSDInfo)return Ae.AUSDInfo.abi;let e=yield fetch("../abi/aUSD.json");return Ae.AUSDInfo=yield e.json(),Ae.AUSDInfo.abi}))}}class Ce{constructor(e){this.moralis=e}requestFakeFunding(){return e=this,t=void 0,i=function*(){let e=s.getInstance();return yield this.moralis.Cloud.run("fundUser",{chainId:e.ChainId})},new((n=void 0)||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}}class Be{constructor(e){this.aUsdFund=e}show(){let e=Handlebars.compile('<p>Setup your bank relationship with Liminal.market. Please choose the type of transfer you want to make</p> <ul> <li><label><input type="radio" name="bank_transfer" id="ach_transfer" value="1"/> ACH bank transfer (US)</label> </li> <li><label><input type="radio" name="bank_transfer" id="wire_transfer" value="2"/> Wire transfer (International)</label></li> </ul> <div id="selectFundingTypeError" class="input_error"></div> <button id="next_bank_information">Next: Bank information</button> ');this.aUsdFund.modal.showModal("Select funding type",e({})),this.bindEvent()}bindEvent(){let e=document.getElementById("next_bank_information");null==e||e.addEventListener("click",(e=>{this.aUsdFund.hideError("selectFundingTypeError");let t=document.getElementById("ach_transfer");(null==t?void 0:t.checked)&&this.aUsdFund.achRelationship.show();let n=document.getElementById("wire_transfer");(null==n?void 0:n.checked)&&this.aUsdFund.wireTransfer.show(),this.aUsdFund.showError("selectFundingTypeError","Please select funding type")}))}}var Le,Ne=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class xe{constructor(e){this.aUsdFund=e}show(){let e=Handlebars.compile('<fieldset> <p>Before you can transfer, you need to set up your bank information. We use <a href="https://plaid.com" target="_blank">Plaid</a> to connect your account with the broker account <br/><br/> Plaid is a secure service that makes it easy for you to connect your bank account information. We do not have access to transfer from you account or any other access to your bank account. </p> <form id="achForm"> <div class="input_error" id="achError"></div> <div class="grid"> <button id="ach_previous">Previous: Funding type</button> <button id="connectPlaid">Connect using Plaid</button> </div> </form> </fieldset>');this.aUsdFund.modal.showModal("Bank information",e({})),this.bindEvent()}bindEvent(){let e=document.getElementById("connectPlaid");null==e||e.addEventListener("click",(e=>Ne(this,void 0,void 0,(function*(){e.preventDefault(),yield this.connectPlaidAction()}))));let t=document.getElementById("ach_previous");null==t||t.addEventListener("click",(e=>{e.preventDefault(),this.aUsdFund.selectFundingType.show()}))}connectPlaidAction(){return Ne(this,void 0,void 0,(function*(){let e=document.getElementById("connectPlaid");y.setLoading(e),this.aUsdFund.hideError("achError");let t=new ee(this.aUsdFund.moralis);yield t.getPlaidLinkToken().catch((e=>{this.aUsdFund.showError("achError",e),y.removeLoading()})).then((e=>{console.log("response",e);let t=JSON.parse(e),n=document.createElement("script");n.src="https://cdn.plaid.com/link/v2/stable/link-initialize.js",n.addEventListener("load",(()=>{this.createPlaidConnection(t)})),document.getElementById("achForm").append(n)}))}))}createPlaidConnection(e){Plaid.create({token:e.link_token,onSuccess:(e,t)=>Ne(this,void 0,void 0,(function*(){t.account||(y.removeLoading(),this.aUsdFund.showError("achError","Didn't receive any information from Plaid. Please try again. If it doesn't work. Please contact us at info@liminal.market"));let n=new ee(this.aUsdFund.moralis);yield n.createAchRelationship(e,t.account.id).catch((e=>Ne(this,void 0,void 0,(function*(){if(-1!=e.error.indexOf("only one active ach relationship")){let e=yield n.getBankRelationship();yield this.aUsdFund.transfer.show(e)}else this.aUsdFund.showError("achError",e),y.removeLoading()})))).then((e=>{console.log("createAchRelationship",e),this.aUsdFund.transfer.show(e)}))})),onExit:(e,t)=>{console.log(e,t),y.removeLoading()}}).open()}}!function(e){e.Incoming="INCOMING",e.Outgoing="OUTGOING"}(Le||(Le={}));class Me{static registerHelpers(){Handlebars.registerHelper("perc",(function(e){return Math.round(1e4*parseFloat(e))/100+"%"})),Handlebars.registerHelper("round",(function(e){return Math.round(100*parseFloat(e))/100})),Handlebars.registerHelper("round2",(function(e){return Math.round(1e4*parseFloat(e))/1e4})),Handlebars.registerHelper("classColor",(function(e){return e>0?"green":"red"})),Handlebars.registerHelper("dateTimeFormat",(function(e){return new Date(e).toLocaleString()})),Handlebars.registerHelper("classByStatus",(function(e){return"QUEUED"==e||"APPROVAL_PENDING"==e?"":"hidden"}))}}var De=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ue{constructor(e){this.moralis=e,this.userService=new ee(this.moralis)}render(e){return De(this,void 0,void 0,(function*(){Me.registerHelpers();let t=Handlebars.compile('<hr/> <h3>{{Direction}} transfers</h3> {{#if transfers.length}} <p>Below is a list of transfers, confirmed and not confirmed.</p> <table> <thead> <tr> <th>Amount</th> <th>Status</th> <th>Created</th> <th>Expires</th> </tr> </thead> <tbody> {{#each transfers}} <tr> <td>${{amount}}</td> <td id="status_{{id}}">{{status}}</td> <td>{{dateTimeFormat created_at}}</td> <td>{{dateTimeFormat expires_at}}</td> <td id="delete_{{id}}" class="{{classByStatus status}}"><a href="#" class="deleteTransfer" data-id="{{id}}">Cancel</a> </td> </tr> {{/each}} </tbody> </table> {{else}} <p>No transfers registered</p> {{/if}}'),n=yield this.userService.getLatestTransfers(e);return t({Direction:e,transfers:n})}))}bindEvents(){var e;let t=document.querySelectorAll(".deleteTransfer");for(let n=0;n<t.length;n++)null===(e=t[n])||void 0===e||e.addEventListener("click",(e=>De(this,void 0,void 0,(function*(){if(e.preventDefault(),!confirm("Are you sure you want to cancel this withdraw request?"))return;let i=t[n].dataset.id;if(!i)return;let o=new ee(this.moralis);yield o.deleteTransfer(i).then((()=>{let e=document.getElementById("status_"+i);e&&(e.innerText="CANCELED");let t=document.getElementById("delete_"+i);null==t||t.remove()}))}))))}}var Pe=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Fe{constructor(e,t){this.moralis=e,this.aUsdFund=t,this.transfersList=new Ue(this.moralis)}show(e){return Pe(this,void 0,void 0,(function*(){if(!e)return void this.aUsdFund.modal.showModal("No bank relationship exists","No bank relationship exists. You need to create this before you can transfer money. Close the window and try again.");this.bankRelationship=e;let t=Handlebars.compile('<fieldset> <form> <p> To fill up your broker account, you need to notify Liminal.market first about your transfer, we can then match it with your account. <br/><br/> Type in the amount you would like to transfer to you broker account. {{#if bank_account_number}} <br/><br/> The money should come from <strong>{{bank_account_number}}</strong> {{/if}} </p> <br/> <label> Amount in US dollars ($) <input name="amount" class="amount" type="tel" id="amount" minlength="1" required/> </label> <input type="hidden" name="transfer_type" id="transfer_type" value="{{transfer_type}}"/> <input type="hidden" name="relationship_id" id="relationship_id" value="{{relationshipId}}"/> <input type="hidden" name="direction" id="direction" value="INCOMING"/> <div class="input_error" id="transferError"></div> <div class="grid"> <button id="notifyTransfer">Notify Liminal.market of incoming transfer</button> </div> </form> {{{transfers}}} </fieldset>'),n=yield this.transfersList.render(Le.Incoming),i=ve.isNullOrEmpty(e.bank_account_number)&&""!=e.bank_account_type?"wire":"ach";this.aUsdFund.modal.showModal("Create transfer notification",t({transfers:n,transfer_type:i,relationshipId:e.id})),this.bindEvents()}))}bindEvents(){this.transfersList.bindEvents();let e=document.getElementById("notifyTransfer");null==e||e.addEventListener("click",(t=>Pe(this,void 0,void 0,(function*(){t.preventDefault(),this.aUsdFund.hideError("transferError");let n=document.getElementById("amount");(ve.isNullOrEmpty(n.value)||parseFloat(n.value)<10)&&this.aUsdFund.showError("amountError","Amount cannot be empty or below $10"),y.setLoading(e);let i=new ee(this.moralis);yield i.createTransfer(n.value,"INCOMING").then((()=>{ve.isNullOrEmpty(this.bankRelationship.processor_token)?this.aUsdFund.wireTransferInfo.show(n.value):this.aUsdFund.achTransferInfo.show(n.value)})).catch((e=>{let t=JSON.parse(e.message);this.aUsdFund.showError("transferError",t.serverError.message)})).finally((()=>{y.removeLoading()}))}))))}}var Re=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Oe{constructor(e){this.aUsdFund=e}show(){return Re(this,void 0,void 0,(function*(){let e=Handlebars.compile('<fieldset> <p>Before you can transfer, you need to set up your bank information</p> <form id="wireTransferForm"> <label>Name of bank <input name="name" required id="name"/> </label> <div class="input_error" id="swift_error">BIC/SWIFT code should be 8 or 11 characters</div> <label> Bank code (BIC/SWIFT) <input name="bank_code" maxlength="11" id="bank_code" required/> </label> <label> Account number (IBAN) <input name="account_number" id="account_number" required/> </label> <label> Street address <input name="street_address" id="street_address" required/> </label> <label> Postal code <input name="postal_code" id="postal_code" required/> </label> <label> City <input name="city" id="city" required/> </label> <label>State <input name="state_province" id="state_province" required/> </label> <label> Country where bank account is located <select required id="country" required name="country"> <option value=""></option> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </label> <input type="hidden" name="bank_code_type" value="BIC"/> <div id="writeTransferError" class="input_error"></div> <div class="grid"> <button id="wire_transfer_previous">Previous: Funding type</button> <button id="save_international_bank_information">Next: Transfer</button> </div> </form> </fieldset>');this.aUsdFund.modal.showModal("Create bank information",e({countries:Ee.Countries})),this.bindEvents()}))}bindEvents(){let e=document.getElementById("wire_transfer_previous");null==e||e.addEventListener("click",(e=>{this.aUsdFund.selectFundingType.show()}));let t=document.getElementById("save_international_bank_information");null==t||t.addEventListener("click",(e=>Re(this,void 0,void 0,(function*(){if(e.preventDefault(),!this.validate())return;let t=we.getParams("#wireTransferForm"),n=new ee(this.aUsdFund.moralis);yield n.registerWireTransferRelationship(t).then((e=>{this.aUsdFund.transfer.show(e)})).catch((e=>Re(this,void 0,void 0,(function*(){let t=JSON.parse(e.message),i=document.getElementById("writeTransferError");if(i)if(-1!=t.serverError.message.indexOf("only one bank association")){let e=yield n.getBankRelationship();e?yield this.aUsdFund.transfer.show(e):(i.innerText='We cannot create the bank connection. Something is not working as it should. Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a>',i.style.display="block")}else i.innerText=t.serverError.message,i.style.display="block"}))))}))))}validate(){let e=document.getElementById("swift_error");e&&(e.style.display="none");let t=document.getElementById("writeTransferError");if(t&&(t.style.display="none"),!we.validate("#wireTransferForm"))return!1;let n=document.getElementById("bank_code");if(8!=n.value.length&&11!=n.value.length){n.setAttribute("aria-invalid","true");let e=document.getElementById("swift_error");return e&&(e.style.display="block"),!1}return!0}}class qe{constructor(e){this.aUsdFund=e}show(e){let t=Handlebars.compile("<h2>You need to transfer now</h2> <p> Use this information to execute the transfer. Alpaca...... information is needed. ${{amount}} </p>");this.aUsdFund.modal.showModal("Transfer information",t({amount:e}),!1,(()=>{}),!1)}}class He{constructor(e){this.aUsdFund=e}show(e){let t=Handlebars.compile("<h2>You need to transfer now</h2> <p> Use this information to execute the transfer. Alpaca...... information is needed. ${{amount}} </p>");this.aUsdFund.modal.showModal("Transfer information",t({amount:e}))}}class We{constructor(e){this.moralis=e,this.modal=new u,this.selectFundingType=new Be(this),this.achRelationship=new xe(this),this.transfer=new Fe(e,this),this.wireTransfer=new Oe(this),this.achTransferInfo=new qe(this),this.wireTransferInfo=new He(this)}show(){return e=this,t=void 0,i=function*(){let e=new ee(this.moralis),t=yield e.getBankRelationship();t?yield this.transfer.show(t):this.selectFundingType.show()},new((n=void 0)||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}showError(e,t){let n=document.getElementById(e);n&&(n.innerText=t,n.style.display="block")}hideError(e){let t=document.getElementById(e);t&&(t.style.display="none")}}var Ye=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ke{constructor(e){this.moralis=e,this.currentBalance=new z(-1),this.modal=new u}showAUSDFund(e){e()}showAUSDFakeFund(e){let t=Handlebars.compile('<article> <div id="beforeFunding"> To use liminal.market you need some aUSD. aUSD is the same value as USD. We can give you some aUSD (this is all fake money), so you can play with the system. First, you need to add aUSD to you wallet. <button id="addTokenToWallet">Add aUSD to wallet</button> <blockquote id="needToCopy" class="d-none"> If the button didn\'t work, you can copy the address here and import it into your wallet <input value="{{aUSDAddress}}"/> </blockquote> When you have aUSD to you wallet, you can request some money to trade with. <button id="requestFakeAUSD">Request some aUSD</button> <div class="warningBar notificationBar d-none" id="fundingError"></div> </div> <div id="afterFunding" class="d-none center"> We have now sending aUSD to your wallet. This usually takes few minutes, so lets wait. <br/><br/> When you have the aUSD in you wallet, we will tell you. <div> <h3>Current aUSD balance</h3> <div id="currentAUSDBalance"></div> </div> </div> <div id="errorAfterTryFunding" class="d-none"> We had an error while trying to fund you. We\'ll be cracking at the issue soon to fix it. Try again in few minutes. If not, try again in few hours. </div> <a href="#" id="registerBankInfo">Register bank information (not needed for Sandbox)</a> </article>')({aUSDAddress:ae.getContractInfo().AUSD_ADDRESS});this.modal.showModal("Fund my account (Fake money)",t);let n=document.getElementById("addTokenToWallet");if(!n)return;n.addEventListener("click",(e=>Ye(this,void 0,void 0,(function*(){let e=ae.getContractInfo(),t=new _(this.moralis);(yield t.addTokenToWallet(e.AUSD_ADDRESS,"aUSD",(()=>{this.showCopyField()})))||this.showCopyField()}))));let i=document.getElementById("registerBankInfo");null==i||i.addEventListener("click",(e=>{this.modal.hideModal(),new We(this.moralis).show()}));let o=document.getElementById("requestFakeAUSD");null==o||o.addEventListener("click",(e=>Ye(this,void 0,void 0,(function*(){o.setAttribute("aria-busy","true");let e=new Ce(this.moralis),t=yield e.requestFakeFunding().catch((e=>{this.errorWhileFunding({})}));if(console.log("success",t.success),t.success)if(t.success){let e=document.getElementById("beforeFunding"),t=document.getElementById("afterFunding");if(!e||!t)return;yield this.loadAUSDBalance(),e.classList.add("d-none"),t.classList.remove("d-none")}else this.errorWhileFunding(t);else{console.log(t);let e=document.getElementById("fundingError");e&&(o.removeAttribute("aria-busy"),e.classList.remove("d-none"),e.innerHTML=t.message,setTimeout((()=>{e.classList.add("d-none")}),1e4))}}))))}loadAUSDBalance(){return Ye(this,void 0,void 0,(function*(){let e=document.getElementById("currentAUSDBalance");if(!e)return;let t=new Ae(this.moralis),n=new ee(this.moralis).getEthAddress(),i=new z(0);n&&(i=yield t.getAUSDBalanceOf(n)),e.innerHTML="$"+$(i).toString(),this.currentBalance.eq(-1)&&(this.currentBalance=i),this.currentBalance.eq(i)?setTimeout((()=>Ye(this,void 0,void 0,(function*(){yield this.loadAUSDBalance()}))),5e3):window.location.reload()}))}showCopyField(){let e=document.getElementById("needToCopy");e&&e.classList.remove("d-none")}errorWhileFunding(e){let t=document.getElementById("beforeFunding"),n=document.getElementById("errorAfterTryFunding");t&&n&&(e.message&&(n.innerHTML=e.message),t.classList.add("d-none"),n.classList.remove("d-none"))}}var Ge=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ve{constructor(e){this.wireTransferCost=50,this.achTransferCost=25,this.moralis=e,this.userService=new ee(this.moralis),this.transferCost=this.wireTransferCost,this.transfersList=new Ue(this.moralis)}show(){return Ge(this,void 0,void 0,(function*(){let e=new u,t=yield this.userService.getBankRelationship();if(!t)return void e.showModal("Withdraw information","You haven't setup bank connection. You cannot withdraw from without bank connection");let n=yield this.transfersList.render(Le.Outgoing),i=this.userService.getEthAddress(),o=new Ae(this.moralis);if(this.currentBalance=new z(0),i&&(this.currentBalance=yield o.getAUSDBalanceOf(i)),this.currentBalance.eq(0)){let t=Handlebars.compile("Your current balance is $0. There is nothing to withdraw. {{{transfers}}}");return void e.showModal("Withdraw information",t({transfers:n}))}let a=Handlebars.compile('<fieldset id="withdrawInput"> {{#if bank.bank_code_type}} Your money will be sent to {{bank.name}} to account number {{bank.account_number}}. <br/><br/> Outgoing International Wire Transfers cost is ${{transferCost}}.<br/> Fees will be deducted from the amount. {{/if}} {{#unless bank.bank_code_type}} Your money will be sent to account number {{bank.bank_account_number}}. <br/><br/> ACH transfer costs is ${{transferCost}}. Fees will be deducted from the amount. {{/unless}} <form id="withdrawForm"> <label>Amount to withdraw <input type="tel" name="amount" id="amount"/> </label> <div class="input_error" id="withdrawAmountError">The amount is lower than the cost of transfer</div> <button id="confirmWithdraw">Confirm withdraw</button> </form> {{{Transfers}}} </fieldset> <fieldset id="withdrawConfirm" class="hidden"> You are about to withdraw $<span id="withdrawAmountText"></span> from your account <div class="warningBar"> Warning: The fee of this transaction will be $<span id="feeWarning"></span> and is <span id="feePercentage"></span>% of the amount. </div> <div class="input_error" id="withdrawError"></div> <button id="confirmWithdrawButton">Execute transfer</button> </fieldset>');this.bankInfo=t,this.transferCost=this.bankInfo.bank_code_type?this.wireTransferCost:this.achTransferCost;let r={amount:this.currentBalance,transferCost:this.transferCost,Transfers:n,bank:this.bankInfo};e.showModal("Withdraw information",a(r)),this.bindEvents(),this.transfersList.bindEvents()}))}bindEvents(){let e=document.getElementById("confirmWithdraw");null==e||e.addEventListener("click",(e=>Ge(this,void 0,void 0,(function*(){if(e.preventDefault(),!this.bankInfo)return;let t=document.getElementById("amount");if(ve.isNullOrEmpty(t.value))t.setAttribute("aria-invalid","true");else{if(parseFloat(t.value)<=this.transferCost)return document.getElementById("withdrawAmountError").style.display="block",void t.setAttribute("aria-invalid","true");t.setAttribute("aria-invalid","false"),this.showWithdrawConfirmation()}}))))}showWithdrawConfirmation(){if(!this.bankInfo)return;let e=document.getElementById("amount"),t=document.getElementById("withdrawInput");null==t||t.classList.add("hidden");let n=document.getElementById("withdrawConfirm");null==n||n.classList.remove("hidden");let i=document.getElementById("withdrawAmountText"),o=document.getElementById("feeWarning"),a=document.getElementById("feePercentage");var r;i.innerText=e.value,o.innerText=this.transferCost.toString(),a.innerText=(r=this.transferCost/parseFloat(e.value)*100,Math.round(100*r)/100).toString();let s=document.getElementById("confirmWithdrawButton");null==s||s.addEventListener("click",(t=>Ge(this,void 0,void 0,(function*(){t.preventDefault(),yield this.userService.createTransfer(e.value,Le.Outgoing).then((e=>Ge(this,void 0,void 0,(function*(){n.innerHTML=yield this.transfersList.render(Le.Outgoing),this.transfersList.bindEvents()})))).catch((e=>{let t=document.getElementById("withdrawError");if(t){if(t&&function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(e.message)){let n=JSON.parse(e.message);t.innerText=n.serverError.message}else t.innerText=e.toString();t.style.display="block"}}))}))))}}var ze=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class je{constructor(e,t){this.user=t,this.moralis=e}static forceLoadAUSDBalanceUI(){return ze(this,void 0,void 0,(function*(){let e=new ee(Moralis).getUser(),t=new je(Moralis,e);Ae.lastUpdate=void 0,yield t.loadAUSDBalanceUI()}))}loadAUSDBalanceUI(){return ze(this,void 0,void 0,(function*(){if(!this.user)return;let e=document.getElementById("userInfoAUsdBalance"),t=document.getElementById("frontpageAUsdBalance");if(!e)return;if(!this.user.get("alpacaId"))return null==t||t.classList.add("hidden"),void(null==e||e.classList.add("hidden"));null==t||t.classList.remove("hidden"),null==e||e.classList.remove("hidden");let n=new Ae(this.moralis),i=yield n.getAUSDBalanceOf(this.user.get("ethAddress")),o=$(i),a=document.getElementById("front_page_aUSD_balance");a&&(a.innerHTML="$"+o);let r=document.getElementById("user_info_ausd_balance");r&&(r.innerHTML="$"+o),this.bindEvents();let s=document.querySelector(".balance_value");if(s&&(s.innerHTML="$"+o.toFixed(),s.title=i.toFixed(),s.dataset.tooltip=i.toFixed()),o.isLessThan(10)){let e=document.getElementById("frontpage_fund_account");null==e||e.classList.remove("hidden")}}))}bindEvents(){let e=s.getInstance();document.querySelectorAll(".fund_account").forEach((t=>{let n=new Ke(this.moralis);e.TestNetwork?(t.innerHTML="Click for some aUSD",t.addEventListener("click",(e=>{e.preventDefault(),n.showAUSDFakeFund((()=>{}))}))):t.addEventListener("click",(e=>ze(this,void 0,void 0,(function*(){e.preventDefault();let t=new We(this.moralis);yield t.show()}))))}));let t=document.getElementById("withdraw_from_account");null==t||t.addEventListener("click",(e=>ze(this,void 0,void 0,(function*(){e.preventDefault();let t=new Ve(this.moralis);yield t.show()}))))}}var $e=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Qe{constructor(e,t,n){this.moralis=e,this.user=n,this.userService=new ee(this.moralis),this.providerInfo=t}render(e){return $e(this,void 0,void 0,(function*(){if(!this.user)return;this.listenForWalletChanges(),this.loadUserMenuUI(e);let t=new je(this.moralis,this.user);yield t.loadAUSDBalanceUI()}))}listenForWalletChanges(){this.moralis.onChainChanged((function(){location.reload()})),this.moralis.onAccountChanged((function(){location.reload()})),this.moralis.onDisconnect((function(){location.reload()})),this.moralis.onConnect((function(){location.reload()}))}loadUserMenuUI(e){if(!this.user)return;let t=document.getElementById(e);if(!t)return;let n=s.getInstance(),i={ethAddress:this.user.get("ethAddress"),shortEthAddress:Z(this.user.get("ethAddress")),walletName:this.providerInfo.WalletName,networkName:n.ChainName+(n.TestNetwork?" - (Test network)":""),blockchainExplorer:n.BlockExplorer+"/address/",provider:""},o=Handlebars.compile('<div id="userMenuPanel"> <a href="#" id="userInfoAction" aria-expanded="false"> <img src="https://effigy.im/a/{{ethAddress}}.png" width="24"> <span id="user_info_ethAddress">{{shortEthAddress}}</span> </a> <div id="userInfoDropdown" class="d-none"> <div class="grid account_info"> <h6>Account</h6> <a id="disconnectFromNetwork" href="#">Disconnect</a> </div> <div class="edit_account grid"> <a id="editName" href="#">Edit name</a> <a id="editContact" href="#">Edit contact info</a> </div> <div class="edit_account"> <a id="editTrustedContact" href="#">Edit trusted contact</a> </div> <hr/> <div class="grid"> <div> <img src="https://effigy.im/a/{{ethAddress}}.png"> </div> <div> <strong class="d-block"><a href="{{blockchainExplorer}}{{ethAddress}}" target="_blank">{{shortEthAddress}}</a></strong> <small>{{walletName}}</small> </div> </div> <hr/> <div class="hidden" id="userInfoAUsdBalance"> <div class="grid"> <div><img src="https://app.liminal.market/img/ausd.png"></div> <div> <strong class="d-block">aUSD <span id="user_info_ausd_balance"></span></strong> <a href="#" class="fund_account">Fund my account</a> <a href="#" id="withdraw_from_account">Withdraw from account</a> </div> </div> <hr/> </div> <div class="grid"> <strong class="d-block">Network</strong> <small>{{networkName}}</small> </div> </div> </div>')(i);t.innerHTML=o;let a=document.getElementById("userInfoAction");null==a||a.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let t=document.getElementById("userInfoDropdown");t&&(t.classList.toggle("d-none"),t.addEventListener("click",(e=>{e.stopPropagation()})))}));let r=document.getElementById("disconnectFromNetwork");null==r||r.addEventListener("click",(e=>{e.preventDefault(),this.moralis.User.logOut(),window.location.reload()})),this.bindUserActionEvents()}bindUserActionEvents(){let e=document.getElementById("editName");null==e||e.addEventListener("click",(e=>$e(this,void 0,void 0,(function*(){e.preventDefault();let t=new be;yield t.show()}))));let t=document.getElementById("editContact");null==t||t.addEventListener("click",(e=>$e(this,void 0,void 0,(function*(){e.preventDefault();let t=new ke;yield t.show()}))));let n=document.getElementById("editTrustedContact");null==n||n.addEventListener("click",(e=>$e(this,void 0,void 0,(function*(){e.preventDefault();let t=new Te;yield t.show()}))))}}class Je{constructor(e){this.moralis=e,this.modal=new u,this.providerInfo=new A(null)}renderButton(e){document.getElementById(e)&&(document.getElementById(e).innerHTML='<button class="liminal_market_connect_wallet outline">Connect wallet</button>',document.querySelectorAll(".liminal_market_connect_wallet").forEach((e=>{e.removeEventListener("click",(()=>this.chooseWalletProvider())),e.addEventListener("click",(()=>this.chooseWalletProvider()))})))}chooseWalletProvider(){this.modal.showModal("Connect to a wallet",' <article id="tos_pp_cookie_panel"> <p> By connecting a wallet, I agree to liminal.market Terms of Use, Cookies Policy and Privacy Policy. </p> <ul> <li> <label> <input type="checkbox" name="all" value="1"> I accept all </label> </li> <li> <label> <input type="checkbox" name="tos" value="1"> <span> I accept <a href="https://www.liminal.market/terms-of-service" target="_blank">Terms of service</a> <small>Things to note. You are taking a risk by buying stocks. You will be asked to do KYC/AML. You are responsible for any transaction you make.</small> </span> </label></li> <li> <label> <input type="checkbox" name="pp" value="1"> <span> I accept the <a href="https://www.liminal.market/privacy-policy" target="_blank">Privacy Policy</a> <small>Liminal.market doesn\'t store any personal data. Any KYC info is stored with the broker. If you register on our mailing list, that will be the only personal info we store.</small> </span> </label></li> <li> <label> <input type="checkbox" name="cookie" value="1"> <span> I accept <a href="https://www.liminal.market/cookie-policy" target="_blank">Cookie policy</a> <small>We use some cookies & services to improve our service. You don\'t have to accept but we will then just store essential cookies.</small> </span> </label> </li> </ul> </article> <div class="d-none" id="wallet_connector_panel"> <article class="provider" id="connect_wallet_walletConnect" data-provider="walletConnect"> <h3>Connect using WalletConnect</h3> <p> Popular option to connect your mobile wallet. For mobile we like <a href="https://www.tokenpocket.pro/" target="_blank onclick=\'event.stopProgation();\'">Token Poket</a> as is support test network</p> </article> <div class="d-none" id="walletConnectConnectionInfo"></div> <article id="connect_wallet_metamask" class="provider" data-provider="metamask"> <h3>Metamask</h3> <p>Connect using your Metamask</p> </article> </div>'),this.setupCheckboxes(),this.setupProviders()}setupCheckboxes(){let e={all:!1,tos:!1,pp:!1,cookie:!1};if(new o(document).getCookieValue("tos"))return e={tos:!0,pp:!0},this.toggleProviders(e),void document.getElementById("tos_pp_cookie_panel").classList.add("d-none");let t=document.querySelectorAll("#tos_pp_cookie_panel input");t.forEach((n=>{let i=n;i.addEventListener("click",(()=>{let n=i.getAttribute("name");if("all"==n){let n=i.checked;t.forEach((t=>{let i=t;e[i.name]=n,i.checked=n}))}else e[n]=i.checked;this.toggleProviders(e)}))}))}setupProviders(){document.querySelectorAll("#wallet_connector_panel .provider").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let t=e.currentTarget.dataset.provider;this.connectWallet(t)}),{capture:!0})}))}toggleProviders(e){let t=new o(document);e.tos&&e.pp?(t.setCookie("tos",(new Date).toDateString()),new _(this.moralis).isWebview(window.navigator.userAgent)?(this.modal.hideModal(),this.connectWallet("")):document.getElementById("wallet_connector_panel").classList.remove("d-none")):(t.deleteCookie("tos"),document.getElementById("wallet_connector_panel").classList.add("d-none"))}showUnsupportedNetworkMessage(e){let t="The network you are connecting to is not supported.";t+="Following networks are supported. ";let n=s.getNetworks();for(let e=0;e<n.length;e++)0!=e&&(t+=", "),t+=n[e].Name;e.innerHTML=t}connectWallet(e){let t=new S(this.moralis);new o(document).setCookieProvider(e),t.authenticateUser(e,(t=>{this.web3EnabledResult(e,t)}),(e=>{return t=this,n=void 0,o=function*(){this.modal.hideModal();let t=new Qe(this.moralis,this.providerInfo,e);if(yield t.render("user_header_info"),document.getElementById("liminal_market_execute_trade")){let e=new Ft(this.moralis);yield e.load()}},new((i=void 0)||(i=Promise))((function(e,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o})).catch((e=>{b.report(e)}))}web3EnabledResult(e,t){this.providerInfo=new A(t);let n=document.getElementById(e+"ConnectionInfo");if(!n)return;n.classList.replace("alert-warning","alert-info");let i=s.getInstance();this.providerInfo.ChainId!=i.ChainId&&(s.getNetworkInfoByChainId(this.providerInfo.ChainId)?s.setNetworkByChainId(this.providerInfo.ChainId):this.showUnsupportedNetworkMessage(n));let o='Connecting to you wallet "'+this.providerInfo.WalletName+'" to address '+Z(this.providerInfo.UserAddress);o+=". Open "+this.providerInfo.WalletName+" and <strong>Confirm</strong> the sign in.",n.innerHTML=o,n.classList.remove("d-none")}}var Ze=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Xe extends le{constructor(e){super(e)}getKYCAbi(){return Ze(this,void 0,void 0,(function*(){if(Xe.KYCInfo)return Xe.KYCInfo.abi;const e=yield fetch("../abi/KYC.json");return Xe.KYCInfo=yield e.json(),Xe.KYCInfo.abi}))}hasValidKYC(){return Ze(this,void 0,void 0,(function*(){if(Xe.KycResponse&&Xe.KycResponse.isValidKyc)return Xe.KycResponse;if(Xe.KycResponse=yield this.moralis.Cloud.run("isValidKyc",{chainId:this.moralis.chainId}).catch((e=>{let t=new se(e);return t.addressIsNotValidKYC()||b.report(t),!1})),Xe.KycResponse.alpacaId){let e=this.moralis.User.current();null==e||e.set("alpacaId",Xe.KycResponse.alpacaId);let t=new je(this.moralis,e);yield t.loadAUSDBalanceUI()}return Xe.KycResponse}))}saveKYCInfo(e){return Ze(this,void 0,void 0,(function*(){if(!this.moralis.User.current())throw new c("You need to be logged in to do KYC. Please login again.");return yield this.moralis.Cloud.run("kycRegistration",e)}))}updateKYCInfo(e){return Ze(this,void 0,void 0,(function*(){if(!this.moralis.User.current())throw new c("You need to be logged in to do KYC. Please login again.");return yield this.moralis.Cloud.run("updateAccount",e)}))}isValidAccountId(e){return new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$").test(e)}updateDocuments(e){return Ze(this,void 0,void 0,(function*(){if(!this.moralis.User.current())throw new c("You need to be logged in to do KYC. Please login again.");return yield this.moralis.Cloud.run("kycActionRequiredUpdate",e)}))}}var et=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class tt extends le{constructor(e){super(e)}getQuantityByAddress(e,t){return et(this,void 0,void 0,(function*(){let n=new ce(this.moralis),i=yield n.getSymbolContractAddress(e);if(i===J)return new z(0);let o=yield this.getOptions("balanceOf",i,{account:t});return yield this.executeFunction(o).then((e=>{let t=this.moralis.Units.FromWei(e.toString(),18);return new z(t)})).catch((e=>{let t=new se(e);return b.report(t),new z(0)}))}))}transfer(e,t){return et(this,void 0,void 0,(function*(){let n=ae.getContractInfo(),i=yield this.getOptions("transfer",e,{recipient:n.AUSD_ADDRESS,amount:Moralis.Units.Token(t.toString(),18)});return yield this.executeFunction(i).then((e=>e)).catch((e=>{let t=new se(e);throw b.report(t)}))}))}getOptions(e,t,n){return et(this,void 0,void 0,(function*(){let i=yield this.getSecurityTokenAbi();return{contractAddress:t,functionName:e,abi:i,params:n}}))}getSecurityTokenAbi(){return et(this,void 0,void 0,(function*(){if(tt.SecurityTokenInfo)return tt.SecurityTokenInfo.abi;let e=yield fetch("../abi/SecurityToken.json");return tt.SecurityTokenInfo=yield e.json(),tt.SecurityTokenInfo.abi}))}}class nt{show(e,t,n,i){let o=document.getElementById("progress");o&&(i&&i.forEach((e=>{let t=document.getElementById(e);t&&(t.style.display="none")})),o.style.display="block",o.innerHTML='<div class="progress_text">'+e+"</div>",o.style.width=t+"%",o.classList.toggle("progress-bar-striped",100!=t),o.classList.toggle("progress-bar-animated",100!=t),n?(o.classList.add("bg-warning"),o.classList.add("progress_text_attn")):(o.classList.remove("bg-warning"),o.classList.remove("progress_text_attn")))}}var it;class ot{constructor(e){this.moralis=e}getOrderBuyTablePrefix(){return s.getInstance().Name}subscribeToTable(e,t){return n=this,i=void 0,a=function*(){let n=this.getOrderBuyTablePrefix()+"Order"+e;console.log("subscribe to table:"+n);let i=new this.moralis.Query(n);(yield i.subscribe()).on("update",(e=>{const n=e.toJSON();console.log("object updated",JSON.stringify(n),n);let i=' <a class="white-link" target="_blank" href="https://mumbai.polygonscan.com/tx/'+n.transaction_hash+'">View transaction</a>';t(n),console.log("status:",n.status);let o=new nt;!n.status&&n.confirmed||"money_sent"==n.status?o.show("Blockchain has confirmed, money has been sent to broker."+i,56):"money_arrived"==n.status?o.show("Money has arrived, will now execute your buy order."+i,70):"order_requested"==n.status?o.show("Buy order has been executed. We will update you when it has been filled."+i,84):"order_filled"==n.status?o.show("Order has been filled, you will receive "+n.filledQty+" "+Symbol+" soon into your wallet."+i,100):o.show("Waiting for blockchain to confirm transaction.",99)}))},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,s)}l((a=a.apply(n,i||[])).next())}));var n,i,o,a}}!function(e){e.Sell="Sell",e.Buy="Buy"}(it||(it={}));var at=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class rt{constructor(e,t){this.timeOut=void 0,this.moralis=e,this.onNativeTokenArrived=t,this.modal=new u}show(){let e=s.getInstance(),t=(new ee).getEthAddress();if(e.TestNetwork){let n=Handlebars.compile('You need to have {{symbol}} currency in your wallet. You use {{symbol}} to pay for using the blockchain. To get some {{symbol}} currency <ol> <li>Copy your address shown below <input value="{{ethAddress}}"/> </li> <li>Open <a href="{{faucetUrl}}" id="getNativeTokens" target="_blank">{{faucetUrl}}</a></li> <li>Paste in your address you just copied and click the submit button</li> </ol> <div class="infoBar d-none" id="waitingForNativeToken">Waiting for {{symbol}}. Window will close when you have some in you wallet. It might take few minutes after you requested it. <progress></progress> </div> ')({symbol:e.NativeSymbol,faucetUrl:e.FaucetUrl,ethAddress:t});this.modal.showModal("Get some "+e.NativeSymbol,n,!1,(()=>{this.cancelTimer()}))}else{let n=Handlebars.compile('You need to have {{symbol}} currency in your wallet. You use {{symbol}} to pay for using the blockchain. To get some {{symbol}} currency <ol> <li>Copy your address shown below <input value="{{ethAddress}}"/> </li> <li>Open <a href="{{buyUrl}}" target="_blank">{{buyUrl}}</a></li> <li>Paste in your address you just copied and click the submit button</li> </ol> ')({symbol:e.NativeSymbol,buyUrl:e.BuyUrl,ethAddress:t});this.modal.showModal("Get some "+e.NativeSymbol,n,!1,(()=>{this.cancelTimer()}))}let n=document.getElementById("getNativeTokens");n&&n.addEventListener("click",(()=>at(this,void 0,void 0,(function*(){let e=document.getElementById("waitingForNativeToken");null==e||e.classList.remove("d-none"),yield this.checkForNativeTokens()}))))}cancelTimer(){this.timeOut&&clearTimeout(this.timeOut)}checkForNativeTokens(){return at(this,void 0,void 0,(function*(){let e=s.getInstance();(yield e.hasEnoughNativeTokens(this.moralis))?(this.modal.hideModal(),this.onNativeTokenArrived()):this.timeOut=setTimeout((()=>this.checkForNativeTokens()),5e3)}))}}class st{constructor(e,t,n="image/png,image/jpeg,.pdf",i="environment"){this.maxFileSize=83886080,this.accept="image/*,.pdf",this.capture="environment",this.inputId=e,this.label=t,this.accept=n,this.capture=i}render(){return Handlebars.compile('<div> <label for="{{inputId}}">{{label}}</label> <input type="file" required id="{{inputId}}" accept="{{accept}}" capture="{{capture}}"/> <input type="hidden" id="{{inputId}}_base64" name="{{inputId}}_base64"/> <div class="error hidden" id="{{inputId}}_error"></div> </div> <div id="{{inputId}}_preview"> </div>')(this)}bindEvents(){let e=document.getElementById(this.inputId);null==e||e.addEventListener("change",(t=>{this.processFile(e)}))}processFile(e){this.hideFileRelatedInfo(e.id);let t=e.files;if(!t)return;let n=t[0];if(!n)return this.showFileRelatedInfo(e.id,"No file selected. Please select file."),void this.setBase64Input(e.id,"");if(n.size>this.maxFileSize)return this.showFileRelatedInfo(e.id,"File "+n.name+" is to large. Files cannot be larger then 10MB. You need to make it smaller before submitting your application"),void this.setBase64Input(e.id,"");let i=new FileReader;i.addEventListener("load",(()=>{this.setBase64Input(e.id,i.result)})),i.addEventListener("error",(()=>{this.showFileRelatedInfo(e.id,"Could not read file "+n.name+". Either the file is corrupt or your browser does not allow us to read it")})),i.readAsDataURL(n)}setBase64Input(e,t){let n=document.getElementById(e+"_base64");n.value=t;let i=document.getElementById(e+"_preview");i&&(-1!=t.indexOf("data:image")?i.innerHTML='<img src="'+n.value+'" />':i.innerHTML="")}showFileRelatedInfo(e,t){let n=document.getElementById(e+"_error");n&&(n.innerHTML=t,n.classList.remove("hidden"))}hideFileRelatedInfo(e){let t=document.getElementById(e+"_error");t&&t.classList.add("hidden")}static registerHandler(){Handlebars.registerHelper("fileUpload",((e,t)=>{let n=new st(e,t);return st.fileUploads.push(n),n.render()}))}}st.fileUploads=[];class lt{constructor(e){this.selector=e}validateRequiredFields(){let e=document.querySelectorAll(this.selector+" input[required], "+this.selector+" select[required]");for(let t=0;t<e.length;t++){let n=e[t];if(this.isMissingInputFromUser(n)){let e={message:"You must fill into this field",inputName:n.id,labelText:document.querySelector("label[for="+n.id+"]").innerHTML,pattern:n.pattern};return this.handle(e),!1}if(n.pattern){let e=n.pattern;if(null==n.value.match(e)){let e={message:"This is not valid date format, please use YYYY-MM-DD (year-month-date)",inputName:n.id,labelText:document.querySelector("label[for="+n.id+"]").innerHTML,pattern:n.pattern};return this.handle(e),!1}}}return!0}isMissingInputFromUser(e){return"checkbox"==e.type&&!e.checked||ve.isNullOrEmpty(e.value)}removeMissingInfo(e,t){let n=document.getElementById(e);if(!n)return;if(n.style.display="none",!t)return;let i=document.getElementById(t);i&&i.removeAttribute("aria-invalid")}setMissingInfo(e,t,n){var i,o;let a=document.getElementById(e);a&&(a.innerHTML=t,""==t?a.style.display="none":(a.style.display="block",n&&(null===(i=document.getElementById(n))||void 0===i||i.focus(),null===(o=document.getElementById(n))||void 0===o||o.setAttribute("aria-invalid","true"))))}handle(e){let t=document.getElementById(e.inputName);if(!t)return;let n=t.parentElement.querySelector(".input_error");n?n.scrollIntoView({block:"center"}):(t.setAttribute("aria-invalid","true"),t.insertAdjacentHTML("beforebegin",'<div class="input_error" style="display: block" id="input_error_'+e.inputName+'">'+e.message+"</div>"),t.focus(),e.pattern&&t.setAttribute("pattern",e.pattern),t.addEventListener("blur",(t=>{t.preventDefault(),setTimeout((()=>{let n=t.target,i=n.getAttribute("pattern");if(i&&n.value.match(i)||n.required&&n.value||n.checked){n.removeAttribute("aria-invalid");let t=document.getElementById("input_error_"+e.inputName);t&&t.remove()}}),800)})))}}var dt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class ct{constructor(e){this.modal=new u,this.templates=new Map,this.executeTradeButton=e,this.templates.set("WeDontKnowWhyHtml",'<fieldset> Your application has been rejected during KYC process.<br/><br/> We don\'t have the information on why that happened, but you can email us at <a href="mailto:info@liminal.market?subject=My application was rejected&body=Hi, can you help me to find out what the problem is? My name is _______ and I used the email _______ to register at liminal.market">info@liminal.market</a> and we can find out, and we should be able to solve it together. </fieldset>'),this.templates.set("ADDRESS_VERIFICATION",'<fieldset> <p> Address needs to be verified. Please upload document that confirms your address. A bill from the government or utility company in that last 30 days with your name it should work. </p> <div class="grid"> {{{fileUpload "address_verification" "Picture of address verification"}}} </div> </fieldset>'),this.templates.set("AFFILIATED",'<fieldset> Further information needs to be submitted if account owner is affiliated to finra or an exchange <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),this.templates.set("CONTROL_PERSON",'<fieldset> Further information needs to be submitted if account owner is a control person <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),this.templates.set("COUNTRY_NOT_SUPPORTED","<fieldset> The account owner’s country of tax residence is not supported by our KYC providers. In this case, we’ll manually perform KYC on the user </fieldset>"),this.templates.set("DATE_OF_BIRTH",'<fieldset> Date of birth needs to be verified. Please upload document that confirms your date of birth. <div class="grid"> {{{fileUpload "date_of_birth_verification" "Date of birth verification"}}} </div> </fieldset>'),this.templates.set("FAMILY_MEMBER_PEP",'<fieldset> Further information needs to be submitted if family member is a politically exposed person <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),this.templates.set("IDENTITY_VERIFICATION",'<fieldset> <p> Identity needs to be verified. This means you need to upload a new photo of your id. You might try another type of ID, such as driver\'s license if you tried passport before </p> <div class="grid"> {{{fileUpload "identity_verification" "Photo ID Front (Front of passport)"}}} </div> <div class="grid"> {{{fileUpload "identity_verification_2" "Photo ID Back (Passport picture of ID) "}}} </div> </fieldset>'),this.templates.set("INVALID_IDENTITY_PASSPORT",'<fieldset> Identity needs to be verified via a government issued ID. <div class="grid"> {{{fileUpload "identity_verification" "Photo ID Front (Front of passport)"}}} </div> <div class="grid"> {{{fileUpload "identity_verification_2" "Photo ID Back (Passport picture of ID) "}}} </div> </fieldset>'),this.templates.set("PEP",'<fieldset> Further information needs to be submitted if account owner is politically exposed person <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),this.templates.set("SELFIE_VERIFICATION",'<fieldset> Identity needs to be verified via a live selfie of the account owner <div class="grid"> {{{fileUpload "identity_verification" "Live selfie verification"}}} </div> </fieldset>'),this.templates.set("TAX_IDENTIFICATION",'<fieldset> Tax ID number needs to be verified. Please upload document that confirms your Tax Id <div class="grid"> {{{fileUpload "tax_id_verification" "Tax id verification"}}} </div> </fieldset>'),this.templates.set("VISA_TYPE_OTHER",'<fieldset> Further information needs to be submitted about account owner’s visa <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),this.templates.set("W8BEN_CORRECTION",'<fieldset> Identifying information submitted by the user was incorrect so a new, corrected, W8BEN needs to be submitted <br/> Please contact us at <a href="mailto:info@liminal.market">info@liminal.market</a> for further information </fieldset>'),st.registerHandler()}show(){return dt(this,void 0,void 0,(function*(){let e=new ee(Moralis),t=yield e.kycActionRequired();if(!t)return;let n=this.getKycMessages(t.messages),i=Handlebars.compile('<div id="kycActionRequiredDiv"> {{#if Other}} <strong>This is the message from KYC processor we received</strong> <blockquote> {{Other}} </blockquote> {{/if}} <form novalidate id="kycActionRequiredForm" name="kycActionRequiredForm" onsubmit="return!1"> {{{KycInfo}}} {{#if SubmitData}} <div class="input_error" id="kycActionRequiredError"></div> <div class="buttons"> <button type="submit" id="kycActionRequiredSubmit">Send new information</button> </div> {{/if}} </form> </div> <div id="kycActionRequiredSubmittedDiv" class="hidden center"> <h3>You documents have been submitted.<br/>We will email you when your account is ready.</h3> You can close this window. </div>')({json:JSON.stringify(t),KycInfo:n,Other:t.additional_information,SubmitData:-1!=n.indexOf("<input")});this.modal.showModal("Action required",i,!1,(()=>{}),!1);let o=document.getElementById("kycActionRequiredForm");null==o||o.addEventListener("submit",(e=>dt(this,void 0,void 0,(function*(){e.preventDefault(),this.hideError();let t=document.getElementById("kycActionRequiredSubmit");if(y.setLoading(t),!new lt("#kycActionRequiredForm").validateRequiredFields())return;let n=we.getParams("#kycActionRequiredForm"),i=new Xe(Moralis);yield i.updateDocuments(n).then((()=>{let e=document.getElementById("kycActionRequiredDiv");null==e||e.classList.add("hidden");let t=document.getElementById("kycActionRequiredSubmittedDiv");null==t||t.classList.remove("hidden"),this.executeTradeButton.checkKycIsDone(),this.executeTradeButton.renderButton()})).catch((e=>{this.showError(e)})).finally((()=>{y.removeLoading()}))}))));for(let e=0;e<st.fileUploads.length;e++)st.fileUploads[e].bindEvents()}))}getKycMessages(e){let t="";for(let n=0;n<e.length;n++){let i=this.templates.get(e[n].key);i&&(t+=Handlebars.compile(i)({message:e[n].message}))}if(""==t){let e=this.templates.get("WeDontKnowWhyHtml");t=Handlebars.compile(e)({})}return t}hideError(){let e=document.getElementById("kycActionRequiredError");e&&(e.style.display="none")}showError(e){let t=document.getElementById("kycActionRequiredError");t&&(t.innerHTML="Error occurred while saving your documents. Reason:"+e,t.style.display="block")}}class ut{constructor(e,t){var n,i;this.validValues="",this.inputName="",this.labelText="",this.pattern="";let o={};try{o=e.inputName?e:JSON.parse(e),this.message=null===(n=o.message)||void 0===n?void 0:n.replace(/_/g," "),this.validValues=null===(i=o.validValues)||void 0===i?void 0:i.replace(/_/g," "),this.inputName=o.inputName,this.labelText=o.labelText,this.pattern=o.pattern,this.onshow=o.onshow}catch(t){this.message=e.messsage}this.kycForm=t}handle(){if(ve.isNullOrEmpty(this.inputName)){let e=document.querySelector(this.kycForm.activeFieldsetSelector).querySelector(".input_error");return void(e&&(this.validValues?e.innerHTML=this.validValues.toString():this.message&&-1!=this.message.indexOf("Invalid function")||-1!=this.message.indexOf("Unable to connect to the Parse API")?e.innerHTML="We just deployed new version of our website. This can cause interruption. Please wait 30 seconds and submit again":e.innerHTML=this.message,e.style.display="block",e.scrollIntoView()))}let e=document.getElementById(this.inputName);if(!e)return;let t=e.parentElement.querySelector(".input_error");if(t)return void t.scrollIntoView({block:"center"});e.setAttribute("aria-invalid","true");let n='<div class="input_error" style="display: block" id="input_error_'+this.inputName+'">'+this.message+"</div>";e.clientWidth<300?this.getDivToDisplayErrorMessage(e).insertAdjacentHTML("beforebegin",n):e.insertAdjacentHTML("beforebegin",n),e.focus(),this.pattern&&e.setAttribute("pattern",this.pattern),e.addEventListener("blur",(e=>{e.preventDefault(),setTimeout((()=>{let t=e.target,n=t.getAttribute("pattern");if(n&&t.value.match(n)||"checkbox"!=t.type&&"radio"!=t.type&&t.required&&t.value||t.checked){t.removeAttribute("aria-invalid");let e=document.getElementById("input_error_"+this.inputName);e&&e.remove()}}),800)}));let i=e.closest('fieldset[data-form="1"]');if(i){let t=i.className.replace("hidden","").trim();this.kycForm.show(t),e.scrollIntoView(!1)}if(this.onshow){let e=document.getElementById(this.onshow.id);if(!e)return;e.addEventListener("click",(e=>{return t=this,n=void 0,o=function*(){e.preventDefault(),yield Moralis.Cloud.run(this.onshow.functionName,this.onshow.params),document.getElementById("input_error_"+this.inputName).innerHTML="Email has been sent to "+this.onshow.params.email},new((i=void 0)||(i=Promise))((function(e,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}))}}getDivToDisplayErrorMessage(e,t=1){let n=e.parentElement.closest("div");return n?n.clientWidth>300||t>5?n:this.getDivToDisplayErrorMessage(n,++t):e}}class ht{constructor(e){this.kycForm=e,st.registerHandler()}showFieldset(e,t){var n;this.hideFieldsets(),null===(n=document.querySelector(e))||void 0===n||n.classList.remove("hidden"),document.querySelector("#liminal_market_modal_div > article > header > span").innerHTML=t,document.querySelector("#liminal_market_modal_div > article").scrollTop=0,this.kycForm.activeFieldsetSelector=e}showRequiredMarker(){let e=document.querySelectorAll("input, select");for(let t=0;t<e.length;t++){let n=e[t];if(!n.id)continue;let i=document.querySelector("label[for="+n.id+"]");i&&(n.required?-1==i.innerHTML.indexOf("*")&&(i.innerHTML+="*"):-1!=i.innerHTML.indexOf("*")&&(i.innerHTML=i.innerHTML.replace("*","")))}}setRequired(e){var t;null===(t=document.getElementById(e))||void 0===t||t.setAttribute("required","required")}removeRequired(e){var t;null===(t=document.getElementById(e))||void 0===t||t.removeAttribute("required")}bind(e,t,n){let i=document.querySelectorAll(e);for(let e=0;e<i.length;e++)i[e].addEventListener(t,(e=>{n(e)}))}bindFileUploads(){for(let e=0;e<st.fileUploads.length;e++)st.fileUploads[e].bindEvents()}hideFieldsets(){let e=document.querySelectorAll("#kyc_wizard_form > fieldset");for(let t=0;t<e.length;t++)e[t].classList.add("hidden")}validateRequiredFields(e){let t=document.querySelectorAll(e+" input[required], "+e+" select[required]");for(let e=0;e<t.length;e++){let n=t[e];if(this.isMissingInputFromUser(n)){let e={message:"You must fill into this field",inputName:n.id,labelText:document.querySelector("label[for="+n.id+"]").innerHTML,pattern:n.pattern};return new ut(e,this.kycForm).handle(),!1}if(n.pattern){let e=n.pattern;if(null==n.value.match(e)){let e={message:"This is not valid date format, please use YYYY-MM-DD (year-month-date)",inputName:n.id,labelText:document.querySelector("label[for="+n.id+"]").innerHTML,pattern:n.pattern};return new ut(e,this.kycForm).handle(),!1}}}return!0}showElement(e){var t;null===(t=document.getElementById(e))||void 0===t||t.classList.remove("hidden")}hideElement(e){var t;null===(t=document.getElementById(e))||void 0===t||t.classList.add("hidden")}setLabel(e,t){let n=document.getElementById("tax_id_label");n&&(n.innerHTML=t)}isMissingInputFromUser(e){return"checkbox"==e.type&&!e.checked||ve.isNullOrEmpty(e.value)}removeMissingInfo(e,t){let n=document.getElementById(e);if(!n)return;if(n.style.display="none",!t)return;let i=document.getElementById(t);i&&i.removeAttribute("aria-invalid")}setMissingInfo(e,t,n){var i,o;let a=document.getElementById(e);a&&(a.innerHTML=t,""==t?a.style.display="none":(a.style.display="block",n&&(null===(i=document.getElementById(n))||void 0===i||i.focus(),null===(o=document.getElementById(n))||void 0===o||o.setAttribute("aria-invalid","true"))))}}class mt extends ht{constructor(e){super(e),this.usTaxResidence=!1}render(e=!1){return Handlebars.compile('<fieldset class="kycContact hidden" data-form="1"> <div class="explain"> To be able to trade on the stock market, we need to get your information. This is a requirement from the financial regulators. </div> <div> <label for="email_address">Email</label> <input type="email" required class="form-control" id="email_address" name="email_address" placeholder="name@example.com" autocomplete="email" value=""> </div> <div> <label for="phone_number">Phone</label> <input type="tel" class="form-control" id="phone_number" name="phone_number" placeholder="+1-555-666-7788" autocomplete="tel" value=""> </div> <div> <label for="street_address">Permanent Residential Address</label> <div class="explain">It must be a physical address, not a PO box.</div> <input required id="street_address" name="street_address" placeholder="20 N San Mateo Dr" value="" autocomplete="address-line1"> </div> <div> <label for="unit">Unit / Apt #</label> <input id="unit" name="unit" value=""> </div> <div> <label for="city">City</label> <input id="city" name="city" placeholder="Pawnee" value="" autocomplete="address-level2"> </div> <div> <label for="postal_code">Postal code</label> <input required id="postal_code" autocomplete="postal-code" name="postal_code" placeholder="94401" value=""> </div> <div id="state_div"> <label for="state">State (2 letters)</label> <input maxlength="2" id="state" name="state" placeholder="NY" value="" autocomplete="address-level1"> </div> <div> <label for="country_of_tax_residence">Country of tax residence</label> {{#if edit}} <input name="country_of_tax_residence" readonly="readonly" id="country_of_tax_residence"/> {{/if}} {{#unless edit}} <select required id="country_of_tax_residence" name="country_of_tax_residence" autocomplete="country"> <option value=""></option> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> {{/unless}} </div> <div class="buttons"> <button type="button" id="contact_next">Next: Identity</button> </div> </fieldset> ')({edit:e,countries:Ee.Countries})}show(){this.showFieldset(".kycContact","Contact information")}bindEvents(){this.bind("#country_of_tax_residence","change",(e=>{var t,n;let i=e.target;this.usTaxResidence="USA"==i.value.toUpperCase(),this.usTaxResidence?(null===(t=document.getElementById("state_div"))||void 0===t||t.classList.remove("hidden"),this.kycForm.setSteps(5),this.setRequired("state")):(this.kycForm.setSteps(6),this.removeRequired("state"),null===(n=document.getElementById("state_div"))||void 0===n||n.classList.add("hidden"))}));let e=document.getElementById("contact_next");e&&e.addEventListener("click",(e=>{this.validateRequiredFields(".kycContact")&&this.kycForm.kycIdentity.show()}))}}class ft extends ht{constructor(e){super(e),this.edit=!1}render(e=!1){return this.edit=e,Handlebars.compile('<fieldset class="kycIdentity hidden" data-form="1"> <div> <label for="given_name">Legal First name</label> <input required id="given_name" name="given_name" placeholder="Ron" value="" autocomplete="given-name"> </div> <div> <label for="middle_name">Legal Middle name</label> <input id="middle_name" name="middle_name" placeholder="" value="" autocomplete="additional-name"> </div> <div> <label for="family_name">Legal Last name</label> <input required id="family_name" name="family_name" placeholder="Swanson" value="" autocomplete="family-name"> </div> {{#unless edit}} <div> <label for="date_of_birth">Date of birth</label> <input type="date" required id="date_of_birth" name="date_of_birth" placeholder="1978-11-24" pattern="\\d{4}-\\d{2}-\\d{2}" value="" autocomplete="bday"> </div> <div id="citizen_of_usa_question" class="hidden"> <label for="citizen_yes">Are you a citizen of the United States?</label> <fieldset> <label> <input type="radio" id="citizen_yes" name="citizen" value="1"> Yes </label> <label> <input type="radio" id="citizen_no" name="citizen" value="0"> No </label> <fieldset id="citizen_no_type_options" class="hidden"> <label> <input type="radio" name="permanent_resident" id="citizen_no_type_options_1" value="1"/> Green Card / Permanent Resident </label> <label><input type="radio" name="permanent_resident" id="citizen_no_type_options_2" value="0"/> Visa</label> </fieldset> </fieldset> </div> <div id="tax_id_type_options"> <label for="tax_id_type">Tax Id Type</label> <select required id="tax_id_type" name="tax_id_type" placeholder="USA_SSN"> <option value="USA_SSN"></option> <option value="ARG_AR_CUIT">Argentina CUIT</option> <option value="AUS_TFN">Australian Tax File Number</option> <option value="AUS_ABN">Australian Business Number</option> <option value="BOL_NIT">Bolivia NIT</option> <option value="BRA_CPF">Brazil CPF</option> <option value="CHL_RUT">Chile RUT</option> <option value="COL_NIT">Colombia NIT</option> <option value="CRI_NITE">Costa Rica NITE</option> <option value="DEU_TAX_ID">Germany Tax ID (Identifikationsnummer)</option> <option value="DOM_RNC">Dominican Republic RNC</option> <option value="ECU_RUC">Ecuador RUC</option> <option value="FRA_SPI">France SPI (Reference Tax Number)</option> <option value="GBR_UTR">UK UTR (Unique Taxpayer Reference)</option> <option value="GBR_NINO">UK NINO (National Insurance Number)</option> <option value="GTM_NIT">Guatemala NIT</option> <option value="HND_RTN">Honduras RTN</option> <option value="HUN_TIN">Hungary TIN Number</option> <option value="IDN_KTP">Indonesia KTP</option> <option value="IND_PAN">India PAN Number</option> <option value="ISR_TAX_ID">Israel Tax ID (Teudat Zehut)</option> <option value="ITA_TAX_ID">Italy Tax ID (Codice Fiscale)</option> <option value="JPN_TAX_ID">Japan Tax ID (Koijin Bango)</option> <option value="MEX_RFC">Mexico RFC</option> <option value="NIC_RUC">Nicaragua RUC</option> <option value="NLD_TIN">Netherlands TIN Number</option> <option value="PAN_RUC">Panama RUC</option> <option value="PER_RUC">Peru RUC</option> <option value="PRY_RUC">Paraguay RUC</option> <option value="SGP_NRIC">Singapore NRIC</option> <option value="SGP_FIN">Singapore FIN</option> <option value="SGP_ASGD">Singapore ASGD</option> <option value="SGP_ITR">Singapore ITR</option> <option value="SLV_NIT">El Salvador NIT</option> <option value="SWE_TAX_ID">Sweden Tax ID (Personnummer)</option> <option value="URY_RUT">Uruguay RUT</option> <option value="VEN_RIF">Venezuela RIF</option> <option value="NOT_SPECIFIED">Other Tax IDs</option> </select> </div> <div> <label id="tax_id_label" for="tax_id">Tax Id (SSN)</label> <input required id="tax_id" name="tax_id" placeholder="666-55-4321" value=""> </div> <div id="country_of_birth_option"> <label for="country_of_birth">Country of birth</label> <select id="country_of_birth" name="country_of_birth"> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </div> <div id="country_of_citizenship_option"> <label for="country_of_citizenship">Country of citizenship</label> <select required id="country_of_citizenship" name="country_of_citizenship"> <option value=""></option> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </div> <div id="visa_type_option" class="hidden"> <div> <label for="visa_type">Visa type - <a href="https://travel.state.gov/content/travel/en/us-visas/visa-information-resources/all-visa-categories.html" target="_blank">Visa information</a></label> <select id="visa_type" name="visa_type"> <option value=""></option> <option value="B1" selected="selected">USA Visa Category B-1</option> <option value="B2">USA Visa Category B-2</option> <option value="DACA">USA Visa Category DACA</option> <option value="E1">USA Visa Category E-1</option> <option value="E2">USA Visa Category E-2</option> <option value="E3">USA Visa Category E-3</option> <option value="F1">USA Visa Category F-1</option> <option value="G4">USA Visa Category G-4</option> <option value="H1B">USA Visa Category H-1B</option> <option value="J1">USA Visa Category J-1</option> <option value="L1">USA Visa Category L-1</option> <option value="OTHER">Any other USA Visa Category</option> <option value="O1">USA Visa Category O-1</option> <option value="TN1">USA Visa Category TN-1</option> </select> </div> <div id="visa_expiration_date_option"> <label for="visa_expiration_date">Visa expiration date</label> <input type="date" id="visa_expiration_date" name="visa_expiration_date" placeholder="2028-05-01" value=""> </div> <div id="date_of_departure_from_usa_option"> <label for="date_of_departure_from_usa">Date of departure from USA</label> <input type="date" id="date_of_departure_from_usa" name="date_of_departure_from_usa" placeholder="2028-05-01" value=""> </div> </div> <div> <label for="annual_income">Annual Household Income</label> <div class="explain"> Annual household income includes income from sources such as employment, alimony, social security, investment income, etc. </div> <select name="annual_income" id="annual_income"> <option value=""></option> <option value="1">0 - $20,000</option> <option value="2">$20,000 - $49,999</option> <option value="3">$50,000 - $99,999</option> <option value="4">$100,000 - $499,999</option> <option value="5">$500,000 - $999,999</option> <option value="6">$1,000,000 - $9,999,999</option> </select> </div> <div> <label for="liquid_net_worth">Liquid Assets</label> <div class="explain">Liquid assets is your net worth minus assets that cannot be converted quickly and easily into cash, such as real estate, business equity, personal property and automobiles, expected inheritances, assets earmarked for other purposes, and investments or accounts subject to substantial penalties if they were sold or if assets were withdrawn from them. </div> <select name="liquid_net_worth" required id="liquid_net_worth"> <option value=""></option> <option value="1">0 - $20,000</option> <option value="2">$20,000 - $49,999</option> <option value="3">$50,000 - $99,999</option> <option value="4">$100,000 - $499,999</option> <option value="5">$500,000 - $999,999</option> <option value="1">$1,000,000 - $9,999,999</option> </select> </div> <div> <label for="funding_source">Funding source</label> <select required id="funding_source" name="funding_source" multiple="multiple" size="4" aria-label="size 3 select"> <option value="employment_income">Employment income</option> <option value="investments">Investments</option> <option value="inheritance">Inheritance</option> <option value="business_income">Business income</option> <option value="savings">Savings</option> <option value="family">Family</option> </select> </div> {{/unless}} <div class="grid buttons"> <button type="button" id="identity_prev">Previous: Contact</button> <button type="button" id="identity_next">Next: Trusted contacts</button> </div> </fieldset>')({edit:e,countries:Ee.Countries})}show(){this.kycForm.kycContact.usTaxResidence?(this.showElement("citizen_of_usa_question"),this.hideElement("tax_id_type_options"),this.setLabel("tax_id_label","SSN")):(this.hideElement("citizen_of_usa_question"),this.setLabel("tax_id_label","National Tax Id (SSN)"),this.showElement("tax_id_type_options")),this.showFieldset(".kycIdentity","Identity"),this.showElement("country_of_citizenship_option");let e=document.getElementById("country_of_citizenship");e&&(e.options[1].disabled=!1)}bindEvents(){this.bind("#citizen_yes","click",(e=>{if(e.target.checked){let e=document.getElementById("tax_id_type");e&&(e.value="USA_SSN");let t=document.getElementById("country_of_citizenship");t.options[1].disabled=!1,t.value="USA",this.hideElement("citizen_no_type_options"),this.hideElement("visa_type_option"),this.hideElement("country_of_citizenship_option"),this.removeRequired("country_of_birth"),this.removeRequired("visa_type"),this.removeRequired("visa_expiration_date"),this.removeRequired("date_of_departure_from_usa"),document.getElementById("tax_id_label").innerHTML="SSN",this.hideCitizenErrorMessage()}})),this.bind("#citizen_no","click",(e=>{if(e.target.checked){this.showElement("citizen_no_type_options"),this.showElement("country_of_citizenship_option"),this.setRequired("country_of_birth"),document.getElementById("tax_id_label").innerHTML="SSN";let e=document.getElementById("country_of_citizenship");e.options[0].selected=!0,e.options[1].disabled=!0,this.hideCitizenErrorMessage()}})),this.bind("#citizen_no_type_options_1","click",(e=>{e.target.checked&&(this.showElement("country_of_citizenship_option"),this.hideElement("visa_type_option"),this.setRequired("country_of_birth"),this.removeRequired("visa_type"),this.removeRequired("visa_expiration_date"),this.removeRequired("date_of_departure_from_usa"))})),this.bind("#citizen_no_type_options_2","click",(e=>{e.target.checked&&(this.showElement("visa_type_option"),this.showElement("country_of_citizenship_option"),this.setRequired("country_of_birth"),this.setRequired("country_of_citizenship"),this.setRequired("visa_type"),this.setRequired("visa_expiration_date"),this.setRequired("date_of_departure_from_usa"))})),this.bind("#visa_type","change",(e=>{let t=e.target;"B1"==t.value||"B2"==t.value?this.showElement("date_of_departure_from_usa_option"):this.hideElement("date_of_departure_from_usa_option")})),this.bindButtons()}hideCitizenErrorMessage(){document.getElementById("citizen_yes").removeAttribute("aria-invalid");let e=document.getElementById("input_error_citizen_yes");e&&e.remove()}bindButtons(){let e=document.getElementById("identity_prev");null==e||e.addEventListener("click",(e=>{this.kycForm.kycContact.show()}));let t=document.getElementById("identity_next");null==t||t.addEventListener("click",(e=>{this.validateInputs()&&this.validateRequiredFields(".kycIdentity")&&this.kycForm.kycTrustedContact.show()}))}validateInputs(){if(this.edit)return!0;let e=document.getElementById("citizen_yes"),t=document.getElementById("citizen_no");if(!this.kycForm.kycContact.usTaxResidence)return e.checked=!1,t.checked=!1,!0;if(!e.checked&&!t.checked){let e={message:"You must select either option",inputName:"citizen_yes",labelText:document.querySelector("label[for=citizen_yes]").innerHTML};return new ut(e,this.kycForm).handle(),!1}let n=document.getElementById("citizen_no_type_options_1"),i=document.getElementById("citizen_no_type_options_2");return!(t.checked&&!n.checked&&!i.checked)||(new ut({message:'You must select either option, "Green Card / Permanent Resident" or "Visa"',inputName:"citizen_no",labelText:""},this.kycForm).handle(),!1)}}class pt extends ht{constructor(e){super(e)}render(){return Handlebars.compile('<fieldset id="affiliate_or_controlled"> <div>You need to fill in the following information</div> <div> <label for="company_name">Company name</label> <input name="company_name" required id="company_name" autocomplete="organization"/> </div> <div> <label for="company_street_address">Company street address</label> <input name="company_street_address" required id="company_street_address"/> </div> <div> <label for="company_city">Company city</label> <input name="company_city" required id="company_city"/> </div> <div> <label for="company_state">Company state</label> <input name="company_state" required id="company_state"/> </div> <div> <label for="company_country">Company country</label> <select required id="company_country" required name="company_country"> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </div> <div> <label for="company_compliance_email">Company compliance officer email</label> <input name="company_compliance_email" required id="company_compliance_email"/> </div> <div> <div class="explain"> In accordance with applicable FINRA rules, user will need to obtain a letter written and signed by a compliance officer on company letterhead explicitly granting permission for the applicant to carry the account and explicitly stating whether or not the firm requires access to duplicate account statements and/or trade confirmations. If the firm would like online access your duplicate account statements and/or trade confirmations, include in the letter the applicant\'s full name and the following information for the interested party: First and last name, title, email address, telephone number. </div> {{{fileUpload "account_approval_letter" "Account approval letter"}}} </div> </fieldset> ')({countries:Ee.Countries})}bindEvents(){this.bindFileUploads();let e=document.getElementById("company_country");null==e||e.addEventListener("change",(e=>{"USA"===e.target.value?this.setRequired("company_state"):this.removeRequired("company_state")}))}validate(){return!document.getElementById("company_name")||this.validateRequiredFields("#affiliate_or_controlled")}}class yt extends ht{constructor(e){super(e)}render(){return Handlebars.compile('<fieldset id="immediate_family"> <div>Since you chose that your immediate family member, you need to fill in the following information</div> <div> <label for="disclosure_given_name">Given name of political person</label> <input name="disclosure_given_name" id="disclosure_given_name"/> </div> <div> <label for="disclosure_family_name">Family name of political person</label> <input name="disclosure_family_name" id="disclosure_family_name"/> </div> </fieldset>')({})}bindEvents(){}validate(){return!document.getElementById("disclosure_given_name")||this.validateRequiredFields("#immediate_family")}}class vt extends ht{constructor(e){super(e),this.kycAffiliatedOrControlled=new pt(this.kycForm),this.kycImmediateFamily=new yt(this.kycForm)}render(e=!1){return Handlebars.compile('<fieldset class="kycDisclosures hidden" data-form="1"> {{#unless edit}} <div> <label for="employment_status">Employment status</label> <select id="employment_status" required name="employment_status"> <option value=""></option> <option value="employed">Employed</option> <option value="unemployed">Unemployed</option> <option value="retired">Retired</option> <option value="student">Student</option> </select> </div> <div> <label for="employer_name">Employer name</label> <input name="employer_name" id="employer_name"/> </div> <div> <label for="employer_address">Employer address</label> <input name="employer_address" id="employer_address"/> </div> <div> <label for="employment_position">Occupation / Job title</label> <input name="employment_position" id="employment_position" autocomplete="organization-title"/> </div> {{/unless}} <div class="disclosure_selections"> Do any of the following apply to you or a member of your immediate family? <div class="grid"> <div> <label for="is_affiliated_exchange_or_finra"> <input type="checkbox" id="is_affiliated_exchange_or_finra" name="is_affiliated_exchange_or_finra" role="switch"> </label> </div> <div> Affiliated or work with a US registered broker-dealer or FINRA. <small class="explain">Are you or an immediate family member affiliated with or employed by a stock exchange, regulatory body, member firm of an exchange, FINRA or a municipal securities broker-dealer?</small> <div id="is_affiliated_exchange_or_finra_extra"></div> </div> </div> <div class="grid"> <div> <label for="is_control_person"> <input type="checkbox" id="is_control_person" name="is_control_person" role="switch"> </label> </div> <div> Senior executive at or a 10% or greater shareholder of a publicly traded company. <small class="explain">Are you or an immediate family member an officer or 10% or greater shareholder of a publicly traded company, subject to the US Securities Exchange Act 1934?</small> <div id="is_control_person_extra"></div> </div> </div> <div class="grid"> <div> <label for="is_politically_exposed"> <input type="checkbox" id="is_politically_exposed" name="is_politically_exposed" role="switch"> </label> </div> <div> I am a senior political figure. <small class="explain">Are you currently or formerly a Politically Exposed Person or Public Official (PEP)? <a href="https://www.google.com/search?q=%E2%80%9CPolitically+Exposed+Person%E2%80%9D+(PEP)" target="_blank">What is PEP?</a> </small> <div id="is_politically_exposed_extra"></div> </div>  </div> <div class="grid"> <div> <label for="immediate_family_exposed"> <input type="checkbox" id="immediate_family_exposed" name="immediate_family_exposed" role="switch"> </label> </div> <div> I am a family member or relative of a senior political figure. <small class="explain">Are you an immediate family member currently or formerly a Politically Exposed Person or Public Official (PEP)? <a href="https://www.google.com/search?q=%E2%80%9CPolitically+Exposed+Person%E2%80%9D+(PEP)" target="_blank">What is PEP?</a></small> <div id="immediate_family_exposed_extra"></div> </div> </div> <div class="grid"> <div> <label for="none_above"> <input type="checkbox" id="none_above" name="none_above" role="switch"></label> </div> <div> None of the above apply to me or my family. </div> </div> <div class="input_error" id="none_above_error"></div> </div> <div class="grid buttons"> <button type="button" id="disclosures_prev">Previous: Trusted contact</button> <button type="button" id="disclosures_next">Next: Agreements</button> </div> </fieldset>')({edit:e})}show(){5==this.kycForm.steps?document.getElementById("disclosures_next").innerText="Next: Agreements":document.getElementById("disclosures_next").innerText="Next: Upload documents",this.showFieldset(".kycDisclosures","Disclosures")}bindEvents(){let e=document.getElementById("is_affiliated_exchange_or_finra");null==e||e.addEventListener("click",(e=>{this.loadAffiliatedOrControlComponent("is_affiliated_exchange_or_finra")}));let t=document.getElementById("is_control_person");null==t||t.addEventListener("click",(e=>{this.loadAffiliatedOrControlComponent("is_control_person")}));let n=document.getElementById("immediate_family_exposed");null==n||n.addEventListener("click",(e=>{this.loadPep("immediate_family_exposed")}));let i=document.getElementById("is_politically_exposed");null==i||i.addEventListener("click",(e=>{this.uncheck("immediate_family_exposed")}));let o=document.getElementById("none_above");null==o||o.addEventListener("click",(e=>{this.removeMissingInfo("none_above_error"),o.removeAttribute("aria-invalid")}));let a=document.getElementById("disclosures_prev");null==a||a.addEventListener("click",(e=>{this.kycForm.kycTrustedContact.show()}));let r=document.getElementById("disclosures_next");null==r||r.addEventListener("click",(e=>{this.validateFields()&&(5==this.kycForm.steps?this.kycForm.kycAccountAgreement.show():this.kycForm.kycUpload.show())}))}loadAffiliatedOrControlComponent(e){"is_affiliated_exchange_or_finra"==e?this.uncheck("is_control_person"):this.uncheck("is_affiliated_exchange_or_finra");let t=document.getElementById(e),n=document.getElementById(e+"_extra");n&&(t.checked?(n.innerHTML=this.kycAffiliatedOrControlled.render(),this.kycAffiliatedOrControlled.bindEvents()):n.innerHTML="")}loadPep(e){"immediate_family_exposed"==e?this.uncheck("is_politically_exposed"):this.uncheck("immediate_family_exposed");let t=document.getElementById(e),n=document.getElementById(e+"_extra");n&&(t.checked?(n.innerHTML=this.kycImmediateFamily.render(),this.kycImmediateFamily.bindEvents()):n.innerHTML="")}uncheck(e){document.getElementById(e).checked=!1,document.getElementById(e+"_extra").innerHTML=""}validateFields(){if(!this.validateRequiredFields(".kycDisclosures"))return!1;if(!this.kycImmediateFamily.validate())return!1;if(!this.kycAffiliatedOrControlled.validate())return!1;let e=document.getElementById("is_affiliated_exchange_or_finra"),t=document.getElementById("is_control_person"),n=document.getElementById("is_politically_exposed"),i=document.getElementById("immediate_family_exposed"),o=document.getElementById("none_above");return o.checked||e.checked||t.checked||n.checked||i.checked?!o.checked||!(e.checked||t.checked||n.checked||i.checked)||(this.setMissingInfo("none_above_error",'You cannot have "None of the above apply to me or my family." selected and other options selected. Please select only one',"none_above"),!1):(this.setMissingInfo("none_above_error",'You must select, "None of the above apply to me or my family." if nothing is selected',"none_above"),!1)}}class gt extends ht{constructor(e){super(e)}render(e=!1){return Handlebars.compile('<fieldset class="kycAccountAgreement hidden" data-form="1"> <div class="kycAccountAgreementGrid"> <div id="account_agreement_error" class="input_error"></div> <div class="grid"> <div> <label for="account_agreement"> <input required type="checkbox" name="account_agreement" id="account_agreement" value="1"/> </label> </div> <div> <label for="account_agreement"> I agree to <a href="https://files.alpaca.markets/disclosures/library/AcctAppMarginAndCustAgmt.pdf" target="_blank">Alpaca Customer Agreement</a> </label> </div> </div> <div id="customer_agreement_error" class="input_error"></div> <div class="grid"> <div> <label for="customer_agreement"> <input required type="checkbox" name="customer_agreement" id="customer_agreement" value="1"/> </label> </div> <div> <label for="customer_agreement"> Customer Agreement Acknowledgement</label> <div class="explain"> I have read, understood, and agree to be bound by Alpaca Securities LLC and Liminal.market Inc. account terms, and all other terms, disclosures and disclaimers applicable to me, as referenced in the Alpaca Customer Agreement. I also acknowledge that the Alpaca Customer Agreement contains a pre-dispute arbitration clause in Section 43. </div> </div> </div> <div id="digital_signature_error" class="input_error"></div> <div class="grid"> <div> <label for="digital_signature"> <input required type="checkbox" name="digital_signature" id="digital_signature" value="1"/> </label> </div> <div> <label for="digital_signature"> Digital Signature Acknowledgement</label> <div class="explain"> I understand I am signing this agreement electronically, and that my electronic signature will have the same effect as physically signing and returning the Application Agreement. </div> </div> </div> <div class="grid hidden" id="w8disclosure_div"> <div> <label for="w8disclosure"> <input required type="checkbox" name="w8disclosure" id="w8disclosure" value="1"/> </label> </div> <div><label for="w8disclosure"> I certify that I am not a US citizen, US resident alien or other US person for US tax purposes, and I am submitting the applicable Form W-8 BEN with this form to certify my foreign status and, if applicable, claim tax treaty benefits. </label> </div> </div> </div> <div class="grid buttons"> <button type="button" id="account_agreement_prev">Previous: Upload documents</button> <button type="submit" id="submitKYC">Confirm identity</button> </div> <div class="alert alert-danger" id="kycError" role="alert"></div> </fieldset> ')({edit:e})}show(){var e,t;this.showFieldset(".kycAccountAgreement","Agreements"),5==this.kycForm.steps?document.getElementById("account_agreement_prev").innerText="Previous: Disclosure":document.getElementById("account_agreement_prev").innerText="Previous: Upload documents",this.kycForm.kycContact.usTaxResidence?null===(e=document.getElementById("w8disclosure_div"))||void 0===e||e.classList.add("hidden"):null===(t=document.getElementById("w8disclosure_div"))||void 0===t||t.classList.remove("hidden")}bindEvents(){let e=document.getElementById("account_agreement_prev");null==e||e.addEventListener("click",(e=>{5==this.kycForm.steps?this.kycForm.kycDisclosures.show():this.kycForm.kycUpload.show()})),this.bindSubmitKyc()}bindSubmitKyc(e=!1){let t=document.getElementById("submitKYC");t&&t.addEventListener("click",(t=>{return n=this,i=void 0,a=function*(){if(t.preventDefault(),!e&&!this.validate())return;let n=document.getElementById("account_agreement_prev"),i=(document.getElementById("liminal_market_modal_close"),t.target);y.setLoading(i);let o=we.getParams("#kyc_wizard_form"),a=s.getInstance();o.chainId=a.ChainId;let r=new Xe(Moralis);(yield r.saveKYCInfo(o).catch((e=>{n&&n.classList.remove("hidden"),y.removeLoading(),e.message?new ut(e.message,this.kycForm).handle():console.log(e)})))?(this.kycForm.kycWaiting.show(),At.Instance.renderButton()):(n&&n.classList.remove("hidden"),y.removeLoading())},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,s)}l((a=a.apply(n,i||[])).next())}));var n,i,o,a}))}validate(){let e=document.getElementById("account_agreement");if(!(null==e?void 0:e.checked))return this.setMissingInfo("account_agreement_error","You need to agree to agreements","account_agreement"),!1;this.removeMissingInfo("account_agreement_error","account_agreement");let t=document.getElementById("customer_agreement");if(!(null==t?void 0:t.checked))return this.setMissingInfo("customer_agreement_error","You need to agree to customer agrement","customer_agreement"),!1;this.removeMissingInfo("customer_agreement_error","customer_agreement");let n=document.getElementById("digital_signature");return(null==n?void 0:n.checked)?(this.removeMissingInfo("digital_signature_error","digital_signature"),!0):(this.setMissingInfo("digital_signature_error","You need to sign","digital_signature"),!1)}}class bt extends ht{constructor(e){super(e),this.edit=!1}render(e=!1){return this.edit=e,Handlebars.compile('<fieldset class="kycTrustedContact hidden" data-form="1"> <div class="explain"> A trusted contact is a person you authorize your financial firm to contact in limited circumstances, such as if there is a concern about activity in your account and they have been unable to get in touch with you. <br/><br/> A trusted contact may be a family member, attorney, accountant or another third-party who you believe would respect your privacy and know how to handle the responsibility. The trusted person should be 18 years old or older. </div> <div> <label for="trusted_first_name">Legal first name of trusted contact</label> <input id="trusted_first_name" name="trusted_first_name"/> </div> <div> <label for="trusted_last_name">Legal last name of trusted contact</label> <input id="trusted_last_name" name="trusted_last_name"/> </div> <div> If you fill in name, you are required to fill in one of the following, email, phone or address </div> <div class="input_error" id="trusted_contact_missing_info"></div> <div> <label for="trusted_email">Email of trusted contact</label> <input id="trusted_email" type="email" name="trusted_email"/> </div> <div> <label for="trusted_phone">Phone of trusted contact</label> <input id="trusted_phone" type="tel" name="trusted_phone"/> </div> <div> <label for="trusted_street_address">Address of trusted contact</label> <input id="trusted_street_address" name="trusted_street_address"/> </div> <div> <label for="trusted_city">City of trusted contact</label> <input id="trusted_city" name="trusted_city"/> </div> <div> <label for="trusted_state">State of trusted contact</label> <input id="trusted_state" name="trusted_state"/> </div> <div> <label for="trusted_postal_code">Postal code of trusted contact</label> <input id="trusted_postal_code" name="trusted_postal_code"/> </div> <div> <label for="trusted_country">Country of trusted contact</label> <select required id="trusted_country" required name="trusted_country"> <option value=""></option> {{#each countries}} <option value="{{code}}">{{name}}</option> {{/each}} </select> </div> {{#unless edit}} <div class="grid buttons"> <button type="button" id="trustedContact_prev">Previous: Identity</button> <button type="button" id="trustedContact_next">Next: Disclosures</button> </div> {{/unless}} {{#if edit}} <div class="grid buttons"> <button type="button" id="trustedContact_prev">Previous: Identity</button> <button type="submit" id="submitKYC">Update account</button> </div> <div class="alert alert-danger" id="kycError" role="alert"></div> {{/if}} </fieldset>')({edit:e,countries:Ee.Countries})}show(){this.showFieldset(".kycTrustedContact","Trusted contact")}bindEvents(){let e=document.getElementById("trustedContact_prev");null==e||e.addEventListener("click",(e=>{this.kycForm.kycIdentity.show()}));let t=document.getElementById("trustedContact_next");if(null==t||t.addEventListener("click",(e=>{this.validate()&&this.kycForm.kycDisclosures.show()})),this.edit){let e=new gt(this.kycForm);if(!this.validate())return;e.bindSubmitKyc(this.edit)}}validate(){this.setMissingInfo("trusted_contact_missing_info","");let e=document.getElementById("trusted_first_name");if(e&&!ve.isNullOrEmpty(e.value)){let e=document.getElementById("trusted_email"),t=document.getElementById("trusted_phone"),n=document.getElementById("trusted_street_address"),i=document.getElementById("trusted_city"),o=document.getElementById("trusted_postal_code"),a=document.getElementById("trusted_country");if(ve.isNullOrEmpty(e.value)&&ve.isNullOrEmpty(t.value)&&ve.isNullOrEmpty(n.value))return void this.setMissingInfo("trusted_contact_missing_info","You need to fill in either email, phone or address");if(!ve.isNullOrEmpty(e.value)&&-1==e.value.indexOf("@"))return void this.setMissingInfo("trusted_contact_missing_info","Email is not valid. It must contain @ sign");if(!ve.isNullOrEmpty(n.value)&&(ve.isNullOrEmpty(i.value)||ve.isNullOrEmpty(o.value)||ve.isNullOrEmpty(a.value)))return void this.setMissingInfo("trusted_contact_missing_info","You need fill inn into City, Postal code and Country when filling the street address")}return!0}}class wt extends ht{constructor(e){super(e)}render(){return Handlebars.compile('<fieldset class="kycUpload hidden" data-form="1"> <div class="grid"> {{{fileUpload "identity_verification" "Photo ID Front (Front of passport)"}}} </div> <div class="grid"> {{{fileUpload "identity_verification_2" "Photo ID Back (Passport picture of ID) "}}} </div> <div class="grid"> {{{fileUpload "address_verification" "Picture of address verification"}}} </div> <div class="grid buttons"> <button type="button" id="upload_prev">Previous: Disclosures</button> <button type="button" id="upload_next">Next: Agreements</button> </div> </fieldset>')({})}show(){this.showFieldset(".kycUpload","Upload documents")}bindEvents(){this.bindFileUploads();let e=document.getElementById("upload_prev");null==e||e.addEventListener("click",(e=>{this.kycForm.kycDisclosures.show()}));let t=document.getElementById("upload_next");null==t||t.addEventListener("click",(e=>{this.validateRequiredFields(".kycUpload")&&this.kycForm.kycAccountAgreement.show()}))}}var _t=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class kt extends ht{constructor(e){super(e)}show(){var e,t;null===(e=document.getElementById("kyc_reg"))||void 0===e||e.classList.add("hidden"),null===(t=document.getElementById("waiting_for_kyc_reg"))||void 0===t||t.classList.remove("hidden"),document.querySelector("#liminal_market_modal_div > article > header > span").innerHTML="Waiting for KYC to be approved",this.kycForm.timeout=setTimeout((()=>_t(this,void 0,void 0,(function*(){yield this.checkKycStatus()}))),5e3)}checkKycStatus(){return _t(this,void 0,void 0,(function*(){let e=new Xe(Moralis),t=yield e.hasValidKYC();t.isValidKyc||"ACTION_REQUIRED"==t.status?(clearTimeout(this.kycForm.timeout),this.kycForm.modal.hideModal()):this.kycForm.timeout=setTimeout((()=>{this.checkKycStatus()}),5e3)}))}}class Et{constructor(e){this.steps=5,this.timeout=void 0,this.activeFieldsetSelector=".kycContact",this.modal=new u,this.onHide=e,this.kycContact=new mt(this),this.kycIdentity=new ft(this),this.kycTrustedContact=new bt(this),this.kycDisclosures=new vt(this),this.kycAccountAgreement=new gt(this),this.kycUpload=new wt(this),this.kycWaiting=new kt(this)}show(e){new Et((()=>{})),this[e].show(),this.activeFieldsetSelector=e}showKYCForm(e=!1){let t=Handlebars.compile('<div id="kyc_reg"> <form id="kyc_wizard_form" name="kyc_wizard_form" novalidate onsubmit="return!1"> {{{KycContactHtml}}} {{{KycIdentityHtml}}} {{{KycTrustedContactHtml}}} {{{KycDisclosureHtml}}} {{{KycUploadHtml}}} {{{KycAccountAgreementHtml}}} </form> </div> <div id="waiting_for_kyc_reg" class="hidden"> KYC is being processed. This may take about 4-5 minutes. Window will close when it\'s done. <br/><br/> You can close the window, we will email you when KYC is finished. <progress></progress> </div>')({KycContactHtml:this.kycContact.render(),KycIdentityHtml:this.kycIdentity.render(),KycDisclosureHtml:this.kycDisclosures.render(),KycTrustedContactHtml:this.kycTrustedContact.render(),KycAccountAgreementHtml:this.kycAccountAgreement.render(),KycUploadHtml:this.kycUpload.render()}),n=this.modal.showModal("KYC & AML",t,!0,(()=>{this.clearTimeout(),this.onHide()}),!1),i=document.getElementById("country_of_tax_residence");i&&(this.steps="USA"==i.value?5:6),n&&(this.kycContact.bindEvents(),this.kycIdentity.bindEvents(),this.kycTrustedContact.bindEvents(),this.kycDisclosures.bindEvents(),this.kycUpload.bindEvents(),this.kycAccountAgreement.bindEvents(),document.getElementById("kyc_wizard_form").addEventListener("keyup",(e=>{"Enter"==e.key&&(e.preventDefault(),e.stopPropagation())}))),this.kycContact.show()}setSteps(e){this.steps=e}clearTimeout(){this.timeout&&clearTimeout(this.timeout)}}var It=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Tt{constructor(e,t){this.kycResponse=e,this.executeTradeButton=t}getButtonText(){let e="Finish KYC";switch(this.kycResponse.status){case"SUBMITTED":case"ONBOARDING":case"INACTIVE":case"APPROVED":case"EDITED":case"APPROVAL_PENDING":e="Submitted to KYC processor";break;case"ACTION_REQUIRED":e="Action required. Click to continue";break;case"REJECTED":e="Your application was rejected";break;case"DISABLED":e="Your account has been disabled";break;case"ACTIVE":case"ACCOUNT_UPDATED":e="You are approved. KYC is being sent to blockchain. Give it few minutes";break;case"ACCOUNT_CLOSED":e="Your account has been closed"}return e+"<small>Click for more info</small>"}getButtonClickEvent(e){switch(this.kycResponse.status){case"SUBMITTED":case"ONBOARDING":case"INACTIVE":case"APPROVED":case"EDITED":case"APPROVAL_PENDING":return this.showModal("Application is being processed","You need to wait for KYC to be approved. Then you'll be able to do trades. This usually takes few minutes for the first submission, but can take longer for second submission. We will email you when you are approved or if there are problems<br /><br />If this status has been for more than 1 day, and you haven't gotten any email from us. Please email us at <a target='_blank' href='mailto:info@liminal.market?subject=My application is being processed for to long&body=Hi, can you help me to find out what the problem is, the KYC process has not changed for some time? My name is _______ and I used the email _______ to register at liminal.market'>info@liminal.market</a>");case"ACTION_REQUIRED":return()=>It(this,void 0,void 0,(function*(){let t=new ct(e);yield t.show()}));case"REJECTED":return this.showModal("Application was rejected","Your application has been rejected during KYC process.<br /><br />We don't have the information on why that happened, but you can email us at <a target='_blank' href='mailto:info@liminal.market?subject=My application was rejected&body=Hi, can you help me to find out what the problem is? My name is _______ and I used the email _______ to register at liminal.market'>info@liminal.market</a> and we can find out, and we should be able to solve it together.");case"DISABLED":return this.showModal("Application was disabled","Your account has been disabled.<br /><br />We don't have the information on why that happened, but you can email us at <a target='_blank' href='mailto:info@liminal.market?subject=My application was disabled&body=Hi, can you help me to find out what the problem is? My name is _______ and I used the email _______ to register at liminal.market'>info@liminal.market</a> and we can find out, and we should be able to solve it together.");case"ACCOUNT_CLOSED":return this.showModal("Application was closed","Your account has been closed.<br /><br />We don't have the information on why that happened, but you can email us at <a target='_blank' href='mailto:info@liminal.market?subject=My application was closed&body=Hi, can you help me to find out what the problem is? My name is _______ and I used the email _______ to register at liminal.market'>info@liminal.market</a> and we can find out, and we should be able to solve it together.");case"ACCOUNT_UPDATED":case"ACTIVE":return this.showModal("Account soon ready",'Your account has been approved...<br /><br/>..but, after we approve your account, we write the information to the blockchain. This usually takes just few(2-3) minutes.<br /><br/> If this is taking longer, please email us at <a target="_blank" href="mailto:info@liminal.market?subject=KYC is being written to blockchain&body=Hi, can you help me to find out what the problem is? My name is _______ and I used the email _______ to register at liminal.market">info@liminal.market</a>')}return()=>{new Et((()=>It(this,void 0,void 0,(function*(){yield this.executeTradeButton.renderButton()})))).showKYCForm()}}showModal(e,t){return()=>{(new u).showModal(e,t)}}}var St=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class At{constructor(e,t,n){this.hasBuyingPower=!1,this.moralis=e,this.sellTradeInput=t,this.buyTradeInput=n,this.authenticateService=new S(this.moralis),this.template=Handlebars.compile('<button id="liminal_market_execute_trade"></button>'),this.button=document.getElementById("liminal_market_execute_trade"),At.Instance=this}renderButton(){return St(this,void 0,void 0,(function*(){this.button.outerHTML=this.button.outerHTML,this.button=document.getElementById("liminal_market_execute_trade"),this.loadingButton(this.button),this.walletIsConnected(this.button)&&this.userIsLoggedIn(this.button)&&this.chainIdIsCorrect(this.button)&&(yield this.userHasNativeToken(this.button))&&(yield this.kycIsDone(this.button))&&(yield this.userHasAUSD(this.button))&&(yield this.userHasEnoughQty(this.button))&&this.hasQuantityAndSymbol(this.button)&&(yield this.isMarketOpen(this.button))&&this.enableExecuteTrade(this.button)}))}enableExecuteTrade(e){e.innerHTML="Execute trade",e.classList.replace("disabled","enabled"),this.stopLoadingButton(e),e.addEventListener("click",(()=>St(this,void 0,void 0,(function*(){this.loadingButton(e);let t=A.Instance;if(e.innerHTML="Confirm transaction in your "+t.WalletName+" wallet","aUSD"==this.sellTradeInput.symbol){let t=new ce(this.moralis),n=yield t.getSymbolContractAddress(this.buyTradeInput.symbol);if(n===J){let i=yield t.createToken(this.buyTradeInput.symbol,(()=>{e.innerHTML="Creating token. Give it few seconds"})).finally((()=>{this.stopLoadingButton(e),e.innerHTML="Execute trade"}));if(i instanceof se)return;n=i}yield this.executeTransfer(n,e)}else{let t=new ce(this.moralis),n=yield t.getSymbolContractAddress(this.sellTradeInput.symbol),i=new tt(this.moralis);yield i.transfer(n,this.sellTradeInput.quantity).catch((e=>{console.log("CATCH - securityTokenService.transfer",e)})).then((e=>{console.log("THEN - securityTokenService.transfer",e),e&&this.monitorExecuteTrade(e,it.Sell)})).finally((()=>{this.stopLoadingButton(e),e.innerHTML="Execute trade"}))}}))))}executeTransfer(e,t){return St(this,void 0,void 0,(function*(){let n=new Ae(this.moralis);yield n.transfer(e,this.sellTradeInput.quantity).catch((e=>{console.log("CATCH - aUsdService.transfer",e)})).then((e=>{e&&(this.monitorExecuteTrade(e,it.Buy),this.setProgressText("Sending to blockchain",e.hash))})).finally((()=>{this.stopLoadingButton(t),t.innerHTML="Execute trade"}))}))}getBuyingSharesObj(e){let t=e.walletAddress,n=e.tokenAddress,i=e.filled_qty;return{sellingLogo:"/img/logos/aUSD.png",sellingSymbol:"aUSD",sellingAmount:"$"+new z(e.amount).div(Math.pow(10,18)).toFixed(),buyingLogo:"/img/logos/"+e.symbol+".png",buyingSymbol:e.symbol,buyingQuantity:i,buyingRoundQuantity:j(i,6)+" shares",shortEthAddress:Z(t),tokenAddress:n}}getSellSharesObj(e){let t=e.sender,n=e.recipient,i=new z(e.filled_avg_price).multipliedBy(new z(e.filled_qty)),o=e.filled_qty;return{sellingLogo:"/img/logos/"+e.symbol+".png",sellingSymbol:e.symbol,sellingAmount:o+" shares",buyingLogo:"/img/logos/aUSD.png",buyingSymbol:"aUSD",buyingQuantity:i.toFixed(),buyingRoundQuantity:"$"+Q(i,6).toFixed(),shortEthAddress:Z(t),tokenAddress:n}}showTradeExecuted(e){return St(this,void 0,void 0,(function*(){let t=A.Instance,n=s.getInstance(),i="buy"==e.side?this.getBuyingSharesObj(e):this.getSellSharesObj(e);i.walletName=t.WalletName,i.blockExplorerLink=n.BlockExplorer+"/tx/"+e.transaction_hash;let o=Handlebars.compile(' <article class="trade_executed"> <nav> <ul> <li> <img src="{{sellingLogo}}"><br/> {{sellingSymbol}}<br/> {{sellingAmount}} </li> </ul> <ul> <li> ----\x3e </li> </ul> <ul> <li> <img src="{{buyingLogo}}"/><br/> {{buyingSymbol}}<br/> <abbr title="{{buyingQuantity}}" data-tooltip="{{buyingQuantity}}">{{buyingRoundQuantity}}</abbr> </li> </ul> </nav> <div> If you haven\'t already, add the {{buyingSymbol}} to your wallet. <br/><br/> <button id="addTokenToWallet" data-address="{{tokenAddress}}">Add {{buyingSymbol}} to wallet</button> <div id="addTokenToWalletFailed" class="d-none"> You can copy the address, to import the token <input value="{{tokenAddress}}"/> </div> <br/> Should be visible in your {{walletName}} on address {{shortEthAddress}}. <br/><br/> <small>You can view the <a href="{{blockExplorerLink}}" target="_blank">block transaction here</a></small> </div> </article> ')(i);(new u).showModal("Trade executed",o);let a=document.getElementById("addTokenToWallet");a&&a.addEventListener("click",(e=>{let t=e.target.dataset.address;new _(this.moralis).addTokenToWallet(t,this.buyTradeInput.symbol,(()=>{let e=document.getElementById("addTokenToWalletFailed");e&&e.classList.remove("d-none")}))}))}))}monitorExecuteTrade(e,t){return St(this,void 0,void 0,(function*(){let e=new ot(this.moralis);yield e.subscribeToTable(t,(e=>St(this,void 0,void 0,(function*(){let t=this.moralis.User.current();if(t&&e.walletAddress==t.get("ethAddress"))if("order_filled"==e.status){yield this.showTradeExecuted(e),yield je.forceLoadAUSDBalanceUI();let t=document.getElementById("executing-trade-progress");if(!t)return;t.classList.add("d-none")}else"order_failed"==e.status?(new u).showModal("Order failed","We could not finish your order."):e.status?"order_requested"==e.status&&(this.setProgressText("Sent to stock exchange",e.transaction_hash),yield je.forceLoadAUSDBalanceUI()):this.setProgressText("Received order sending to stock exchange",e.transaction_hash)}))));let n=document.getElementById("executing-trade-progress");n&&n.classList.remove("d-none")}))}loadingButton(e){e.setAttribute("aria-busy","true")}stopLoadingButton(e){e.removeAttribute("aria-busy")}walletIsConnected(e){return!!this.authenticateService.isWalletConnected()||(e.innerHTML="Connect wallet",e.addEventListener("click",(()=>{new Je(this.moralis).chooseWalletProvider()})),this.stopLoadingButton(e),!1)}userIsLoggedIn(e){return!!this.authenticateService.isUserLoggedIn()||(e.innerHTML="Login",e.addEventListener("click",(()=>St(this,void 0,void 0,(function*(){yield this.authenticateService.authenticateUser(Je.Provider)})))),this.stopLoadingButton(e),!1)}chainIdIsCorrect(e){let t=this.authenticateService.getChainId(),n=s.getInstance();return t===n.ChainId||(s.getNetworkInfoByChainId(t)?(s.setNetworkByChainId(t),!0):(e.innerHTML="Switch Network",e.addEventListener("click",(()=>St(this,void 0,void 0,(function*(){yield n.addNetworkToWallet(this.moralis)})))),this.stopLoadingButton(e),!1))}userHasNativeToken(e){return St(this,void 0,void 0,(function*(){let t=s.getInstance();return!!(yield t.hasEnoughNativeTokens(this.moralis))||(e.classList.replace("enabled","disabled"),e.innerHTML="You need "+t.NativeCurrencyName+" tokens. Click me for some tokens",e.addEventListener("click",(()=>{new rt(this.moralis,(()=>{this.renderButton()})).show()})),this.stopLoadingButton(e),!1)}))}kycIsDone(e,t=!1){return St(this,void 0,void 0,(function*(){let n=new Xe(this.moralis);if(""===this.authenticateService.getEthAddress())return console.log("no ETH address, kyc check failed"),!1;let i=yield n.hasValidKYC();if(i.isValidKyc||"ACTIVE"!=i.status||(this.kycIdDoneTimeout=setInterval((()=>St(this,void 0,void 0,(function*(){this.loadingButton(e),i=yield n.hasValidKYC(),i.isValidKyc&&(this.hasBuyingPower=i.hasBuyingPower,clearInterval(this.kycIdDoneTimeout),yield this.renderButton())}))),1e4)),i.isValidKyc){if(t){clearInterval(this.kycIdDoneTimeout);let e=Handlebars.compile('<h2>You are account has been approved</h2> <p>We have approved your account. You can now fund your account and start to trade. <button id="kycApprovedFund">Fund account</button> </p>'),t=new u;t.showModal("Account approved",e({}));let n=document.getElementById("kycApprovedFund");null==n||n.addEventListener("click",(e=>{t.hideModal(),new Ke(this.moralis).showAUSDFakeFund((()=>{this.renderButton()}))}))}return!0}let o=new Tt(i,this);return e.innerHTML=o.getButtonText(),e.addEventListener("click",o.getButtonClickEvent(this)),this.stopLoadingButton(e),!1}))}checkKycIsDone(){this.kycIdDoneTimeout||(this.kycIdDoneTimeout=setInterval((()=>St(this,void 0,void 0,(function*(){yield this.kycIsDone(this.button,!0)}))),1e4))}userHasAUSD(e){return St(this,void 0,void 0,(function*(){let t=new Ae(this.moralis);return!!(yield t.getAUSDBalanceOf(this.authenticateService.getEthAddress())).isGreaterThan(0)||(this.hasBuyingPower?(e.innerHTML="We are funding your aUSD token",this.checkBalanceInterval=setInterval((()=>St(this,void 0,void 0,(function*(){Ae.lastUpdate=void 0,(yield t.getAUSDBalanceOf(this.authenticateService.getEthAddress())).isGreaterThan(0)&&(yield je.forceLoadAUSDBalanceUI(),clearInterval(this.checkBalanceInterval),yield this.renderButton())}))),1e4),!1):(s.getInstance().TestNetwork?(e.innerHTML="You need aUSD. Click here to get some",e.addEventListener("click",(()=>{new Ke(this.moralis).showAUSDFakeFund((()=>{this.renderButton()}))}))):(e.innerHTML="You need aUSD. Click here for instructions",e.addEventListener("click",(()=>{new Ke(this.moralis).showAUSDFund((()=>{this.renderButton()}))}))),this.stopLoadingButton(e),!1))}))}userHasEnoughQty(e){return St(this,void 0,void 0,(function*(){let t=new Ae(this.moralis);if("aUSD"==this.sellTradeInput.symbol){if((yield t.getAUSDBalanceOf(this.authenticateService.getEthAddress())).isGreaterThanOrEqualTo(this.sellTradeInput.quantity))return!0;e.innerHTML="You don't have enough aUSD. Click for more funding",e.addEventListener("click",(()=>{let e=s.getInstance(),t=new Ke(this.moralis);e.TestNetwork?t.showAUSDFakeFund((()=>{this.renderButton()})):t.showAUSDFund((()=>{this.renderButton()}))}))}else{let t=new tt(this.moralis),n=new S(this.moralis).getEthAddress(),i=yield t.getQuantityByAddress(this.sellTradeInput.symbol,n);if(this.sellTradeInput.quantity<=i)return!0;e.innerHTML="You don't have enough "+this.sellTradeInput.symbol,e.classList.replace("disable","enable")}return this.stopLoadingButton(e),!1}))}isMarketOpen(e){return St(this,void 0,void 0,(function*(){let t=new ee(this.moralis);return!!(yield t.isMarketOpenOrUserOffHours())||(e.innerHTML="Market is closed",e.classList.replace("enabled","disabled"),this.stopLoadingButton(e),!1)}))}hasQuantityAndSymbol(e){return this.sellTradeInput.quantity.eq(0)?(e.innerHTML="Type in quantity",this.stopLoadingButton(e),!1):""!=this.buyTradeInput.name||(e.innerHTML="Select stock to buy",this.stopLoadingButton(e),!1)}setProgressText(e,t){let n=document.getElementById("progress-text");if(n){let i=s.getInstance();n.innerHTML=e+'<br /><a href="'+i.BlockExplorer+"/tx/"+t+'" target="_blank" style="font-size:10px">View</a>'}}}class Ct{constructor(){this.tbodyId="liminal_market_securities_list",this.page=0,this.loadmore=!0,this.modal=new u}showModal(e){return t=this,n=void 0,o=function*(){let t=new ye,n=yield t.render();this.modal.showModal("Select stock to buy",n,!0),yield t.bindEvents(e)},new((i=void 0)||(i=Promise))((function(e,a){function r(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}hideModal(){this.modal.hideModal()}}class Bt{constructor(e,t){this.price=e,this.lastTrade=t}}class Lt extends c{constructor(e){super(e);try{let t=JSON.parse(e.message);if(t.name){let e=Lt.getActionInstance(t.name,t);if(e)return void e.handle()}b.error(t)}catch(t){b.error(e)}}static getActionInstance(e,t){for(let n=0;n<Lt.Errors.length;n++)if(Lt.Errors[n].name===e)return new(0,Lt.Errors[n])(t)}}Lt.Errors=[class{constructor(e){this.method=e.method,this.url=e.url,this.body=e.body,this.serverError=e.serverError}handle(){console.log(this),b.report(new c("Error doing request. Server response was:"+this.serverError.data.message))}}];class Nt{constructor(e){this.moralis=e}getSymbolPrice(e,t){return n=this,i=void 0,a=function*(){const n={symbol:e};let i=(yield this.moralis.Cloud.run("getSymbolPrice",n).catch((e=>{throw new Lt(e)}))).quote,o=t==it.Sell?i.ap:i.bp;return new Bt(o,i.t)},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,s)}l((a=a.apply(n,i||[])).next())}));var n,i,o,a}}var xt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Mt{constructor(e,t,n,i,o,a){this.isDirty=!1,this.moralis=e,this.symbol=t,this.name=n,this.logo=i,this.address=o,this.tradeType=a,this.quantity=new z(0),this.strQuantity="",this.balance=new z(0),this.lastPrice=0,this.qtyPerDollar=0,this.lastTraded="",this.template=Handlebars.compile('<article class="{{tradeType}}Inputs tradeInputArticle"> <div class="grid tradeInput"> <div class="select_token"> <a id="{{tradeType}}SelectStock" href="#" role="button"> <img src="{{logo}}"/> {{symbol}} </a> </div> <div class="trade_input"><input autocomplete="off" autocorrect="off" type="tel" spellcheck="false" value="{{strQuantity}}" placeholder="0.0"/></div> <div class="balance">Balance : <abbr title="{{balance}}" data-tooltip="{{balance}}" class="balance_value">{{abbrBalance}}</abbr> <a href="" class="balance_max">Max</a></div> <div class="price_per_share"></div> </div> <progress class="progress d-none" value="0" max="1"></progress> <div class="exceeds_wallet_balance d-none">Exceeds wallet balance</div> </article> '),this.pricePerShareTemplate=Handlebars.compile('<abbr title="Last trade was {{lastTraded}}" data-tooltip="Last trade was {{lastTraded}}">{{text}}</abbr>')}setOtherTradePanelInput(e){this.otherTradePanelInput=e}renderToString(){return this.template(this)}render(e=!0){document.querySelector("."+this.tradeType+"Inputs").outerHTML=this.renderToString(),e&&this.bindEvents()}bindEvents(){this.bindQuantityListener(),this.bindSelectStockButton(),this.bindMaxLink()}setSymbol(e,t,n){this.symbol=e,this.name=t,this.logo=n,this.isDirty=!0}bindSelectStockButton(){let e=document.querySelector("#"+this.tradeType+"SelectStock");e&&e.addEventListener("click",(e=>xt(this,void 0,void 0,(function*(){e.preventDefault();let t=new Ct;yield t.showModal(((e,n,i)=>xt(this,void 0,void 0,(function*(){t.hideModal(),this.otherTradePanelInput&&"aUSD"==this.symbol&&e!=this.symbol&&this.otherTradePanelInput.setSymbol(this.symbol,this.name,this.logo),this.symbol=e,this.name=n,this.logo=i;let o=new ce(this.moralis);this.address=yield o.getSymbolContractAddress(e),this.render(),this.loadBalance().then(),yield this.loadLastTrade(),this.onUpdate&&this.onUpdate()}))))}))))}bindQuantityListener(){let e,t=document.querySelector("."+this.tradeType+"Inputs .trade_input input");t&&t.addEventListener("keyup",(t=>{e&&clearTimeout(e),e=setTimeout((()=>{let e=t.target.value;this.setQuantity(e),this.loadProgressbar(),this.otherTradePanelInput&&this.otherTradePanelInput.updateQuantity(),this.onUpdate&&this.onUpdate()}),300)}))}bindMaxLink(){let e=document.querySelector("."+this.tradeType+"Inputs .balance_max");e&&e.addEventListener("click",(e=>{e.preventDefault();let t=document.querySelector("."+this.tradeType+"Inputs .trade_input input");t&&(t.value=this.balance.toFixed(),this.setQuantity(t.value),this.loadProgressbar(),this.otherTradePanelInput&&this.otherTradePanelInput.updateQuantity(),this.onUpdate&&this.onUpdate())}))}loadBalance(){return xt(this,void 0,void 0,(function*(){this.balance=new z(0);let e=new ee(this.moralis).getEthAddress(),t=document.querySelector("."+this.tradeType+"Inputs .balance_value");if(t){if("aUSD"===this.symbol){if(e){let t=new Ae(this.moralis);this.balance=yield t.getAUSDBalanceOf(e)}t.innerHTML="$"+$(this.balance).toString()}else if(""!==this.name){if(this.balance=new z(0),e){let t=new tt(this.moralis);this.balance=yield t.getQuantityByAddress(this.symbol,e)}t.innerHTML=Q(this.balance,6).toString()}t.dataset.tooltip=this.balance.toString(),t.title=this.balance.toString(),this.loadProgressbar(),this.toggleMaxBalanceLink()}}))}loadLastTrade(){return xt(this,void 0,void 0,(function*(){if("aUSD"===this.symbol)return this.lastPrice=1,void(this.qtyPerDollar=1);if(!this.otherTradePanelInput||""==this.name)return;let e=document.querySelector("."+this.otherTradePanelInput.tradeType+"Inputs .price_per_share");if(!e)return;let t=document.querySelector("."+this.tradeType+"Inputs .price_per_share");if(!t)return;e.setAttribute("aria-busy","true"),t.setAttribute("aria-busy","true");let n=new Nt(this.moralis),i=yield n.getSymbolPrice(this.symbol,this.otherTradePanelInput.tradeType);this.lastPrice=i.price,this.lastTraded=i.lastTrade.toString(),this.qtyPerDollar=1/this.lastPrice;let o={lastTraded:this.lastTraded,text:"≈ $"+this.lastPrice+" per share"};t.innerHTML=this.pricePerShareTemplate(o);let a={lastTraded:this.lastTraded,text:"1 aUSD ≈ "+j(this.qtyPerDollar,6)+" "+this.symbol};e.innerHTML=this.pricePerShareTemplate(a),this.updateQuantity(),e.removeAttribute("aria-busy"),t.removeAttribute("aria-busy")}))}updateQuantity(){if(!this.otherTradePanelInput)return;let e=document.querySelector("."+this.tradeType+"Inputs .trade_input input");e&&("aUSD"===this.symbol?e.value=this.otherTradePanelInput.quantity.div(this.otherTradePanelInput.qtyPerDollar).toString():e.value=this.otherTradePanelInput.quantity.multipliedBy(this.qtyPerDollar).toString(),this.setQuantity(e.value),this.loadProgressbar())}loadProgressbar(){if(this.quantity.eq(0)||this.balance.eq(0)||this.tradeType==it.Buy)return;let e=document.querySelector("."+this.tradeType+"Inputs .progress");if(!e)return;let t=this.quantity.div(this.balance).toNumber();e.value=t,e.classList.remove("d-none");let n=document.querySelector("."+this.tradeType+"Inputs .exceeds_wallet_balance");t>1?(n.classList.remove("d-none"),e.setAttribute("aria-invalid","true")):n.classList.add("d-none")}static switchPanels(e,t){return xt(this,void 0,void 0,(function*(){let n=e.symbol,i=e.name,o=e.logo,a=e.quantity;return e.setSymbol(t.symbol,t.name,t.logo),e.quantity=t.quantity,t.setSymbol(n,i,o),t.quantity=a,yield e.updatePanel(),yield t.updatePanel(),[e,t]}))}setQuantity(e){""!=e&&"0"!=e&&(this.quantity=new z(e),this.strQuantity=e)}quantityFormatted(){return"aUSD"===this.symbol?"$"+this.quantity:this.quantity}updatePanel(){return xt(this,void 0,void 0,(function*(){this.updateQuantity(),this.render(!0),yield this.loadBalance(),yield this.loadLastTrade()}))}toggleMaxBalanceLink(){let e=document.querySelector("."+this.tradeType+"Inputs .balance_max");e&&(this.balance.eq(0)?e.classList.add("d-none"):e.classList.remove("d-none"))}}class Dt{constructor(){this.template=void 0,this.template=Handlebars.compile('<div class="grid tradeSwitch"> <a title="Switch the trade" href="" class="switchBtn" class="outline"></a> </div>')}renderToString(){return this.template()}render(){let e=document.querySelector(".tradeSwitch");e&&(e.outerHTML=this.renderToString())}bindEvents(e,t,n){let i=document.querySelector(".switchBtn");i&&i.addEventListener("click",(n=>{return i=this,o=void 0,r=function*(){n.preventDefault(),[e,t]=yield Mt.switchPanels(e,t)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(r.next(e))}catch(e){t(e)}}function s(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(n,s)}l((r=r.apply(i,o||[])).next())}));var i,o,a,r}))}}class Ut{constructor(e){this.moralis=e,this.quantity=0}render(e,t,n,i,o){return a=this,r=void 0,l=function*(){let a=document.getElementById(e);if(!a)return;let r,s=ae.getContractInfo(),l=new Mt(this.moralis,"aUSD","aUSD at Broker","/img/ausd.png",s.AUSD_ADDRESS,it.Sell);r=t?new Mt(this.moralis,t,n,i,o,it.Buy):new Mt(this.moralis,"Select stock","","","",it.Buy),l.setOtherTradePanelInput(r),r.setOtherTradePanelInput(l);let d=new Dt,c=l.renderToString(),u=r.renderToString(),h=d.renderToString();a.innerHTML=c+h+u,yield l.loadBalance(),yield r.loadBalance(),t&&(yield r.loadLastTrade()),l.bindEvents(),r.bindEvents();let m=new At(this.moralis,l,r);yield m.renderButton(),d.bindEvents(l,r,m),l.onUpdate=()=>{r.isDirty&&r.updatePanel(),m.renderButton()},r.onUpdate=()=>{l.isDirty&&l.updatePanel(),m.renderButton()}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(n,i)}o((l=l.apply(a,r||[])).next())}));var a,r,s,l}formatBuyPanel(e,t,n,i,o){document.getElementById("liminal_market_select_symbol").innerHTML=e}}var Pt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ft{constructor(e){this.moralis=e}load(e,t,n,i){return Pt(this,void 0,void 0,(function*(){let o=document.getElementById("main_container");if(!o)return;let a=ae.getContractInfo(),r=Handlebars.compile('<div id="tradingPanel"> <a href="#use_wallet_for_orders" id="use_wallet_for_orders_link" class="not_visible">Trade in your wallet instead of here</a> <article id="liminal_market_trade_panel"></article> <div id="executing-trade-progress" class="d-none"> <div id="progress-text"></div> <progress></progress> </div> <button id="liminal_market_execute_trade"></button> <article id="use_wallet_for_orders"> <h3>How to buy in wallet</h3> <ul> <li>If you haven\'t added aUSD to your wallet, now is the time - <small><a href="" id="addAUSDToWallet">Click here to add aUSD to wallet</a></small></li> <li><a href="" class="findSymbol">Find symbol</a> you want to buy & click "Get address"</li> <li>Go to your wallet and find the aUSD token, click "Send"</li> <li>Paste in the address you just copied for the Receiver. <ul> <li><em>Note: If you can, save the address to your contact list for easy access next time</em></li> </ul> </li> <li>Type in the amount & click Confirm</li> <li>You have now bought the shares, don\'t forget to <a href="" class="findSymbol">add the token to wallet</a>. &#127881;</li> </ul> <div style="text-align:center"> </div> <h3>Sell your securities</h3> <ul> <li>Find the token you want so sell in you wallet and click Send</li> <li>Put the in the aUSD address<br/><input id="aUsdAddress" value="{{AUSDAddress}}"> <ul> <li><em>Note: If you can, save the address to your contact list for easy access next time</em></li> </ul> </li> <li>Type in the quantity of shares you want to sell & click Confirm</li> <li>You have now sold the shares &#127881;</li> </ul> </article> </div>');o.innerHTML=r({AUSDAddress:a.AUSD_ADDRESS});let s=new Ut(this.moralis);yield s.render("liminal_market_trade_panel"),e&&(yield this.selectSymbol(e,t,n,i));let l=new ee(this.moralis).getEthAddress(),d=new Ae(this.moralis),c=new z(0);l&&(c=yield d.getAUSDBalanceOf(l));let h=document.getElementById("use_wallet_for_orders"),m=document.getElementById("use_wallet_for_orders_link");c.eq(0)?(null==h||h.classList.add("hidden"),null==m||m.classList.add("not_visible")):(null==h||h.classList.remove("hidden"),null==m||m.classList.remove("not_visible"));let f=document.querySelectorAll(".findSymbol");null==f||f.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();let t=new Ct;t.showModal((()=>{t.hideModal()}))}))}));let p=document.getElementById("addAUSDToWallet");null==p||p.addEventListener("click",(e=>{e.preventDefault(),new _(this.moralis).addTokenToWallet(a.AUSD_ADDRESS,"aUSD",(()=>{let e=new u,t=Handlebars.compile(' You can copy the address of {{symbol}} and import it into your wallet <input id="tokenAddress" value="{{tokenAddress}}"/> ')({symbol:"aUSD",tokenAddress:a.AUSD_ADDRESS});e.showModal("Add aUSD to wallet",t)}))}))}))}selectSymbol(e,t,n,i){return Pt(this,void 0,void 0,(function*(){let o=new Ut(this.moralis);yield o.render("liminal_market_trade_panel",e,t,n,i)}))}}var Rt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ot{constructor(e){this.moralis=e}load(){return Rt(this,void 0,void 0,(function*(){let e=document.getElementById("main_container");if(!e)return;let t=new ye,n=yield t.render(),i=Handlebars.compile(' <article id="stockList"> <div id="ua"></div> <div id="list_of_securities">{{{securities}}}</div> </article>');e.innerHTML=i({securities:n}),yield t.loadMore(),yield t.bindEvents(((e,t,n)=>Rt(this,void 0,void 0,(function*(){let i=new ce(this.moralis),o=yield i.getSymbolContractAddress(e),a=new Ft(this.moralis);window.scrollTo(0,0),history.pushState(null,"Buy stocks","#/trade"),yield a.load(e,t,n,o)}))))}))}}var qt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Ht{constructor(e){this.moralis=e}getDocuments(){return qt(this,void 0,void 0,(function*(){return yield this.moralis.Cloud.run("documents")}))}getDocument(e){return qt(this,void 0,void 0,(function*(){const t={documentId:e};return yield this.moralis.Cloud.run("download",t)}))}}class Wt{constructor(e){this.moralis=e}show(e){let t=new u,n=Handlebars.compile('Token for {{symbol}} does not exist. You can click the button below to create the token. This will cost a bit of gas. <br/><br/> After the token has been created we will try to add it to your wallet. <br/><br/> <button id="createTokenBtn">Create token</button> <div class="d-none" id="copyAddressInfo"> You can copy the address of the token and import it into your wallet <input id="tokenAddress"/> </div>');t.showModal("Token "+e+" doesn't exist",n({symbol:e}));let i=document.getElementById("createTokenBtn");i&&i.addEventListener("click",(()=>{return t=this,n=void 0,a=function*(){y.setLoading(i);let t=new ce(this.moralis),n=yield t.getSymbolContractAddress(e);if(n===J){let o=yield t.createToken(e,(()=>{i.innerHTML="Creating token. Give it few seconds"}));if(o instanceof se&&o.code==se.UserCancelled)return void y.removeLoading();n=o}y.removeLoading(),i.innerHTML="Add token to wallet";let o=new _(this.moralis);yield o.addTokenToWallet(n,e,(()=>{let e=document.getElementById("tokenAddress");e&&(e.innerHTML=n,document.getElementById("copyAddressInfo").classList.remove("d-none"))}))},new((o=void 0)||(o=Promise))((function(e,i){function r(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,s)}l((a=a.apply(t,n||[])).next())}));var t,n,o,a}))}}class Yt{constructor(e){this.moralis=e}getPositions(){return e=this,t=void 0,i=function*(){return yield this.moralis.Cloud.run("positions")},new((n=void 0)||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}}var Kt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class Gt{constructor(e){this.moralis=e,this.documentService=new Ht(this.moralis)}load(){return Kt(this,void 0,void 0,(function*(){let e=document.getElementById("main_container");if(!e)return;let t=new Yt(this.moralis),n=yield t.getPositions();Me.registerHelpers();let i=Handlebars.compile('<article class="loaded-content2"> <h3>Positions</h3> <p>These are your positions registered with the broker. These would be registered to you on the stock exchange if we weren\'t running on a sandbox at the broker. Want to know when we open for live trading? <a href="https://liminal.market" target="_blank">Register your email with us</a> </p> <figure> <table> <thead> <tr> <th></th> <th>Symbol</th> <th>Current price</th> <th>Avg. entry value</th> <th>Quantity</th> <th>Market value</th> <th>Unrealize PL</th> <th>Trade</th> <th>Add to wallet</th> </tr> </thead> <tbody> {{#if result}} {{#each result}} <tr> <td class="symbol_logo"><img id="symbol_logo_{{symbol}}" src="/img/logos/default_logo.png"/></td> <td><a href="https://strike.market/stocks/{{symbol}}" target="_blank">{{symbol}}</a></td> <td>{{current_price}}</td> <td>{{round2 avg_entry_price}}</td> <td>{{round2 qty}}</td> <td>${{round market_value}}</td> <td class="{{classColor unrealized_pl}}">${{round unrealized_pl}} ({{perc unrealized_plpc}})</td> <td><a href="#" class="tradeSecurity" data-symbol="{{symbol}}" data-qty="{{qty}}">Trade</a></td> <td><a href="" class="addToWallet" data-symbol="{{symbol}}">Add</a></td> </tr> {{/each}} {{/if}} </tbody> </table> </figure> <div id="documents"></div> </article>');e.innerHTML=i({result:n});let o=document.getElementById("syncWallet");o&&o.addEventListener("click",(e=>{e.preventDefault(),this.syncAllTokens()}));let a=new Array;const r=document.getElementsByClassName("tradeSecurity");for(let e=0;e<r.length;e++){let t=r[e].dataset.symbol;t&&(a.push(t),r[e].addEventListener("click",(e=>Kt(this,void 0,void 0,(function*(){e.preventDefault();let t=e.target.dataset.symbol;if(!t)return;let n=new ce(this.moralis),i=yield n.getSymbolContractAddress(t),o=yield p.getInstance(),a=yield o.getSecurityBySymbol(t),r=new Ft(this.moralis);yield r.load(t,a.Name,a.LogoPath+a.Logo,i),window.scrollTo(0,0)})))))}const s=document.getElementsByClassName("addToWallet");for(let e=0;e<s.length;e++)s[e].addEventListener("click",(t=>Kt(this,void 0,void 0,(function*(){t.preventDefault(),console.log(t.target);let n=s[e].dataset.symbol,i=new ce(this.moralis),o=yield i.getSymbolContractAddress(n);if(o.toString()==J)return void new Wt(this.moralis).show(n);let a=new _(this.moralis);yield a.addTokenToWallet(o.toString(),n,(()=>{let e=new u,t=Handlebars.compile(me)({symbol:n,address:o});e.showModal("Import token to wallet",t)}))}))));yield this.renderSymbolLogos(a);let l=Handlebars.compile('<h3>Documents</h3> <p>These are your documents for your trades, generated by the broker. These documents are trade confirmation & monthly statements. They are generated at the end of the day, between 06:30PM-07:30PM EST. </p> {{#if result}} <table class="table table-hover"> <thead> <tr> <th>Type</th> <th>Date</th> <th>Download</th> </tr> </thead> <tbody> {{#each result}} <tr> <td title="{{id}}">{{type}}</td> <td>{{date}}</td> <td><a href="" class="downloadDoc" data-docid="{{id}}">Download</a></td> </tr> {{/each}} </tbody> </table> {{/if}}'),d=yield this.documentService.getDocuments(),c=document.getElementById("documents");c&&(c.innerHTML=l({result:d}),yield this.initDocuments())}))}renderSymbolLogos(e){return Kt(this,void 0,void 0,(function*(){let t=yield p.getInstance();const n=yield t.getSecurities();let i;for(let t=0;t<e.length;t++)i=n.get(e[t]),i&&document.getElementById("symbol_logo_"+e[t]).setAttribute("src","/img/logos/"+i.Logo)}))}syncAllTokens(){return Kt(this,void 0,void 0,(function*(){let e=s.getInstance(),t=yield this.moralis.Cloud.run("costOfSync"),n=Handlebars.compile('<article> If your wallet is out of sync with your position you can sync it here. This happens when you move from one chain to another. If you like to switch to new chain click the button below. <br/><br/> You will be asked to confirm a transaction of {{totalCost}} {{NativeSymbol}} (${{priceInNativeToken}}). Each stock costs {{costPerShare}} {{NativeSymbol}} to sync. You have total of {{shareCount}} share. <br/><br/> <button id="syncAllPositions">Sync stock to my wallet</button> </article>')({shareCount:t.shareCount,costPerShare:Moralis.Units.FromWei(t.costPerShare,18),priceInNativeToken:t.priceInNativeToken,totalCost:Moralis.Units.FromWei(t.cost,18),NativeSymbol:e.NativeSymbol});(new u).showModal("Sync all stock to wallet",n);let i=document.getElementById("syncAllPositions");i&&i.addEventListener("click",(e=>Kt(this,void 0,void 0,(function*(){e.preventDefault()}))))}))}initDocuments(){return Kt(this,void 0,void 0,(function*(){const e=document.getElementsByClassName("downloadDoc");if(this.moralis.User.current())for(let t=0;t<e.length;t++)e[t].addEventListener("click",(n=>Kt(this,void 0,void 0,(function*(){n.preventDefault();let i=e[t].dataset.docid;if(!i)return;let o=yield this.documentService.getDocument(i);""!=o?window.location=o:alert("Could not find document. Please contact us if you should have gotten a document")}))))}))}}var Vt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class zt{constructor(e){this.settings={show_trade:this.showTrade,show_positions:this.showPositions,show_stocks:this.showStocks,show_kyc_action_required:this.showKycActionRequired,show_funding:this.showFunding,show_kyc:this.showKyc},this.moralis=e}loadRoutes(){var e;return Vt(this,void 0,void 0,(function*(){let t=window.location.hash.replace("#","").replace("/","");console.log(t),""===t&&(t="stocks"),this.attachNavLinks();let n=null!==(e=this.settings["show_"+t])&&void 0!==e?e:this.settings.show_stocks;"function"==typeof n?yield n(this):yield n(this.settings.show_stocks)}))}showKycActionRequired(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Ft(e.moralis);yield n.load(),history.pushState(null,"Buy stocks","#/kyc_action_required");let i=document.getElementById("liminal_market_execute_trade");null==i||i.dispatchEvent(new MouseEvent("click"))}))}showKyc(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Ft(e.moralis);yield n.load(),history.pushState(null,"Buy stocks","#/kyc");let i=document.getElementById("liminal_market_execute_trade");null==i||i.dispatchEvent(new MouseEvent("click"))}))}showFunding(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Ft(e.moralis);yield n.load(),history.pushState(null,"Buy stocks","#/funding");let i=new Ke(this.moralis);s.getInstance().TestNetwork?i.showAUSDFakeFund((()=>{})):i.showAUSDFund((()=>{}))}))}showTrade(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Ft(e.moralis);yield n.load(),history.pushState(null,"Buy stocks","#/trade")}))}showStocks(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Ot(e.moralis);yield n.load(),history.pushState(null,"Stocks","#/stocks")}))}showPositions(e,t){return Vt(this,void 0,void 0,(function*(){t&&t.preventDefault();let n=new Gt(e.moralis);yield n.load(),history.pushState(null,"Positions","#/positions")}))}attachNavLinks(){let e=this;document.querySelectorAll(".tradeNavLink").forEach((t=>{t.addEventListener("click",(function(n){return Vt(this,void 0,void 0,(function*(){yield e.showTrade(e,n),t.parentElement.parentElement.parentElement.removeAttribute("open")}))}))})),document.querySelectorAll(".investNavLink").forEach((t=>{t.addEventListener("click",(function(n){return Vt(this,void 0,void 0,(function*(){yield e.showStocks(e,n),t.parentElement.parentElement.parentElement.removeAttribute("open")}))}))})),document.querySelectorAll(".positionNavLink").forEach((t=>{t.addEventListener("click",(function(n){return Vt(this,void 0,void 0,(function*(){yield e.showPositions(e,n),t.parentElement.parentElement.parentElement.removeAttribute("open")}))}))}))}}var jt=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};(function(){return jt(this,void 0,void 0,(function*(){let e=setTimeout((function(){let t=document.querySelector(".loading");t?t.innerHTML="Hmmm.... our servers are slow. Give it few seconds.":clearTimeout(e)}),1e4);(new l).start().then((function(){return jt(this,void 0,void 0,(function*(){clearTimeout(e);let t=document.querySelector(".loading"),n=new ee(Moralis),i=yield n.isLoggedIn(t);if(console.log("loggedInUser",i),i){let e=new Qe(Moralis,i.providerInfo,i);yield e.render("user_header_info")}else new Je(Moralis).renderButton("user_header_info");let o=new zt(Moralis);if(yield o.loadRoutes(),Moralis.isWeb3Enabled()&&s.getInstance().TestNetwork){let e=document.querySelector("header");if(!e)return;let t='<div class="errorBar">You are running on testnet. No real trades will be executed</div>';e.insertAdjacentHTML("beforebegin",t)}}))})).catch((e=>{b.report(new c("Server is down. Please try again later.<br /><br />"+e))})),document.body.addEventListener("click",(e=>{let t=document.getElementById("userInfoDropdown");t&&!t.classList.contains("d-none")&&(t.classList.add("d-none"),e.stopPropagation(),e.preventDefault())})),new _(Moralis).isWebview(window.navigator.userAgent),class{static loadImage(){let e=document.querySelector("body > header");if(!e)return;let t=Math.floor(10*Math.random());e.style.backgroundImage="url(/img/header/"+t+".jpg)"}}.loadImage()}))})().then()})();